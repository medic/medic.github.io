<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Community Health Toolkit – Overview of CHT Components</title><link>https://docs.communityhealthtoolkit.org/core/overview/</link><description>Recent content in Overview of CHT Components on Community Health Toolkit</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://docs.communityhealthtoolkit.org/core/overview/index.xml" rel="self" type="application/rss+xml"/><item><title>Core: Architecture of CHT Instances</title><link>https://docs.communityhealthtoolkit.org/core/overview/architecture/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/core/overview/architecture/</guid><description>
&lt;h2 id="overview">Overview&lt;/h2>
&lt;p>&lt;img src="../../img/architecture.png" alt="Architecture of a CHT project">&lt;/p>
&lt;h2 id="server-side">Server side&lt;/h2>
&lt;h3 id="couchdb">CouchDB&lt;/h3>
&lt;p>A free and open source NoSQL database we use to store all our data, configuration, and even the application code. CouchDB is really good at replication which is the process of sending the data to another database and back again. See more at the &lt;a href="http://couchdb.apache.org">CouchDB&lt;/a> site.&lt;/p>
&lt;h3 id="api">api&lt;/h3>
&lt;p>A NodeJS service which runs on the server as a wrapper around CouchDB. It provides security and APIs for browsers and integrations. It also includes a custom implementation of filtered replication to allow it to support more concurrent users. See more at the &lt;a href="https://github.com/medic/cht-core/tree/master/api">CHT Core API repo&lt;/a> on Github.&lt;/p>
&lt;h3 id="sentinel">sentinel&lt;/h3>
&lt;p>Another NodeJS service running on the server, sentinel performs actions called transitions every time a document in CouchDB is added or modified. Some examples are validations, generating scheduled messages, automatic responses, creating patients, and sending alerts. See more at the &lt;a href="https://github.com/medic/cht-core/tree/master/sentinel">CHT Core Sentinel repo&lt;/a> on Github.&lt;/p>
&lt;h3 id="postgresql">PostgreSQL&lt;/h3>
&lt;p>A free and open source SQL database that we use for analytics queries for display in tools like klipfolio. We created a library called &lt;a href="https://github.com/medic/couch2pg">couch2pg&lt;/a> to replicate data from CouchDB into PostgreSQL. See more at the &lt;a href="https://www.postgresql.org">PostgreSQL&lt;/a> site.&lt;/p>
&lt;h2 id="client-side">Client side&lt;/h2>
&lt;h3 id="cht-core">cht-core&lt;/h3>
&lt;p>&lt;a href="https://github.com/medic/cht-core">cht-core&lt;/a> is composed of the following web applications:&lt;/p>
&lt;h4 id="cht-web-application">CHT Web Application&lt;/h4>
&lt;p>The CHT Web Application is used by Community Health Workers and provides a large variety of &lt;a href="https://docs.communityhealthtoolkit.org/apps/features/">features&lt;/a>.&lt;/p>
&lt;p>View the source code in &lt;a href="https://github.com/medic/cht-core/tree/master/webapp">our GitHub repository&lt;/a>.&lt;/p>
&lt;h5 id="technology">Technology&lt;/h5>
&lt;p>The CHT Web Application is &lt;a href="https://angular.io/guide/rx-library">reactive&lt;/a>, responsive and a single page application built with &lt;a href="https://angular.io/">Angular&lt;/a> and &lt;a href="https://ngrx.io">NgRx&lt;/a> frameworks. Additionally, it uses the following technology:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Technology&lt;/th>
&lt;th>Usage&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;a href="https://pouchdb.com">PouchDB&lt;/a>&lt;/td>
&lt;td>To implement an &lt;a href="https://docs.communityhealthtoolkit.org/core/overview/offline-first/">Offline-First&lt;/a> strategy which means the data is stored on the client and all pages can load immediately regardless of whether the user has a fast connection, slow connection, or no connection at all. The data is stored in PouchDB which replicates changes back and forth in the background with the server CouchDB.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://enketo.org">Enketo&lt;/a>&lt;/td>
&lt;td>To render configured xforms and help with styling and dynamic elements such as show/hide and validation rules.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://github.com/C2FO/nools">Nools&lt;/a>&lt;/td>
&lt;td>A rules engine to compute the upcoming tasks and monthly targets of the users.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://github.com/valor-software/ngx-bootstrap">Ngx-Bootstrap&lt;/a>&lt;/td>
&lt;td>To integrate Bootstrap components in the Angular application.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://github.com/ngx-translate/core">Ngx-translate&lt;/a>&lt;/td>
&lt;td>To automatically translate the labels from a Angular application. Read more about &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/translations/">how to configure translations&lt;/a>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://github.com/karma-runner/karma">Karma&lt;/a>&lt;/td>
&lt;td>A test runner for &lt;a href="https://github.com/medic/cht-core/tree/master/webapp/tests">unit tests&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://mochajs.org/">MochaJS&lt;/a>&lt;/td>
&lt;td>A test framework to run the &lt;a href="https://github.com/medic/cht-core/tree/master/webapp/tests">unit tests&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://www.protractortest.org/#/">Protractor&lt;/a>&lt;/td>
&lt;td>To run the &lt;a href="https://github.com/medic/cht-core/tree/master/tests/e2e">e2e tests&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="http://lesscss.org/">Less&lt;/a>&lt;/td>
&lt;td>A CSS preprocessor&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h5 id="structure">Structure&lt;/h5>
&lt;p>The CHT Web Application has the following high level structure:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>/js&lt;/strong>: Contains the vanilla JavaScript scripts, for example: Enketo widgets, MomentJS locales, etc.&lt;/li>
&lt;li>&lt;strong>/ts&lt;/strong>: Contains the Angular application source code which uses TypeScript.
&lt;ul>
&lt;li>&lt;strong>/actions&lt;/strong>, &lt;strong>/effects&lt;/strong>, &lt;strong>/reducers&lt;/strong> and &lt;strong>/selectors&lt;/strong>: Contain the implementation for the application’s reactive state which uses &lt;a href="https://ngrx.io">NgRx&lt;/a> framework.&lt;/li>
&lt;li>&lt;strong>/components&lt;/strong>, &lt;strong>/directives&lt;/strong>, &lt;strong>/pipes&lt;/strong>, &lt;strong>/providers&lt;/strong> and &lt;strong>/services&lt;/strong>: Contain the reusable elements from &lt;a href="https://angular.io/">Angular&lt;/a> framework.&lt;/li>
&lt;li>&lt;strong>/modals&lt;/strong>: Contains the all application’s modals components.&lt;/li>
&lt;li>&lt;strong>/modules&lt;/strong>: Contains the application’s modules, each of them has components that are associated to the modules’ routing.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>/css&lt;/strong>: Contains the style files. It uses &lt;a href="http://lesscss.org/">Less&lt;/a> as a CSS preprocessor.&lt;/li>
&lt;li>&lt;strong>/fonts&lt;/strong>: Contains the fonts.&lt;/li>
&lt;li>&lt;strong>/img&lt;/strong>: Contains the static images.&lt;/li>
&lt;/ul>
&lt;h4 id="app-management">App Management&lt;/h4>
&lt;p>&lt;a href="https://docs.communityhealthtoolkit.org/apps/features/admin/">App Management&lt;/a> is an interface for non-technical administrative users to manage users and settings.&lt;/p>
&lt;p>View the application source code in &lt;a href="https://github.com/medic/cht-core/tree/master/admin">our GitHub repository&lt;/a>.&lt;/p>
&lt;h5 id="technology-1">Technology&lt;/h5>
&lt;p>App Management is a single page application built with &lt;a href="https://angularjs.org">AngularJS&lt;/a> framework and implements &lt;a href="https://github.com/reduxjs/redux">Redux&lt;/a> to manage a reactive state. Additionally, it uses the following technology:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Technology&lt;/th>
&lt;th>Usage&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;a href="https://github.com/angular-translate/angular-translate">Angular Translate&lt;/a>&lt;/td>
&lt;td>To automatically translate the labels from a AngularJS application. Read more about &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/translations/">how to manage translations&lt;/a>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://github.com/karma-runner/karma">Karma&lt;/a>&lt;/td>
&lt;td>A test runner for &lt;a href="https://github.com/medic/cht-core/tree/master/admin/tests">unit tests&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://mochajs.org/">MochaJS&lt;/a>&lt;/td>
&lt;td>A test framework to run the &lt;a href="https://github.com/medic/cht-core/tree/master/admin/tests">unit tests&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://www.protractortest.org/#/">Protractor&lt;/a>&lt;/td>
&lt;td>To run the &lt;a href="https://github.com/medic/cht-core/tree/master/tests/e2e">e2e tests&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="http://lesscss.org/">Less&lt;/a>&lt;/td>
&lt;td>A CSS preprocessor&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h5 id="structure-1">Structure&lt;/h5>
&lt;ul>
&lt;li>&lt;strong>/css&lt;/strong>: Contains style files. It uses &lt;a href="http://lesscss.org/">Less&lt;/a> as a CSS preprocessor.&lt;/li>
&lt;li>&lt;strong>/js&lt;/strong>: Contains the JavaScript code.
&lt;ul>
&lt;li>&lt;strong>/actions&lt;/strong>, &lt;strong>/reducers&lt;/strong> and &lt;strong>/selectors&lt;/strong>: Contain the implementation of &lt;a href="https://github.com/reduxjs/redux">Redux&lt;/a>.&lt;/li>
&lt;li>&lt;strong>/controllers&lt;/strong>, &lt;strong>/directives&lt;/strong>, &lt;strong>/filters&lt;/strong> and &lt;strong>/services&lt;/strong>: Contain the reusable elements from &lt;a href="https://angularjs.org">AngularJS&lt;/a> framework.&lt;/li>
&lt;li>&lt;strong>/modules&lt;/strong>: Contains the vanilla JavaScript scripts.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>/template&lt;/strong>: Contains the HTML templates that are used in the AngularJS components and directives.&lt;/li>
&lt;/ul>
&lt;h3 id="cht-android">cht-android&lt;/h3>
&lt;p>CHT Web Application works in the browser or wrapped in the &lt;a href="https://github.com/medic/cht-android">CHT Android&lt;/a> app which allows for project branding, sets the project URL, and hides browser elements like the URL bar.&lt;/p>
&lt;h2 id="other-applications">Other applications&lt;/h2>
&lt;h3 id="cht-gateway">cht-gateway&lt;/h3>
&lt;p>&lt;a href="https://github.com/medic/cht-gateway">CHT Gateway&lt;/a> is an android app for sending and receiving SMS messages. Each SMS enabled project has one gateway running. It polls an api endpoint to write incoming SMS into the CouchDB and retrieve outgoing SMS to send.&lt;/p>
&lt;h3 id="medic-collect">medic-collect&lt;/h3>
&lt;p>&lt;a href="https://github.com/medic/medic-collect">Medic Collect&lt;/a> is an android app based on &lt;a href="https://opendatakit.org">Open Data Kit&lt;/a> to render xforms on the phone and send reports in to cht-gateway over SMS or directly to api over mobile data.&lt;/p>
&lt;h3 id="cht-conf">cht-conf&lt;/h3>
&lt;p>&lt;a href="https://github.com/medic/cht-conf">cht-conf&lt;/a> is a command line utility for uploading configuration and bulk importing of records.&lt;/p></description></item><item><title>Core: Roadmap</title><link>https://docs.communityhealthtoolkit.org/core/overview/roadmap/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/core/overview/roadmap/</guid><description>
&lt;div class="pageinfo pageinfo-primary">
&lt;p>The CHT is actively developed by &lt;a href="https://medic.org">Medic&lt;/a>, a non-profit organization that serves as the technical steward, alongside many &lt;a href="https://docs.communityhealthtoolkit.org/why-the-cht/#the-cht-community">partners in the CHT Community&lt;/a>.&lt;/p>
&lt;/div>
&lt;p>Improvements for the CHT are raised and discussed with the community in the &lt;a href="https://forum.communityhealthtoolkit.org/c/product/23">Forum&lt;/a>, and tracked in the &lt;a href="https://roadmap.communityhealthtoolkit.org">CHT Roadmap&lt;/a>. The roadmap is organized around &lt;em>&lt;strong>Product initiatives&lt;/strong>&lt;/em>; specific improvement areas that align with medium and long-term vision for the CHT. These initiatives are organized by the ones that are being worked on &lt;em>&lt;strong>Now&lt;/strong>&lt;/em>, those that are likely &lt;em>&lt;strong>Next&lt;/strong>&lt;/em>, and those that might be &lt;em>&lt;strong>Later&lt;/strong>&lt;/em>.&lt;/p>
&lt;h3 id="views">Views&lt;/h3>
&lt;p>The views represent initiatives being tackled by multidisciplinary working groups that focus on different key users: &lt;strong>Care Teams&lt;/strong> for patients, caregivers, CHWs, supervisors; &lt;strong>Allies&lt;/strong> for those that support health systems, like program administrators and app builders; and &lt;strong>Infrastructure&lt;/strong> for CHT hosting service providers and core developers.&lt;/p>
&lt;h3 id="communication">Communication&lt;/h3>
&lt;p>Initiatives are communicated quarterly to the CHT Community on the &lt;a href="https://forum.communityhealthtoolkit.org/c/product/roadmaps/25">CHT Forum&lt;/a> and discussed monthly on the CHT Roundup calls. Please reach out via the &lt;a href="https://forum.communityhealthtoolkit.org/c/product/23">Forum&lt;/a> to discuss your ideas and thoughts on product improvements.&lt;/p></description></item><item><title>Core: Database schema conventions</title><link>https://docs.communityhealthtoolkit.org/core/overview/db-schema/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/core/overview/db-schema/</guid><description>
&lt;p>CouchDB (and PouchDB in the browser) is a JSON-based NoSQL datastore that we use to store our data. While unlike SQL databases there is no enforced schema, code still follows conventions, and this document aims to describe the schema as defined by how our code operates.&lt;/p>
&lt;p>In this document &amp;ldquo;record&amp;rdquo; means a JSON object that resides in CouchDB or PouchDB.&lt;/p>
&lt;h2 id="general-record-data-structure">General record data structure&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Property&lt;/th>
&lt;th>Description&lt;/th>
&lt;th>Required by&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>_id&lt;/code>&lt;/td>
&lt;td>CouchDB&amp;rsquo;s unique identifier of the record&lt;/td>
&lt;td>all records&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>_rev&lt;/code>&lt;/td>
&lt;td>CouchDB&amp;rsquo;s revision marker&lt;/td>
&lt;td>all records&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>type&lt;/code>&lt;/td>
&lt;td>The general type of the document, see below&lt;/td>
&lt;td>all user-created* documents&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>reported_date&lt;/code>&lt;/td>
&lt;td>Numerical timestamp of when the document is first created&lt;/td>
&lt;td>all user-created documents&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;ul>
&lt;li>User-created documents here generally means contacts and reports, but may extend further.&lt;/li>
&lt;/ul>
&lt;h2 id="contacts-persons-and-places">Contacts (Persons and Places)&lt;/h2>
&lt;p>Contacts are either places (e.g. clinic), groupings (e.g. family) or people (e.g. a patient or CHW).&lt;/p>
&lt;p>The &lt;code>type&lt;/code> property of contact records depends on the version of Medic you are running:&lt;/p>
&lt;ul>
&lt;li>If you are running 3.7 or later you get to &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/hierarchy/#app_settingsjson-contact_types">configure your contact hierarchy&lt;/a>, and the &lt;code>type&lt;/code> of contacts is &lt;code>contact&lt;/code>, and the configured type is in the &lt;code>contact_type&lt;/code> property.&lt;/li>
&lt;li>In earlier versions the type depended on hierarchical location of the contact. There are 3 hard coded place types: &lt;code>district_hospital&lt;/code>, &lt;code>health_centre&lt;/code> and &lt;code>clinic&lt;/code> and one people type &lt;code>person&lt;/code>. These place names are often meaningless (hence the configurable contact hierarchy in later versions) to the configured project, and are textually (ie in the UI not in data structures) renamed to mean other things. For example, as &lt;code>clinic&lt;/code> is the lowest level it is often used to represent a family.&lt;/li>
&lt;/ul>
&lt;h3 id="places">Places&lt;/h3>
&lt;p>Represent either an actual physical location such as a clinic, or a grouping such as a family or region.&lt;/p>
&lt;p>Unless a place is at the top of the hierarchy it has a &lt;code>parent&lt;/code> place.&lt;/p>
&lt;p>Each location has a primary contact, which is a &lt;code>person&lt;/code> contact stored in the &lt;code>contact&lt;/code> property.&lt;/p>
&lt;h3 id="people">People&lt;/h3>
&lt;p>People are both patients in the system and users of the system, such as CHWs or Nurses. Users have additional records marking them as users of the system (see &lt;a href="#users">User&lt;/a> below).&lt;/p>
&lt;p>People always have a &lt;code>parent&lt;/code> place.&lt;/p>
&lt;h3 id="parent-hierarchy-representation">Parent hierarchy representation&lt;/h3>
&lt;p>Contacts &lt;strong>store&lt;/strong> their parent hierarchy as a minified hierarchical structure, which records the &lt;code>_id&lt;/code> of each parent up until the top of the hierarchy:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;A patient&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;clinic-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;health_centre-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;district_hospital-id&amp;#39;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Generally when contacts are &lt;strong>used&lt;/strong> in the app they are first &amp;ldquo;hydrated&amp;rdquo;, with the rest of the information filled in from their parent&amp;rsquo;s place documents:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;A patient&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;clinic-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;A clinic&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">reported_date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1234&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// etc
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;health_centre-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;A Health Centre&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">reported_date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1134&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// etc
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;district_hospital-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;THE District Hospital&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">reported_date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1034&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// etc
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;p>&lt;em>See Also&lt;/em>: &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/data/hydration/">Document hydration&lt;/a>&lt;/p>
&lt;p>As of version &lt;strong>3.10&lt;/strong>, you can connect contacts with other documents via the &lt;code>linked_docs&lt;/code> property. This allows the app to have access to these linked documents when the contact is used.&lt;/p>
&lt;p>Like the parent hierarchy, linked docs are stored as a minified object, where every linked doc is identified by a string tag and the UUID of the document it represents.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;A patient&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;clinic-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">linked_docs&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">custom_tag1&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;some-contact-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">custom_tag2&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;other-contact-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">custom_tag3&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;report-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// etc
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Linked docs are shallowly &amp;ldquo;hydrated&amp;rdquo; along with the parent hierarchy:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;A patient&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;clinic-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;A clinic&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">reported_date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1234&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// etc
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;health_centre-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;A Health Centre&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">reported_date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1134&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// etc
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;district_hospital-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;THE District Hospital&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">reported_date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1034&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// etc
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">linked_docs&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">custom_tag1&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;some-contact-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;some contact&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;other-clinic&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">reported_date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4569&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// etc
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">custom_tag2&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;other-contact-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;other contact&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;clinic&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;health_center&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// etc
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">custom_tag3&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;report-id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">form&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;FORM&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;submitter-id&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// etc
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="reports">Reports&lt;/h2>
&lt;p>Reports are created by users filling out and submitting forms, as well as sending in SMS.&lt;/p>
&lt;p>All reports:&lt;/p>
&lt;ul>
&lt;li>Use the &lt;code>data_record&lt;/code> type&lt;/li>
&lt;li>Have their fields stored in the &lt;code>fields&lt;/code> property&lt;/li>
&lt;li>Have the report author&amp;rsquo;s phone number (if it exists) stored in the &lt;code>from&lt;/code> field&lt;/li>
&lt;li>Store the form&amp;rsquo;s identifier in the &lt;code>form&lt;/code> field&lt;/li>
&lt;li>May have a &lt;code>contact&lt;/code> property, which is a minified version of the report author&amp;rsquo;s contact and its hierarchy (see above)&lt;/li>
&lt;/ul>
&lt;p>Reports can be about people or places.&lt;/p>
&lt;p>Reports about people should have one or more of:&lt;/p>
&lt;ul>
&lt;li>A patient shortcode, found at &lt;code>doc.patient_id&lt;/code> or &lt;code>doc.fields.patient_id&lt;/code>&lt;/li>
&lt;li>A patient record&amp;rsquo;s &lt;code>_id&lt;/code>, found at &lt;code>doc.patient_uuid&lt;/code> or &lt;code>doc.fields.patient_uuid&lt;/code>, as well as potientially in the same locations as the shortcode&lt;/li>
&lt;/ul>
&lt;p>Reports about places should have a place&amp;rsquo;s shortcode, found at &lt;code>doc.place_id&lt;/code> or &lt;code>doc.fields.place_id&lt;/code>.&lt;/p>
&lt;p>Additionally, SMS reports:&lt;/p>
&lt;ul>
&lt;li>Have an &lt;code>sms_message&lt;/code> property which contains, among other things, the raw SMS&lt;/li>
&lt;li>May not have a &lt;code>contact&lt;/code> property if the SMS comes from a phone number that does not have an associated contact&lt;/li>
&lt;/ul>
&lt;p>Additionally, XML reports:&lt;/p>
&lt;ul>
&lt;li>Have the XML file that Enketo (the XForm renderer used) generates as an attachment&lt;/li>
&lt;li>Have a &lt;code>content_type&lt;/code> property of &lt;code>xml&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="forms">Forms&lt;/h2>
&lt;p>SMS forms are defined in &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/patient_reports/#app_settingsjson-patient_reports">application config&lt;/a>.&lt;/p>
&lt;p>XML forms are stored in the database and have:&lt;/p>
&lt;ul>
&lt;li>An &lt;code>_id&lt;/code> of &lt;code>form:&amp;lt;formname&amp;gt;&lt;/code>&lt;/li>
&lt;li>The &lt;code>type&lt;/code> of &lt;code>form&lt;/code>&lt;/li>
&lt;li>The actual XML Xforms definition attached&lt;/li>
&lt;/ul>
&lt;p>XML forms are defined as XForm XML files&lt;/p>
&lt;h2 id="users">Users&lt;/h2>
&lt;p>Users represent credentials and roles / permissions for accessing the application. This can either be:&lt;/p>
&lt;ul>
&lt;li>people who can log into the application, such as CHWs or Nurses&lt;/li>
&lt;li>or credentials granting external software restricted permissions to perform certain tasks, such as allowing an external service permission to write reports via the api.&lt;/li>
&lt;/ul>
&lt;p>User records have at least:&lt;/p>
&lt;ul>
&lt;li>An &lt;code>_id&lt;/code> of &lt;code>org.couchdb.user:&amp;lt;username&amp;gt;&lt;/code>&lt;/li>
&lt;li>A &lt;code>name&lt;/code> which is the same as &lt;code>&amp;lt;username&amp;gt;&lt;/code> above&lt;/li>
&lt;li>A &lt;code>roles&lt;/code> array&lt;/li>
&lt;/ul>
&lt;p>There are two slightly different copies of this record stored.&lt;/p>
&lt;p>The record in the &lt;code>_users&lt;/code> database includes:&lt;/p>
&lt;ul>
&lt;li>The &lt;code>type&lt;/code> of &lt;code>user&lt;/code>&lt;/li>
&lt;li>The password hash and associated data&lt;/li>
&lt;/ul>
&lt;p>The &lt;code>_users&lt;/code> database is what CouchDB uses for authentication and is only editable by administrative users, so is authoritive when it comes to roles and the like.&lt;/p>
&lt;p>The &lt;code>medic&lt;/code> database stores a copy of roles and permissions along with:&lt;/p>
&lt;ul>
&lt;li>The &lt;code>type&lt;/code> of &lt;code>user-settings&lt;/code>&lt;/li>
&lt;li>They may have a &lt;code>contact_id&lt;/code> field that is the &lt;code>_id&lt;/code> of the &lt;em>person&lt;/em> that the user is attached to&lt;/li>
&lt;li>They may also have a &lt;code>facility_id&lt;/code> field that is the &lt;code>_id&lt;/code> of the &lt;em>place&lt;/em> that the user is attached to&lt;/li>
&lt;li>They may also have a &lt;code>known&lt;/code> field. If this field is &lt;code>true&lt;/code>, it means the user has logged in once and will no longer be shown the tour by default. Otherwise, it will be &lt;code>undefined&lt;/code>.&lt;/li>
&lt;/ul>
&lt;p>Note that SMS users do not have a users record: their phone number will be attached to a &lt;code>person&lt;/code> record, but they do not have a user because they do not access the application.&lt;/p>
&lt;p>Users then, can be represented by up to 3 docs:&lt;/p>
&lt;ul>
&lt;li>a &lt;code>person&lt;/code> document that represents a physical human being in our hierarchy of places and people&lt;/li>
&lt;li>a &lt;code>users&lt;/code> document that represents authorisation and authentication information for physical people or authenticated external services&lt;/li>
&lt;li>a &lt;code>user-settings&lt;/code> document that ties the &lt;code>user&lt;/code> and &lt;code>person&lt;/code> documents together&lt;/li>
&lt;/ul>
&lt;h2 id="tasks">Tasks&lt;/h2>
&lt;p>&lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/tasks/#tasksjs">Partner configuration code&lt;/a> running inside the Core Framework can cause tasks to appear within the Tasks tab. Each task in the tab is powered by a task document. Task documents are:&lt;/p>
&lt;ul>
&lt;li>updated only after the data for their emitting contact changes or every 7 days&lt;/li>
&lt;li>created in the database for any task due within the last 60 days&lt;/li>
&lt;li>immutable once their state is &amp;ldquo;terminal&amp;rdquo; (Cancelled, Completed, Failed)&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>State&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Draft&lt;/td>
&lt;td>Task has been calculated but it is scheduled in the future&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Ready&lt;/td>
&lt;td>Task is currently showing to the user&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Cancelled&lt;/td>
&lt;td>Task was not emitted when refreshing the requester&amp;rsquo;s data. Task has invalid partner emission.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Completed&lt;/td>
&lt;td>Task was emitted with { resolved: true }&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Failed&lt;/td>
&lt;td>Task was never terminated and the endDate has past&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Attribute&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>user&lt;/td>
&lt;td>The user settings id of the user who calculated and created the document. Used for controlling replication. (eg. &lt;code>org.couchdb.user:agatha&lt;/code>)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>requester&lt;/td>
&lt;td>The guid of the contact whose data brought about the creation of the document. Used for controlling cancellation.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>owner&lt;/td>
&lt;td>The guid of the contact whose profile this task will appear on in the contact&amp;rsquo;s tab.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>forId&lt;/td>
&lt;td>If completing a task&amp;rsquo;s action opens a form. Completing the form creates a report. &lt;code>forId&lt;/code> is the guid of the contact information that will be passed into the form. For most forms, the resulting report will be associated with this contact.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>emission&lt;/td>
&lt;td>Minified task data emitted from the partner code.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>stateHistory&lt;/td>
&lt;td>Each time the state attribute changes, the time of the change is recorded in the state history.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;task~org.couchdb.user:agatha~pregReport~pregnancy-facility-visit-reminder~2~523435132468&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;task&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;authoredOn&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">523435132468&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;user&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;org.couchdb.user:agatha&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;requester&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;requester-contact-guid&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;owner&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;owner-contact-guid&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;state&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Ready&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;emission&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;pregReport~pregnancy-facility-visit-reminder~2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;forId&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;for-contact-guid&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;dueDate&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;2000-01-01&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;startDate&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;1999-12-29&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;endDate&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;2000-01-08&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#a40000">...&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;stateHistory&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;state&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Ready&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">523435132468&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">}],&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="targets">Targets&lt;/h2>
&lt;p>&lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/targets/#targetsjs">Partner configuration code&lt;/a> can configure targets to appear within the Targets/Analytics tab. Target documents are:&lt;/p>
&lt;ul>
&lt;li>one per analytics reporting period&lt;/li>
&lt;li>updated when the user loads the application or when they view the targets tab&lt;/li>
&lt;li>updated a maximum of once per day&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;target~2000-01~user-contact-guid~org.couchdb.user:agatha&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;target&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;user&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;org.couchdb.user:agatha&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;owner&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;user-contact-guid&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;updated_date&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">523435132468&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;targets&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;deaths-this-month&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#a40000">...&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;value&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;pass&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;total&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">15&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#a40000">...&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Core: Offline-First in the CHT</title><link>https://docs.communityhealthtoolkit.org/core/overview/offline-first/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/core/overview/offline-first/</guid><description>
&lt;h2 id="introduction">Introduction&lt;/h2>
&lt;p>CHT applications are designed to be used equally well in areas with no internet connectivity, slow or unreliable internet connectivity, and good internet connectivity. Achieving reliable performance and powerful features requires diligence and strict adherence to the principles of Offline-First development.&lt;/p>
&lt;p>In this page we&amp;rsquo;ll cover why and how we achieve this in the CHT.&lt;/p>
&lt;h2 id="why-this-is-important">Why this is important&lt;/h2>
&lt;p>The CHT is designed to improve healthcare in the hardest to reach communities. While some users have a strong internet connection, to be as inclusive as possible we optimise for Care Teams with connections that are intermittent, unreliable, expensive, and low bandwidth. To achieve this the CHT is designed to be offline first, which, as the name suggests, means the application never relies on an internet connection for day to day tasks.&lt;/p>
&lt;p>Caveat: a small set of use cases require a decent internet connection, but these are limited to:&lt;/p>
&lt;ul>
&lt;li>Logging in&lt;/li>
&lt;li>Initial download of the application and data&lt;/li>
&lt;li>Changing your own password&lt;/li>
&lt;li>Most administrative tasks such as creating new users&lt;/li>
&lt;li>Data analytics over large data sets&lt;/li>
&lt;/ul>
&lt;h2 id="requirements">Requirements&lt;/h2>
&lt;h3 id="code">Code&lt;/h3>
&lt;p>The CHT uses a &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers">Service Worker&lt;/a> to store the code needed to start up and run which is best practice for caching web applications. The CHT Core Framework code is downloaded when the user visits the login page for the first time and completes silently in the background while the user logs in.&lt;/p>
&lt;p>The code includes JavaScript, CSS, HTML, fonts, and images. It doesn&amp;rsquo;t contain any private information so it&amp;rsquo;s safe to download and cache it without authentication. It also doesn&amp;rsquo;t contain deployment specific configuration (covered in detail &lt;a href="#data">below&lt;/a>).&lt;/p>
&lt;p>The CHT Core Framework checks for updates to the code by attempting to connect to the server in the background. The user isn&amp;rsquo;t notified if this check fails or times out, so they can continue to complete workflows without interruption. When an update is found the new code is downloaded and the service worker cache is updated. The user is prompted to reload to start using the new version of the application, but this can be dismissed if they are busy with a patient or don&amp;rsquo;t want to lose their progress if they are midway through an action like creating a contact or completing a form. Either way, the update will be automatically applied the next time the application starts up.&lt;/p>
&lt;h3 id="data">Data&lt;/h3>
&lt;p>Once the application has started up it needs data to be useful. This data falls into two categories:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Configuration&lt;/strong> specific to a single deployment such as forms, task definitions, places, and hierarchies.&lt;/li>
&lt;li>&lt;strong>Patient data&lt;/strong> such as personal details, information about visits, reports, tasks, and messages.&lt;/li>
&lt;/ul>
&lt;p>Both of these types of data are cached on the device because they are required for the user to do their job. The CHT Core Framework uses &lt;a href="https://pouchdb.com/">PouchDB&lt;/a> to store the data on the device&amp;rsquo;s disk. Once cached, when the application starts up the code is executed, which reads the data, allowing the user to do their job regardless of the quality of their internet connection.&lt;/p>
&lt;p>If the user creates new patient data by registering a family or completing a task the application stores this in the phone&amp;rsquo;s cache and attempts to submit this to the server. Periodically the application checks to see if there is new data on the server that is relevant to the user and if so, it updates the cache. This process of sending and receiving data updates is called &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/performance/replication/">replication&lt;/a>, and is performed without interrupting the user from their work.&lt;/p>
&lt;h2 id="faqs-from-cht-contributors">FAQs from CHT contributors&lt;/h2>
&lt;h3 id="q-should-i-rely-on-request-failure-handling">Q: Should I rely on request failure handling?&lt;/h3>
&lt;p>A: No. This only works well when the user has a strong connection, or if the user is completely offline and the request fails immediately. It&amp;rsquo;s impossible to know for sure how long the request will take, so users with poor connectivity may end up waiting forever. If this request is essential to doing their job they will be unable to move on. It is important to handle request failures gracefully, but it doesn&amp;rsquo;t make a request offline first.&lt;/p>
&lt;h3 id="q-should-i-rely-on-a-request-timeout">Q: Should I rely on a request timeout?&lt;/h3>
&lt;p>A: No. This attempts to mitigate the problem by unblocking the user eventually. The problem is setting the timeout length correctly - if it&amp;rsquo;s too short then the request won&amp;rsquo;t succeed, but if it&amp;rsquo;s too long the user will be required to wait. Experience suggests the timeout for a simple request would have to be around a minute to allow the request to succeed for most users, but a minute is far too long to expect a user to wait. Almost all requests should have a timeout, but that is not sufficient to make a request offline first.&lt;/p>
&lt;h3 id="q-should-i-rely-on-a-spinner-or-loading-bar">Q: Should I rely on a spinner or loading bar?&lt;/h3>
&lt;p>A: No. Much like the timeout solution, this is an attempt to mitigate the problem in this case by giving the user more information about the request. Regardless of the UX, blocking user interaction while waiting for a response is not offline first and therefore not appropriate for the CHT. Showing UX elements when loading is still recommended for local requests, user initiated server requests, and other potentially slow operations.&lt;/p>
&lt;h3 id="q-how-can-i-check-if-the-user-is-authenticated">Q: How can I check if the user is authenticated?&lt;/h3>
&lt;p>A: It is not possible to know for certain if a user has an active session without getting a response from the server. The CHT caches some data to hint at whether the session is still active, for example the session expiry date. However, the only way to be certain is to connect to the server, which is not offline first. This has been implemented in the CHT by checking the status code on background requests such as replication, and instructing the user to login when necessary.&lt;/p>
&lt;h3 id="q-should-i-rely-on-apis-which-report-device-connection-status">Q: Should I rely on APIs which report device connection status?&lt;/h3>
&lt;p>A: No. There are &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/onLine">APIs available&lt;/a> which report whether the device is online with reasonable reliability. Unfortunately these APIs don&amp;rsquo;t reliably report whether the connection is slow, whether the connection will be held until the request completes, or whether the CHT server is available. This means that even if the browser API reports that the device is online the code will still make a request that may fail or wait indefinitely for a response. These APIs can be useful but must be used in conjunction with Offline-First principles, for example, the CHT uses the &amp;ldquo;online&amp;rdquo; event listener as a prompt to attempt replication in the background.&lt;/p>
&lt;h3 id="q-should-i-add-a-feature-that-requires-a-connection">Q: Should I add a feature that requires a connection?&lt;/h3>
&lt;p>A: Maybe. There are some things that cannot be done offline first because they either require server interaction (eg: authentication during login) or they need to access data that cannot be cached locally (eg: deployment-wide analytics). Every effort should be made to find a way to implement the feature using Offline-First principles, and trade-offs discussed with senior CHT contributors. If the feature truly needs to be online first then the UX needs to be designed so that the user understands the feature requires an internet connection.&lt;/p>
&lt;h2 id="further-reading">Further reading&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://alistapart.com/article/offline-first/">Designing Offline-First Web Apps&lt;/a> by A List Apart&lt;/li>
&lt;li>&lt;a href="https://hasura.io/blog/design-guide-to-offline-first-apps/">A Design Guide for Building Offline First Apps&lt;/a> by Hasura&lt;/li>
&lt;li>&lt;a href="https://blog.couchdb.org/2017/09/19/couchdb-takes-medic-mobile-to-the-front-lines-of-healthcare-work/">CouchDB takes CHT to the front lines of healthcare work&lt;/a> by CouchDB&lt;/li>
&lt;/ul></description></item><item><title>Core: Data Flows for Analytics</title><link>https://docs.communityhealthtoolkit.org/core/overview/data-flows-for-analytics/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/core/overview/data-flows-for-analytics/</guid><description>
&lt;p>In this section, we focus on how data flows through the various components of the Community Health Toolkit. The CHT is built to support the delivery of quality community health care at the last mile. The CHT is designed to work in areas with low connectivity, which means it is an &lt;a href="https://docs.communityhealthtoolkit.org/core/overview/offline-first/">Offline-First&lt;/a> toolkit for care provision. The architectural and technology choices in the stack are mostly guided by this principle, which will be evident in the discussion of the data management pipeline.&lt;/p>
&lt;h2 id="overview">Overview&lt;/h2>
&lt;p>&lt;img src="data-flows.png" alt="Data Flows">&lt;/p>
&lt;p>At a high level:&lt;/p>
&lt;ul>
&lt;li>Data are collected from the device of a health worker;&lt;/li>
&lt;li>Data are pushed to an online instance from where data are available to other health workers, supervisors, and decision makers;&lt;/li>
&lt;li>Data are transferred to a relational database (PostgreSQL) using &lt;a href="https://github.com/medic/medic-couch2pg">couch2pg&lt;/a> and made available for impact monitoring, data science projects, and visualizations;&lt;/li>
&lt;li>Access to PostreSQL is given to relevant parties at this level, for example members of the Research &amp;amp; Learning team for impact monitoring and data science;&lt;/li>
&lt;li>Visualization platforms, such as &lt;a href="https://www.klipfolio.com/">Klipfolio&lt;/a>, are then connected to PostgreSQL from where program managers and other partner representatives can access visualizations of their data for decision-making&lt;/li>
&lt;/ul>
&lt;h2 id="details-of-the-data-flow">Details of the data flow&lt;/h2>
&lt;p>The layout detailed here is specific to how Medic supports its CHT partners at the moment. It is replicable and can be deployed as is or tweaked independent of Medic either by modifying or replacing pieces of it with other options.&lt;/p>
&lt;h3 id="current-infrastructure">Current infrastructure&lt;/h3>
&lt;p>We look at this in three general phases.&lt;/p>
&lt;h4 id="1-data-collection">1. Data Collection&lt;/h4>
&lt;p>Data is collected in the community at the point of care, i.e. the community health worker interacting with the toolkit. These tools and their corresponding data stores are::-&lt;/p>
&lt;ul>
&lt;li>Mobile app -&amp;gt; PouchDB&lt;/li>
&lt;li>Webapp -&amp;gt; PouchDB / CouchDB&lt;/li>
&lt;li>Text forms / sms -&amp;gt; SMS gateway / SMS aggregator -&amp;gt; CouchDB&lt;/li>
&lt;/ul>
&lt;p>The mobile app and webapp, when deployed for offline first use, use a local database namely PouchDB. Similar to CouchDB, it is a document-oriented database. The data collected in PouchDB is synced to an online CouchDB upon the user connecting to the internet. Local storage is not applicable to SMS; instead, an &lt;a href="https://github.com/medic/cht-gateway">SMS gateway&lt;/a> or an SMS aggregator (for example &lt;a href="https://africastalking.com">Africa&amp;rsquo;s Talking&lt;/a>) is used to help get the data to an online CouchDB instance.&lt;/p>
&lt;p>Ultimately all the data ends up in a CouchDB instance deployed in the cloud whether through data synchronization with PouchDB local to the health workers devices, use of SMS aggregators or gateway. It should be mentioned that you can have a deployment supported by all of webapp, mobile app and SMS and have all the data end up in the same CouchDB instance.&lt;/p>
&lt;h4 id="2-data-transformation">2. Data Transformation&lt;/h4>
&lt;p>We use &lt;a href="https://github.com/medic/medic-couch2pg">couch2pg&lt;/a> to move data from CouchDB to a relational database, PostgreSQL in this case. The choice of PostgreSQL for analytics dashboard data sources is to allow use of the more familiar SQL querying. It is an open source tool that can be &lt;a href="https://github.com/medic/medic-couch2pg#user-content-installation-steps-if-applicable">easily deployed&lt;/a>. When deployed the service uses &lt;a href="https://docs.couchdb.org/en/stable/api/database/changes.html">CouchDB&amp;rsquo;s changes feed&lt;/a> which allows capturing of everything happening in CouchDB in incremental updates. It is run and monitored by the operating system where it is configured to fetch data at a configurable interval.&lt;/p>
&lt;p>Data copied over to PostgreSQL is first stored as raw json (document) making use of PostgreSQL&amp;rsquo;s jsonb data type to create an exact replica of a CouchDB database. From this, default views are created at deployment of the service and refreshed during every subsequent run. Additional custom materialized views created later are also refreshed at this time.&lt;/p>
&lt;p>Custom materialized views and functions are added specific to a deployment&amp;rsquo;s needs. Generally the following naming convention is recommended:&lt;/p>
&lt;ul>
&lt;li>&lt;em>formview&lt;/em> as a view of raw forms&lt;/li>
&lt;li>&lt;em>useview&lt;/em> as a view of form data supporting a use case as defined by design&lt;/li>
&lt;li>&lt;em>contactview&lt;/em> as a view of people and places&lt;/li>
&lt;li>Database functions are used as a way to join as much relevant data as possible for easier querying in analytics or dashboard visualizations.&lt;/li>
&lt;/ul>
&lt;p>Data in the views and functions mentioned in this section is as accurate as the accuracy of the SQL queries. Best practice is to begin the process of defining these objects at design in order to align analytics and dashboards requirements with workflows being deployed.&lt;/p>
&lt;h4 id="3-data-use">3. Data Use&lt;/h4>
&lt;p>The data in PostgreSQL is mostly either used by direct querying or via dashboard visualizations for impact monitoring and data driven-decision making. Database visualizations are built scoped to the requirements of supporting a successful deployment. The work of our Research &amp;amp; Learning team, specifically data science, is supported at the PostgreSQL level through updated contactviews, formviews, useviews and functions with access to these provided to relevant parties as and when needed. Our use of data follows our Privacy &amp;amp; Data Protection policy and is in accordance to agreements with our CHT partners.&lt;/p>
&lt;p>As mentioned previously, formviews are built to present data in a structure similar to the data collection tool (form) used. Useviews are tailored to align with a use case, mostly using the formviews as the data sources. These are fundamentally guided by design of the workflows and should be interpreted in the context of the design materials including a document explaining the definitions of variables used.&lt;/p>
&lt;p>The objects present here are not limited to views and functions. Additional tables can be added, for example providing mappings or supporting operations external to the functions available in the toolkit. In short, there is no limitation to the utility that can be added this level to support analytics and dashboards. That said, measures are taken to ensure controlled access, reliability and timely access of the data by the various parties. Some of these measures are:&lt;/p>
&lt;ul>
&lt;li>Roles and users allocation and deallocation done by specific roles within partner technical teams with support from Medic as needed;&lt;/li>
&lt;li>Access control management is left to the partner technical teams where possible;&lt;/li>
&lt;li>Dashboard data source refresh intervals set to align with project needs;&lt;/li>
&lt;li>Update of the data sources monitored to ensure updating works as expected;&lt;/li>
&lt;li>Review of the dashboards as part of the design process;&lt;/li>
&lt;li>Qualitative design activities to interrogate trends observed in the dashboards and iterate on them if need be;&lt;/li>
&lt;/ul>
&lt;h3 id="beyond-our-current-pipeline">Beyond Our Current Pipeline&lt;/h3>
&lt;p>The &lt;a href="https://github.com/medic/cht-core">cht-core&lt;/a> is mostly data collection tools and is the first component of the data management pipeline. It is the core part of a deployment but the rest of the tools can be easily replaced with other preferred options. It also helps that couch2pg is an open source tool which provides the opportunity for collaboration to extend its functionality to support other implementations. Klipfolio, the tool that we currently use for visualizations, is a proprietary tool but there are many open source options, such as &lt;a href="https://superset.incubator.apache.org/">Apache Superset&lt;/a> that are worth exploring and building into future iterations of our impact monitoring and analytics support for the CHT.&lt;/p>
&lt;h2 id="backup">Backup&lt;/h2>
&lt;p>The machines running each of CouchDB and PostgreSQL instances are backed up daily.&lt;/p></description></item><item><title>Core: Sentinel Transitions</title><link>https://docs.communityhealthtoolkit.org/core/overview/transitions/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/core/overview/transitions/</guid><description>
&lt;p>A transition is javascript code that runs when a document is changed. A
transition can edit the changed doc or do anything server side code can do for
that matter.&lt;/p>
&lt;p>Transitions are run in series, not in parallel:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>For a given change, you can expect one transition to be finished before the
next runs.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>You can expected one change to be fully processed by all transitions before
the next starts being processed.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Transitions obey the following rules:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>has a &lt;code>filter(doc)&lt;/code> function that accepts the changed document as an argument and
returns &lt;code>true&lt;/code> if it needs to run/be applied.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>a &lt;code>onMatch(change, db, auditDb, callback)&lt;/code> function than will run on changes
that pass the filter.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>can have an &lt;code>init()&lt;/code> function to do any required setup and throw Errors on invalid
configuration.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>has an &lt;code>onChange(change, db, audit, callback)&lt;/code> function that makes changes to
the &lt;code>change.doc&lt;/code> reference (copying is discouraged). &lt;code>db&lt;/code> and &lt;code>audit&lt;/code> are
handles to let you query those DBs. More about &lt;code>callback&lt;/code> below.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>It is not necessary for an individual transition to save the changes to &lt;code>change.doc&lt;/code> to the db: the doc will be saved once, after all the transitions have edited it.
If an individual transition saves the document provided at &lt;code>change.doc&lt;/code>, it takes responsibility re-attaching the newly saved document (with new seq etc) at &lt;code>change.doc&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>guarantees the consistency of a document.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>runs serially and in any order. A transition is free to make async calls but
the next transition will only run after the previous transitions&amp;rsquo;s callback
is called. If your transition is dependent on another transition then it will
run on the next change. Code your transition to support two changes rather
than require a specific ordering. You can optimize your ordering but don&amp;rsquo;t
require it. This keeps configuration simpler.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>is repeatable, it can run multiple times on the same document without
negative effect. You can use the &lt;code>transitions&lt;/code> property on a document to
determine if a transition has run.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Callback arguments:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>callback(err, needsSaving)&lt;/p>
&lt;p>&lt;code>needsSaving&lt;/code> is true if the &lt;code>change.doc&lt;/code> needs to be saved to db by the transition runner. For instance the transition has edited the &lt;code>change.doc&lt;/code> in memory.
&lt;code>err&lt;/code> if truthy, the error will be added to the &lt;code>changes.doc&lt;/code> in memory. (Note that if &lt;code>needsSaving&lt;/code> is falsy, the doc will not be saved, so that error will not be persisted).&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Regardless whether the doc is saved or not, the transitions will all be run (unless one crashes!).&lt;/p>
&lt;p>When your transition encounters an error, there are different ways to deal with it. You can :&lt;/p>
&lt;ul>
&lt;li>finish your transition with &lt;code>callback(someError, true)&lt;/code>. This will save the error to &lt;code>change.doc&lt;/code>.&lt;/li>
&lt;li>finish your transition with &lt;code>callback(someError, false)&lt;/code>. The error will be logged to the sentinel log. This will not save the error on the &lt;code>change.doc&lt;/code>, so there will be no record that this transition ran. That particular &lt;code>change&lt;/code> will not go through transitions again, but if the same doc has another change in the future, since there is no record of the erroring transition having run, it will be rerun.&lt;/li>
&lt;li>crash sentinel. When sentinel restarts, since that &lt;code>change&lt;/code> did not record a successful processing, it will be reprocessed. Transitions that did not save anything to the &lt;code>change.doc&lt;/code> will be rerun.&lt;/li>
&lt;/ul></description></item><item><title>Core: How To Manage Translations</title><link>https://docs.communityhealthtoolkit.org/core/overview/translations/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/core/overview/translations/</guid><description>
&lt;p>Apps built with CHT Core are localized so that users can use it in the language of their choice. It is currently available in English, French, Hindi, Nepali, Spanish, and Swahili. The goal of this doc is to help our team manage these and future translations.&lt;/p>
&lt;h2 id="overview">Overview&lt;/h2>
&lt;p>Like the rest of our code, the translation files live in our GitHub repo. These translation files are &lt;a href="https://en.wikipedia.org/wiki/.properties">properties&lt;/a> files, which are a series of keys and their corresponding values. We use the English file as our default, and as such contains the entire set of keys. If any key is missing from another language file the English value is used.&lt;/p>
&lt;p>In order to collaboratively edit the translations we use POEditor.com. Translators can be given access to specific languages so that we can more effectively edit language text to be included in CHT Core. Once the text is ready it can be exported from POEditor to GitHub and included in the next release of our app.&lt;/p>
&lt;p>Note that &amp;ldquo;keys&amp;rdquo; in .properties files are referred to as &lt;code>terms&lt;/code> in POEditor.&lt;/p>
&lt;h2 id="adding-new-languages">Adding new languages&lt;/h2>
&lt;p>New languages must be added and configured in several places:&lt;/p>
&lt;ul>
&lt;li>&lt;em>In GitHub&lt;/em>
&lt;ul>
&lt;li>Create a new &lt;a href="https://github.com/medic/cht-core/tree/master/ddocs/medic/_attachments/translations">ddocs/medic/_attachments/translations/messages-XX.properties&lt;/a> file, replacing XX with the 2 or 3 letter language code.&lt;/li>
&lt;li>Add the language to the &lt;a href="https://github.com/medic/cht-core/blob/master/api/src/translations.js#L8">&lt;code>LOCAL_NAME_MAP&lt;/code> in api&lt;/a>. Use the language code for the key, and the local name followed by the English name for the language in brackets, eg: &amp;ldquo;fr: &amp;lsquo;Français (French)'&amp;quot;.&lt;/li>
&lt;li>Import the moment language pack in the &lt;a href="https://github.com/medic/cht-core/blob/3.11.x/webapp/src/ts/main.ts#L23">main.ts file&lt;/a>. If moment doesn&amp;rsquo;t provide the required language pack you may need to contribute it upstream to the moment library.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;em>In POEditor&lt;/em>
&lt;ul>
&lt;li>In the &lt;a href="https://poeditor.com/projects/view?id=33025">CHT Core project&lt;/a>, add the language&lt;/li>
&lt;li>Add translations for a new language in the POEditor app&lt;/li>
&lt;li>Export file from POEditor to GitHub, as described below&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="adding-new-keys">Adding new keys&lt;/h2>
&lt;p>In order to trace the addition of new terms and also updates to existing translations,
the default translation file (messages-en.properties) must be updated directly.
Our GitHub repo provides with a &lt;a href="https://github.com/medic/cht-core/tree/master/scripts/poe">command line tool (CLI)&lt;/a> to
import updates into the POEditor app.
If you don&amp;rsquo;t have an API token, please contact a Medic developer. Please do not disclose this API token to anyone else.&lt;/p>
&lt;h3 id="translating-static-text">Translating static text&lt;/h3>
&lt;p>All text in the app is internationalised.&lt;/p>
&lt;ul>
&lt;li>Pick a key.
&lt;ul>
&lt;li>First check if an appropriate key already exists in messages-en.properties (medic/config/standard/translations).&lt;/li>
&lt;li>Otherwise create a new key and default English value. Keys must be all lower case, dot separated, and descriptive but not verbose. The values should include as much text as possible (eg: trailing punctuation), and must not contain any markup. Don&amp;rsquo;t add any values for other languages as this will be done later in the POEditor app.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Use the translation. In angular this is done using angular-translate, and ideally using the &lt;a href="http://angular-translate.github.io/docs/#/guide/05_using-translate-directive">translate directive&lt;/a> to reduce the number of watchers, eg: &lt;code>&amp;lt;h3 translate&amp;gt;date.incorrect.title&amp;lt;/h3&amp;gt;&lt;/code>.&lt;/li>
&lt;/ul>
&lt;h3 id="translating-help-pages">Translating help pages&lt;/h3>
&lt;p>Because help pages are too large to manage easily through the standard translation mechanism, and we want to include lots of markup, help pages are translated by providing md documents for each language. This isn&amp;rsquo;t yet up and running so ask for help.&lt;/p>
&lt;h3 id="translating-configurations">Translating configurations&lt;/h3>
&lt;p>Much of the app is configurable (eg: forms and schedules). Because the specifics of the configuration aren&amp;rsquo;t known during development time these can&amp;rsquo;t be provided via messages. Instead we allow configurers to provide a map of locale to value for each translated property. Then use the &lt;code>translateFrom&lt;/code> filter to translate from the configured map using the user&amp;rsquo;s language.&lt;/p>
&lt;h2 id="modifying-any-existing-translation-values">Modifying any existing translation values&lt;/h2>
&lt;p>To be done &lt;em>only&lt;/em> by updating messages-en.properties, importing to POEditor through the CLI tool and updating the other language translations through the POEditor app.&lt;/p>
&lt;h2 id="modifying-or-removing-translation-keys">Modifying or removing translation keys:&lt;/h2>
&lt;p>To be done &lt;em>only&lt;/em> by updating messages-en.properties and importing to POEditor through the CLI tool.&lt;/p>
&lt;h2 id="exporting-changes-from-poeditor-to-github">Exporting changes from POEditor to GitHub&lt;/h2>
&lt;p>To be done &lt;em>only&lt;/em> by exporting all translations through the CLI tool.
If you don&amp;rsquo;t have an API token, please contact a Medic developer. Please do not disclose this API token to anyone else.&lt;/p></description></item></channel></rss>