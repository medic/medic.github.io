<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Community Health Toolkit â€“ Reference Documentation</title><link>https://docs.communityhealthtoolkit.org/apps/reference/</link><description>Recent content in Reference Documentation on Community Health Toolkit</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://docs.communityhealthtoolkit.org/apps/reference/index.xml" rel="self" type="application/rss+xml"/><item><title>Apps: API to interact with CHT Applications</title><link>https://docs.communityhealthtoolkit.org/apps/reference/api/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/apps/reference/api/</guid><description>
&lt;style>
.td-content #TableOfContents ul ul ul {
display: none;
}
&lt;/style>
&lt;div class="pageinfo pageinfo-primary">
&lt;p>This page covers the endpoints to use when integrating with the CHT server. If there isn&amp;rsquo;t an endpoint that provides the function or data you need, direct access to the database is possible via the &lt;a href="https://docs.couchdb.org/en/stable/api/index.html">CouchDB API&lt;/a>. Access to the &lt;a href="https://docs.communityhealthtoolkit.org/core/overview/data-flows-for-analytics/">PostgreSQL database&lt;/a> may also prove useful for data analysis. If additional endpoints would be helpful, please make suggestions via a &lt;a href="https://github.com/medic/cht-core/issues/new/choose">GitHub issue&lt;/a>.&lt;/p>
&lt;/div>
&lt;nav id="TableOfContents">
&lt;ul>
&lt;li>&lt;a href="#settings">Settings&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#get-apiv1settings">GET /api/v1/settings&lt;/a>&lt;/li>
&lt;li>&lt;a href="#put-apiv1settings">PUT /api/v1/settings&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#query-parameters">Query Parameters&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#export">Export&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#get-apiv2exportdhis">GET /api/v2/export/dhis&lt;/a>&lt;/li>
&lt;li>&lt;a href="#get-apiv2exportreports">GET /api/v2/export/reports&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#query-parameters-1">Query parameters&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#get-apiv2exportmessages">GET /api/v2/export/messages&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#output">Output&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples">Examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#get-apiv2exportfeedback">GET /api/v2/export/feedback&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#query-parameters-2">Query Parameters&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#get-apiv2exportcontacts">GET /api/v2/export/contacts&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#query-parameters-3">Query parameters&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#forms">Forms&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#get-apiv1forms">GET /api/v1/forms&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#headers">Headers&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-1">Examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#get-apiv1formsidformat">GET /api/v1/forms/{{id}}.{{format}}&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#parameters">Parameters&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-2">Examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#post-apiv1formsvalidate">POST /api/v1/forms/validate&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#headers-1">Headers&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-3">Examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#records">Records&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#post-apiv2records">POST /api/v2/records&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#headers-2">Headers&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-4">Examples&lt;/a>&lt;/li>
&lt;li>&lt;a href="#errors">Errors&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#sms">SMS&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#post-apisms">POST /api/sms&lt;/a>&lt;/li>
&lt;li>&lt;a href="#post-apiv1smsaggregatorendpoint">POST /api/v1/sms/{aggregator}/{endpoint}&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#people">People&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#supported-properties">Supported Properties&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#required">Required&lt;/a>&lt;/li>
&lt;li>&lt;a href="#optional">Optional&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#post-apiv1people">POST /api/v1/people&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#permissions">Permissions&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-5">Examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#places">Places&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#supported-properties-1">Supported Properties&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#required-properties">Required Properties&lt;/a>&lt;/li>
&lt;li>&lt;a href="#optional-properties">Optional Properties&lt;/a>&lt;/li>
&lt;li>&lt;a href="#place-types">Place Types&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#post-apiv1places">POST /api/v1/places&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#permissions-1">Permissions&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-6">Examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#post-apiv1placesid">POST /api/v1/places/{{id}}&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#permissions-2">Permissions&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-7">Examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#users">Users&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#supported-properties-2">Supported Properties&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#login-by-sms">Login by SMS&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#get-apiv1users">GET /api/v1/users&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#permissions-3">Permissions&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-8">Examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#get-apiv2users">GET /api/v2/users&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#permissions-4">Permissions&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-9">Examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#post-apiv1users">POST /api/v1/users&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#permissions-5">Permissions&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-10">Examples&lt;/a>&lt;/li>
&lt;li>&lt;a href="#errors-1">Errors&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#post-apiv2users">POST /api/v2/users&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#logging">Logging&lt;/a>&lt;/li>
&lt;li>&lt;a href="#headers-3">Headers&lt;/a>&lt;/li>
&lt;li>&lt;a href="#permissions-6">Permissions&lt;/a>&lt;/li>
&lt;li>&lt;a href="#example">Example&lt;/a>&lt;/li>
&lt;li>&lt;a href="#errors-2">Errors&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#post-apiv1usersusername">POST /api/v1/users/{{username}}&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#permissions-7">Permissions&lt;/a>&lt;/li>
&lt;li>&lt;a href="#updating-yourself">Updating yourself&lt;/a>&lt;/li>
&lt;li>&lt;a href="#url-parameters">URL Parameters&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-11">Examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#delete-apiv1usersusername">DELETE /api/v1/users/{{username}}&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#permissions-8">Permissions&lt;/a>&lt;/li>
&lt;li>&lt;a href="#url-parameters-1">URL Parameters&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-12">Examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#get-apiv1users-info">GET /api/v1/users-info&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#example-1">Example&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#bulk-operations">Bulk Operations&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#post-apiv1bulk-delete">POST /api/v1/bulk-delete&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#permissions-9">Permissions&lt;/a>&lt;/li>
&lt;li>&lt;a href="#parameters-1">Parameters&lt;/a>&lt;/li>
&lt;li>&lt;a href="#errors-3">Errors&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-13">Examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#monitoring">Monitoring&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#get-apiv1monitoring">GET /api/v1/monitoring&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#permissions-10">Permissions&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-14">Examples&lt;/a>&lt;/li>
&lt;li>&lt;a href="#response-content">Response content&lt;/a>&lt;/li>
&lt;li>&lt;a href="#errors-4">Errors&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#get-apiv2monitoring">GET /api/v2/monitoring&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#permissions-11">Permissions&lt;/a>&lt;/li>
&lt;li>&lt;a href="#examples-15">Examples&lt;/a>&lt;/li>
&lt;li>&lt;a href="#response-content-1">Response content&lt;/a>&lt;/li>
&lt;li>&lt;a href="#errors-5">Errors&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#upgrades">Upgrades&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#post-apiv1upgrade">POST /api/v1/upgrade&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#example-3">Example&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#post-apiv1upgradestage">POST /api/v1/upgrade/stage&lt;/a>&lt;/li>
&lt;li>&lt;a href="#post-apiv1upgradecomplete">POST /api/v1/upgrade/complete&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#hydrate">Hydrate&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#get-apiv1hydrate">GET /api/v1/hydrate&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#query-parameters-5">Query parameters&lt;/a>&lt;/li>
&lt;li>&lt;a href="#example-4">Example&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#post-apiv1hydrate">POST /api/v1/hydrate&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#parameters-2">Parameters&lt;/a>&lt;/li>
&lt;li>&lt;a href="#example-5">Example&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#contacts-by-phone">Contacts by phone&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#get-apiv1contacts-by-phone">GET /api/v1/contacts-by-phone&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#query-parameters-6">Query parameters&lt;/a>&lt;/li>
&lt;li>&lt;a href="#example-6">Example&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#post-apiv1contacts-by-phone">POST /api/v1/contacts-by-phone&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#parameters-3">Parameters&lt;/a>&lt;/li>
&lt;li>&lt;a href="#example-7">Example&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#replication-limit">Replication Limit&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#get-apiv1users-doc-count">GET /api/v1/users-doc-count&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#query-parameters-7">Query parameters&lt;/a>&lt;/li>
&lt;li>&lt;a href="#example-8">Example&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#credentials">Credentials&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#put-apiv1credentials">PUT /api/v1/credentials&lt;/a>&lt;/li>
&lt;li>&lt;a href="#3x-api">3.x API&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/nav>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
&lt;p>Various properties throughout this API use a timestamp value, the
following formats are supported:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ISO 8601 combined date and time with timezone of the format below where &amp;ldquo;Z&amp;rdquo;
is offset from UTC like &amp;ldquo;-03&amp;rdquo;, &amp;ldquo;+1245&amp;rdquo;, or just &amp;ldquo;Z&amp;rdquo; which is UTC (0 offset);&lt;/p>
&lt;pre>&lt;code> YYYY-MM-DDTHH:mm:ssZ
YYYY-MM-DDTHH:mm:ss.SSSZ
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;p>Milliseconds since Unix Epoch&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>A compatible value can be generated using the &lt;code>toISOString&lt;/code> or &lt;code>toValue&lt;/code> method
on a Javascript Date object.&lt;/p>
&lt;h5 id="examples">Examples&lt;/h5>
&lt;ul>
&lt;li>2011-10-10T14:48:00-0300&lt;/li>
&lt;li>2016-07-01T13:48:24+00:00&lt;/li>
&lt;li>2016-07-01T13:48:24Z&lt;/li>
&lt;li>1467383343484 (MS since Epoch)&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h2 id="settings">Settings&lt;/h2>
&lt;p>Get and update the app settings.&lt;/p>
&lt;h3 id="get-apiv1settings">GET /api/v1/settings&lt;/h3>
&lt;p>Returns the settings in JSON format.&lt;/p>
&lt;h3 id="put-apiv1settings">PUT /api/v1/settings&lt;/h3>
&lt;h4 id="query-parameters">Query Parameters&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>overwrite&lt;/td>
&lt;td>Whether to replace settings document with input document. If both replace and overwite are set, then it overwites only. Defaults to replace.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>replace&lt;/td>
&lt;td>Whether to replace existing settings for the given properties or to merge. Defaults to false (merging).&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Returns a JSON object with two fields:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;success&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;upgraded&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>success&lt;/td>
&lt;td>Boolean&lt;/td>
&lt;td>Always &lt;code>true&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>upgraded&lt;/td>
&lt;td>Boolean&lt;/td>
&lt;td>Whether the settings doc was updated or not&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="export">Export&lt;/h2>
&lt;p>Request different types of data in various formats.&lt;/p>
&lt;p>Each of the export endpoints except contacts and feedback supports a parameter which returns date formatted in human readable form (ISO 8601). Setting this parameter to false or leaving it out will return dates formatted as an epoch timestamp.&lt;/p>
&lt;p>To set this parameter for a GET request use:&lt;/p>
&lt;pre tabindex="0">&lt;code>http://admin:pass@localhost:5988/api/v2/export/messages?options[humanReadable]=true
&lt;/code>&lt;/pre>&lt;p>To set this parameter for a POST request submit this as the request body:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;options&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;humanReadable&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="get-apiv2exportdhis">GET /api/v2/export/dhis&lt;/h3>
&lt;p>Exports target data formatted as a DHIS2 dataValueSet. The data can be filtered to a specific section of the contact hierarchy or for a given time interval.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Parameter&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>dataSet&lt;/td>
&lt;td>A DHIS2 dataSet ID. Targets associated with this dataSet will have their data aggregated. (required)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>date.from&lt;/td>
&lt;td>Filter the target data to be aggregated to be within the month of this timestamp. (required)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>orgUnit&lt;/td>
&lt;td>Filter the target data to only that associated with contacts with attribute &lt;code>{ dhis: { orgUnit } }&lt;/code>. (optional)&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;filters&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;dataSet&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;VMuFODsyWaO&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;date&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;from&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">949392000000&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;orgUnit&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;KbY9DJ8mBkx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="get-apiv2exportreports">GET /api/v2/export/reports&lt;/h3>
&lt;p>It uses the &lt;a href="https://github.com/medic/cht-core/tree/master/shared-libs/search">search shared library&lt;/a> to ensure identical results in the export and the front-end. It also only supports exporting CSV so we can efficiently stream infinitely large exports.&lt;/p>
&lt;h4 id="query-parameters-1">Query parameters&lt;/h4>
&lt;p>These are identical to the JS objects passed to the shared library, as if you were using it directly in Javascript.&lt;/p>
&lt;p>You may either pass JSON in the request body using &lt;code>POST&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a40000">POST&lt;/span> &lt;span style="color:#a40000">/api/v&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#a40000">/export/reports&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;filters&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;forms&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;selected&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;immunization_visit&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Or using form-style parameters as &lt;code>GET&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /api/v2/export/reports?filters[search]=&amp;amp;filters[forms][selected][0][code]=immunization_visit
&lt;/code>&lt;/pre>&lt;p>&lt;strong>NB:&lt;/strong> this API is bound directly to this library. For more information on what queries you can perform with the search library, see &lt;a href="https://github.com/medic/cht-core/tree/master/shared-libs/search">its documentation&lt;/a>.&lt;/p>
&lt;h3 id="get-apiv2exportmessages">GET /api/v2/export/messages&lt;/h3>
&lt;p>Download messages.&lt;/p>
&lt;h4 id="output">Output&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Column&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Record UUID&lt;/td>
&lt;td>The unique ID for the message in the database.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Patient ID&lt;/td>
&lt;td>The generated short patient ID for use in SMS.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Reported Date&lt;/td>
&lt;td>The date the message was received or generated.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>From&lt;/td>
&lt;td>This phone number the message is or will be sent from.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Contact Name&lt;/td>
&lt;td>The name of the user this message is assigned to.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Message Type&lt;/td>
&lt;td>The type of the message&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Message State&lt;/td>
&lt;td>The state of the message at the time this export was generated&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Received Timestamp&lt;/td>
&lt;td>The datetime the message was received. Only applies to incoming messages.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Other Timestamps&lt;/td>
&lt;td>The datetime the message transitioned to each state.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Sent By&lt;/td>
&lt;td>The phone number the message was sent from. Only applies to incoming messages.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>To Phone&lt;/td>
&lt;td>The phone number the message is or will be sent to. Only applies to outgoing messages.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Message Body&lt;/td>
&lt;td>The content of the message.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="examples">Examples&lt;/h4>
&lt;pre tabindex="0">&lt;code>/api/v2/export/messages
&lt;/code>&lt;/pre>&lt;h3 id="get-apiv2exportfeedback">GET /api/v2/export/feedback&lt;/h3>
&lt;p>Export a file containing the user feedback.&lt;/p>
&lt;h4 id="query-parameters-2">Query Parameters&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>format&lt;/td>
&lt;td>The format of the returned file, either &amp;lsquo;csv&amp;rsquo; or &amp;lsquo;xml&amp;rsquo;. Defaults to &amp;lsquo;csv&amp;rsquo;.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>locale&lt;/td>
&lt;td>Locale for translatable data. Defaults to &amp;rsquo;en&amp;rsquo;.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>tz&lt;/td>
&lt;td>The timezone to show date values in, as an offset in minutes from GMT, for example &amp;lsquo;-120&amp;rsquo;.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>skip_header_row&lt;/td>
&lt;td>&amp;rsquo;true&amp;rsquo; to omit the column headings. Defaults to &amp;lsquo;false&amp;rsquo;.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="get-apiv2exportcontacts">GET /api/v2/export/contacts&lt;/h3>
&lt;p>Returns a JSON array of contacts.&lt;/p>
&lt;h4 id="query-parameters-3">Query parameters&lt;/h4>
&lt;p>These are identical to the JS objects passed to the shared library, as if you were using it directly in Javascript.&lt;/p>
&lt;p>You may either pass JSON in the request body using &lt;code>POST&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a40000">POST&lt;/span> &lt;span style="color:#a40000">/api/v&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#a40000">/export/contacts&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;filters&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;search&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;jim&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Or using form-style parameters as &lt;code>GET&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /api/v2/export/contacts?filters[search]=jim
&lt;/code>&lt;/pre>&lt;h2 id="forms">Forms&lt;/h2>
&lt;h3 id="get-apiv1forms">GET /api/v1/forms&lt;/h3>
&lt;p>Returns a list of currently installed forms (in all available formats) in JSON format.&lt;/p>
&lt;h4 id="headers">Headers&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Value&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>X-OpenRosa-Version&lt;/td>
&lt;td>1.0&lt;/td>
&lt;td>If this header is specified returns XML formatted forms list. See &lt;a href="https://bitbucket.org/javarosa/javarosa/wiki/FormListAPI">OpenRosa FormListAPI&lt;/a>.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="examples-1">Examples&lt;/h4>
&lt;p>Get list of forms currently installed.&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /api/v1/forms
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200
Content-Type: application/json; charset=utf-8
[&amp;#34;anc_visit.xml&amp;#34;,&amp;#34;anc_registration.xml&amp;#34;,&amp;#34;off.xml&amp;#34;, &amp;#34;off.json&amp;#34;]
&lt;/code>&lt;/pre>&lt;p>Get OpenRosa XForms compatible forms installed in XML format.&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /api/v1/forms
Host: medic.local
X-OpenRosa-Version: 1.0
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: text/xml; charset=utf-8
X-OpenRosa-Version: 1.0
&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;
&amp;lt;xforms xmlns=&amp;#34;http://openrosa.org/xforms/xformsList&amp;#34;&amp;gt;
&amp;lt;xform&amp;gt;
&amp;lt;name&amp;gt;Visit&amp;lt;/name&amp;gt;
&amp;lt;formID&amp;gt;ANCVisit&amp;lt;/formID&amp;gt;
&amp;lt;hash&amp;gt;md5:1f0f096602ed794a264ab67224608cf4&amp;lt;/hash&amp;gt;
&amp;lt;downloadUrl&amp;gt;http://medic.local/api/v1/forms/anc_visit.xml&amp;lt;/downloadUrl&amp;gt;
&amp;lt;/xform&amp;gt;
&amp;lt;xform&amp;gt;
&amp;lt;name&amp;gt;Registration with LMP&amp;lt;/name&amp;gt;
&amp;lt;formID&amp;gt;PregnancyRegistration&amp;lt;/formID&amp;gt;
&amp;lt;hash&amp;gt;md5:1f0f096602ed794a264ab67224608cf4&amp;lt;/hash&amp;gt;
&amp;lt;downloadUrl&amp;gt;http://medic.local/api/v1/forms/anc_registration.xml&amp;lt;/downloadUrl&amp;gt;
&amp;lt;/xform&amp;gt;
&amp;lt;xform&amp;gt;
&amp;lt;name&amp;gt;Stop&amp;lt;/name&amp;gt;
&amp;lt;formID&amp;gt;Stop&amp;lt;/formID&amp;gt;
&amp;lt;hash&amp;gt;md5:1f0f096602ed794a264ab67224608cf4&amp;lt;/hash&amp;gt;
&amp;lt;downloadUrl&amp;gt;http://medic.local/api/v1/forms/off.xml&amp;lt;/downloadUrl&amp;gt;
&amp;lt;/xform&amp;gt;
&amp;lt;/xforms&amp;gt;
&lt;/code>&lt;/pre>&lt;h3 id="get-apiv1formsidformat">GET /api/v1/forms/{{id}}.{{format}}&lt;/h3>
&lt;p>Return form definition for a given form ID and format.&lt;/p>
&lt;h4 id="parameters">Parameters&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>id&lt;/td>
&lt;td>Form identifier&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>format&lt;/td>
&lt;td>Format string or file extension. e.g. xml, json&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="examples-2">Examples&lt;/h4>
&lt;p>Get latest version of the PregnancyRegistration form in xml (XForms) format.&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /api/v1/forms/pregnancyregistration.xml
&lt;/code>&lt;/pre>&lt;p>Get the latest version of the NPYY form in JSON format.&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /api/v1/forms/NPYY.json
&lt;/code>&lt;/pre>&lt;h3 id="post-apiv1formsvalidate">POST /api/v1/forms/validate&lt;/h3>
&lt;p>&lt;em>Added in 3.12.0&lt;/em>
Validate the XForm passed. Require the &lt;code>can_configure&lt;/code> permission.&lt;/p>
&lt;h4 id="headers-1">Headers&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Value&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Content-Type&lt;/td>
&lt;td>application/xml&lt;/td>
&lt;td>The form is sent in XML format&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Authorization&lt;/td>
&lt;td>Basic KEY&lt;/td>
&lt;td>KEY is the &amp;ldquo;basic&amp;rdquo; token&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="examples-3">Examples&lt;/h4>
&lt;pre tabindex="0">&lt;code>POST /api/v1/forms/validate HTTP/1.1
Content-Type: application/xml
Authorization: Basic XXXXXXXXXX
&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;
&amp;lt;xforms xmlns=&amp;#34;http://openrosa.org/xforms/xformsList&amp;#34;&amp;gt;
&amp;lt;xform&amp;gt;
&amp;lt;name&amp;gt;Visit&amp;lt;/name&amp;gt;
&amp;lt;formID&amp;gt;ANCVisit&amp;lt;/formID&amp;gt;
&amp;lt;hash&amp;gt;md5:1f0f096602ed794a264ab67224608cf4&amp;lt;/hash&amp;gt;
&amp;lt;downloadUrl&amp;gt;http://medic.local/api/v1/forms/anc_visit.xml&amp;lt;/downloadUrl&amp;gt;
&amp;lt;/xform&amp;gt;
&amp;lt;xform&amp;gt;
&amp;lt;name&amp;gt;Registration with LMP&amp;lt;/name&amp;gt;
&amp;lt;formID&amp;gt;PregnancyRegistration&amp;lt;/formID&amp;gt;
&amp;lt;hash&amp;gt;md5:1f0f096602ed794a264ab67224608cf4&amp;lt;/hash&amp;gt;
&amp;lt;downloadUrl&amp;gt;http://medic.local/api/v1/forms/anc_registration.xml&amp;lt;/downloadUrl&amp;gt;
&amp;lt;/xform&amp;gt;
&amp;lt;xform&amp;gt;
&amp;lt;name&amp;gt;Stop&amp;lt;/name&amp;gt;
&amp;lt;formID&amp;gt;Stop&amp;lt;/formID&amp;gt;
&amp;lt;hash&amp;gt;md5:1f0f096602ed794a264ab67224608cf4&amp;lt;/hash&amp;gt;
&amp;lt;downloadUrl&amp;gt;http://medic.local/api/v1/forms/off.xml&amp;lt;/downloadUrl&amp;gt;
&amp;lt;/xform&amp;gt;
&amp;lt;/xforms&amp;gt;
&lt;/code>&lt;/pre>&lt;p>Example response when the form passed the validations:&lt;/p>
&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
{ok: true}
&lt;/code>&lt;/pre>&lt;p>Example response when the form failed the validations:&lt;/p>
&lt;pre tabindex="0">&lt;code>HTTP/1.1 400 Bad Request
Content-Type: application/json
{error: &amp;#34;Error transforming xml. xsltproc return ...&amp;#34;}
&lt;/code>&lt;/pre>&lt;h2 id="records">Records&lt;/h2>
&lt;h3 id="post-apiv2records">POST /api/v2/records&lt;/h3>
&lt;p>Create a new record based on a &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/forms/">JSON form&lt;/a> that has been configured.&lt;/p>
&lt;p>Records can be created one of two ways, parsing the form data yourself and submitting a JSON object or by submitting the raw message string.&lt;/p>
&lt;h4 id="headers-2">Headers&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Value&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Content-Type&lt;/td>
&lt;td>application/x-www-form-urlencoded&lt;/td>
&lt;td>Processes form parameters.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Content-Type&lt;/td>
&lt;td>application/json&lt;/td>
&lt;td>Processes form data in request body as JSON.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Only one variant of the &lt;code>Content-Type&lt;/code> header may be provided; RFC 2616 does not
allow multiple content types to appear in a single &lt;code>Content-Type&lt;/code> header.&lt;/p>
&lt;h5 id="form-parameters">Form Parameters&lt;/h5>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>message&lt;/td>
&lt;td>Message string in a supported format like Muvuku or Textforms. Depending if your CHT instance is configured in forms-only mode or not you might receive an error if the form is not found.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>from&lt;/td>
&lt;td>Reporting phone number.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>sent_timestamp&lt;/td>
&lt;td>Timestamp in MS since Unix Epoch of when the message was received on the gateway. Defaults to now.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h5 id="json-properties">JSON Properties&lt;/h5>
&lt;p>Special values reside in the property &lt;code>_meta&lt;/code>, so you can&amp;rsquo;t have a form field named &lt;code>_meta&lt;/code>. Only strings and numbers are currently support as field values.&lt;/p>
&lt;p>All property names will be lowercased.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>_meta.form&lt;/td>
&lt;td>The form code.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>_meta.from&lt;/td>
&lt;td>Reporting phone number. Optional.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>_meta.reported_date&lt;/td>
&lt;td>Timestamp in MS since Unix Epoch of when the message was received on the gateway. Defaults to now.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>_meta.locale&lt;/td>
&lt;td>Optional locale string. Example: &amp;lsquo;fr&amp;rsquo;&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="examples-4">Examples&lt;/h4>
&lt;p>Creating new record using message field.&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /api/v1/records
Content-Type: application/x-www-form-urlencoded
message=1!YYYZ!Sam#23#2015#ANC&amp;amp;from=+5511943348031&amp;amp;sent_timestamp=1352399720000
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
{
&amp;#34;success&amp;#34;: true,
&amp;#34;id&amp;#34;: &amp;#34;364c796a843fbe0a73476f9153012733&amp;#34;
}
&lt;/code>&lt;/pre>&lt;p>Creating new record with JSON.&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /api/v1/records
Content-Type: application/json
{
&amp;#34;nurse&amp;#34;: &amp;#34;Sam&amp;#34;,
&amp;#34;week&amp;#34;: 23,
&amp;#34;year&amp;#34;: 2015,
&amp;#34;visit&amp;#34;: &amp;#34;ANC&amp;#34;,
&amp;#34;_meta&amp;#34;: {
&amp;#34;form&amp;#34;: &amp;#34;YYYZ&amp;#34;,
&amp;#34;reported_date&amp;#34;: 1352399720000
}
}
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
{
&amp;#34;success&amp;#34;: true,
&amp;#34;id&amp;#34;: &amp;#34;364c796a843fbe0a73476f9153012733&amp;#34;
}
&lt;/code>&lt;/pre>&lt;h4 id="errors">Errors&lt;/h4>
&lt;p>If required fields are not found return 500.&lt;/p>
&lt;p>If invalid JSON return error response 500.&lt;/p>
&lt;p>If submitting JSON and corresponding form is not found on the server you will receive an error.&lt;/p>
&lt;h2 id="sms">SMS&lt;/h2>
&lt;h3 id="post-apisms">POST /api/sms&lt;/h3>
&lt;p>Endpoint used by cht-gateway to send sms messages. More documentation in the &lt;a href="https://github.com/medic/cht-gateway/blob/master/README.md">cht-gateway repo&lt;/a>.&lt;/p>
&lt;h3 id="post-apiv1smsaggregatorendpoint">POST /api/v1/sms/{aggregator}/{endpoint}&lt;/h3>
&lt;p>Endpoint for integration with SMS aggregators. More details on the &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/messaging/gateways/rapidpro/">RapidPro&lt;/a> and &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/messaging/gateways/africas-talking/">Africa&amp;rsquo;s Talking&lt;/a> pages.&lt;/p>
&lt;h2 id="people">People&lt;/h2>
&lt;h3 id="supported-properties">Supported Properties&lt;/h3>
&lt;p>Use JSON in the request body to specify a person&amp;rsquo;s details.&lt;/p>
&lt;p>Note: this does not accommodate having a &lt;code>place&lt;/code> field on your form and will likely be revised soon.&lt;/p>
&lt;h4 id="required">Required&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>name&lt;/td>
&lt;td>String used to describe the person.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>type&lt;/td>
&lt;td>ID of the &lt;code>contact_type&lt;/code> for the new person. Defaults to &amp;lsquo;person&amp;rsquo; for backwards compatibility.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="optional">Optional&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>place&lt;/td>
&lt;td>String that references a place or object that defines a new place.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>reported_date&lt;/td>
&lt;td>Timestamp of when the record was reported or created. Defaults to now.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="post-apiv1people">POST /api/v1/people&lt;/h3>
&lt;p>Create new people.&lt;/p>
&lt;h4 id="permissions">Permissions&lt;/h4>
&lt;p>By default any user can create or modify a place. Use these permissions to restrict access:&lt;/p>
&lt;p>&lt;code>can_create_people&lt;/code>, &lt;code>can_create_places&lt;/code>&lt;/p>
&lt;h4 id="examples-5">Examples&lt;/h4>
&lt;p>Create new person and place hierarchy.&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /api/v1/people
Content-Type: application/json
{
&amp;#34;name&amp;#34;: &amp;#34;Hannah&amp;#34;,
&amp;#34;phone&amp;#34;: &amp;#34;+2548277210095&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;contact&amp;#34;,
&amp;#34;contact_type&amp;#34;: &amp;#34;patient&amp;#34;,
&amp;#34;place&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;CHP Area One&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;health_center&amp;#34;,
&amp;#34;parent&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;CHP Branch One&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;district_hospital&amp;#34;
}
}
}
&lt;/code>&lt;/pre>&lt;p>Create new person and assign existing place.&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /api/v1/people
Content-Type: application/json
{
&amp;#34;name&amp;#34;: &amp;#34;Samuel&amp;#34;,
&amp;#34;place&amp;#34;: &amp;#34;1d83f2b4a27eceb40df9e9f9ad06d137&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;contact&amp;#34;,
&amp;#34;contact_type&amp;#34;: &amp;#34;chp&amp;#34;
}
&lt;/code>&lt;/pre>&lt;p>Example response:&lt;/p>
&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
{
&amp;#34;id&amp;#34;: &amp;#34;71df9d25ed6732ea3b4435862510d115&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-a4060843d78f46a60a6f41051e40e3b5&amp;#34;
}
&lt;/code>&lt;/pre>&lt;h2 id="places">Places&lt;/h2>
&lt;p>By default any user can create or modify a place.&lt;/p>
&lt;h3 id="supported-properties-1">Supported Properties&lt;/h3>
&lt;p>Use JSON in the request body to specify a place&amp;rsquo;s details.&lt;/p>
&lt;h4 id="required-properties">Required Properties&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>name&lt;/td>
&lt;td>String used to describe the place.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>type&lt;/td>
&lt;td>Place type&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>parent&lt;/td>
&lt;td>String that references a place or object that defines a new place. Optional for District Hospital and National Office types.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="optional-properties">Optional Properties&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>contact&lt;/td>
&lt;td>String identifier for a person or object that defines a new person.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>reported_date&lt;/td>
&lt;td>Timestamp of when the record was reported or created. Defaults to now.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="place-types">Place Types&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>clinic&lt;/td>
&lt;td>Clinic&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>health_center&lt;/td>
&lt;td>Health Center&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>district_hospital&lt;/td>
&lt;td>District Hospital&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>national_office&lt;/td>
&lt;td>National Office&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="post-apiv1places">POST /api/v1/places&lt;/h3>
&lt;p>Create a new place and optionally a contact.&lt;/p>
&lt;h4 id="permissions-1">Permissions&lt;/h4>
&lt;p>By default any user can create new places. Use these permissions to restrict access:&lt;/p>
&lt;p>&lt;code>can_create_places&lt;/code>, &lt;code>can_create_people&lt;/code>&lt;/p>
&lt;h4 id="examples-6">Examples&lt;/h4>
&lt;p>Create new place referencing existing parent.&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /api/v1/places
Content-Type: application/json
{
&amp;#34;name&amp;#34;: &amp;#34;Busia Clinic&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;clinic&amp;#34;,
&amp;#34;parent&amp;#34;: &amp;#34;1d83f2b4a27eceb40df9e9f9ad06d137&amp;#34;
}
&lt;/code>&lt;/pre>&lt;p>Create child and parent places.&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /api/v1/places
Content-Type: application/json
{
&amp;#34;name&amp;#34;: &amp;#34;CHP Area One&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;health_center&amp;#34;,
&amp;#34;parent&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;CHP Branch One&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;district_hospital&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;p>Also creates contact (person).&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /api/v1/places
Content-Type: application/json
{
&amp;#34;name&amp;#34;: &amp;#34;CHP Area One&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;health_center&amp;#34;,
&amp;#34;parent&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;CHP Branch One&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;district_hospital&amp;#34;
},
&amp;#34;contact&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;Paul&amp;#34;,
&amp;#34;phone&amp;#34;: &amp;#34;+254883720611&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;p>Or assigns them.&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /api/v1/places
Content-Type: application/json
{
&amp;#34;name&amp;#34;: &amp;#34;CHP Area One&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;health_center&amp;#34;,
&amp;#34;parent&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;CHP Branch One&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;district_hospital&amp;#34;
},
&amp;#34;contact&amp;#34;: &amp;#34;71df9d25ed6732ea3b4435862510ef8e&amp;#34;
}
&lt;/code>&lt;/pre>&lt;p>Example success response:&lt;/p>
&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
{
&amp;#34;id&amp;#34;: &amp;#34;71df9d25ed6732ea3b4435862510d115&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-a4060843d78f46a60a6f41051e40e3b5&amp;#34;
}
&lt;/code>&lt;/pre>&lt;p>Error response if facility structure is not correct:&lt;/p>
&lt;pre tabindex="0">&lt;code>HTTP/1.1 400 Bad Request
Content-Type: text/plain
Health Centers should have &amp;#34;district_hospital&amp;#34; parent type.
&lt;/code>&lt;/pre>&lt;h3 id="post-apiv1placesid">POST /api/v1/places/{{id}}&lt;/h3>
&lt;p>Update a place and optionally its contact.&lt;/p>
&lt;h4 id="permissions-2">Permissions&lt;/h4>
&lt;p>By default any user can update a place. Use these permissions to restrict access:&lt;/p>
&lt;p>&lt;code>can_update_places&lt;/code>&lt;/p>
&lt;h4 id="examples-7">Examples&lt;/h4>
&lt;p>Update a place&amp;rsquo;s contact.&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /api/v1/places/1d83f2b4a27eceb40df9e9f9ad06d137
Content-Type: application/json
{
&amp;#34;contact&amp;#34;: &amp;#34;71df9d25ed6732ea3b4435862505f7a9&amp;#34;
}
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
{
&amp;#34;id&amp;#34;: &amp;#34;1d83f2b4a27eceb40df9e9f9ad06d137&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;12-a4060843d78f46a60a6f41051e40e3b5&amp;#34;
}
&lt;/code>&lt;/pre>&lt;h2 id="users">Users&lt;/h2>
&lt;p>All user related requests are limited to users with admin privileges by default.&lt;/p>
&lt;h3 id="supported-properties-2">Supported Properties&lt;/h3>
&lt;p>Use JSON in the request body to specify user details. Any properties submitted
that are not on the list below will be ignored. Any properties not included
will be undefined.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Required&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;th>Version&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>username&lt;/td>
&lt;td>yes&lt;/td>
&lt;td>String&lt;/td>
&lt;td>identifier used for authentication&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>roles&lt;/td>
&lt;td>yes&lt;/td>
&lt;td>Array&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>place&lt;/td>
&lt;td>yes, if the roles contain an offline role&lt;/td>
&lt;td>string or object&lt;/td>
&lt;td>Place identifier string (UUID) or object this user resides in.&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>contact&lt;/td>
&lt;td>yes, if the roles contain an offline role&lt;/td>
&lt;td>string or object&lt;/td>
&lt;td>A person identifier string (UUID) or object based on the form configured in the app.&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>password&lt;/td>
&lt;td>yes, if &lt;code>token_login&lt;/code> is not enabled for the user&lt;/td>
&lt;td>String&lt;/td>
&lt;td>Password string used for authentication. Only allowed to be set, not retrieved.&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>phone&lt;/td>
&lt;td>yes, if &lt;code>token_login&lt;/code> is enabled for the user&lt;/td>
&lt;td>String&lt;/td>
&lt;td>Valid phone number&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>token_login&lt;/td>
&lt;td>no&lt;/td>
&lt;td>Boolean&lt;/td>
&lt;td>A boolean representing whether or not the Login by SMS should be enabled for this user.&lt;/td>
&lt;td>3.10.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>fullname&lt;/td>
&lt;td>no&lt;/td>
&lt;td>String&lt;/td>
&lt;td>Full name&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>email&lt;/td>
&lt;td>no&lt;/td>
&lt;td>String&lt;/td>
&lt;td>Email address&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>known&lt;/td>
&lt;td>no&lt;/td>
&lt;td>Boolean&lt;/td>
&lt;td>Boolean to define if the user has logged in before.&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="login-by-sms">Login by SMS&lt;/h4>
&lt;p>When creating or updating a user, sending a truthy value for the field &lt;code>token_login&lt;/code> will enable Login by SMS for this user.
This action resets the user&amp;rsquo;s password to an unknown string and generates a complex 64 character token, that is used to generate a token-login URL.
The URL is sent to the user&amp;rsquo;s phone number by SMS, along with another (configurable) SMS that can contain additional information.
Accessing this link, before its expiration time, will log the user in directly - without the need of any other credentials.
The link can only be accessed once, the token becomes invalid after being used for one login.
The token expires in 24 hours, after which logging in is only possible by either generating a new token, or disabling &lt;code>token_login&lt;/code> and manually setting a password.&lt;/p>
&lt;p>The SMS messages are stored in a doc of a new type &lt;code>login_token&lt;/code>. These docs cannot be viewed as reports from the webapp, and can only be edited by admins, but their messages are visible in the Admin Message Queue page.&lt;/p>
&lt;p>To disable login by SMS for a user, update the user sending &lt;code>token_login&lt;/code> with a &lt;code>false&lt;/code> value.
To regenerate the token, update the user sending &lt;code>token_login&lt;/code> with a &lt;code>true&lt;/code> value.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;code>token_login&lt;/code>&lt;/th>
&lt;th>user state&lt;/th>
&lt;th>action&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>undefined&lt;/td>
&lt;td>new&lt;/td>
&lt;td>None&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>undefined&lt;/td>
&lt;td>existent, no token&lt;/td>
&lt;td>None&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>undefined&lt;/td>
&lt;td>existent, with token&lt;/td>
&lt;td>None. Login by SMS remains enabled. Token is unchanged.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>true&lt;/td>
&lt;td>new&lt;/td>
&lt;td>Login by SMS enabled. Token is generated and SMS is sent.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>true&lt;/td>
&lt;td>existent, no token&lt;/td>
&lt;td>Password is reset. Login by SMS enabled. Token is generated and SMS is sent. Existent sessions are invalidated.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>true&lt;/td>
&lt;td>existent, with token&lt;/td>
&lt;td>Password is reset. Login by SMS enabled. New token is generated and SMS is sent. Old token is invalid. Existent sessions are invalidated.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>false&lt;/td>
&lt;td>new&lt;/td>
&lt;td>None.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>false&lt;/td>
&lt;td>existent, no token&lt;/td>
&lt;td>None.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>false&lt;/td>
&lt;td>existent, with token&lt;/td>
&lt;td>Request requires a password. Login by SMS is disabled. Old token is invalidated. Existent sessions are invalidated.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>This feature uses &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/#app_settingsjson">&lt;code>app_settings.app_url&lt;/code>&lt;/a> and &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/token_login/">&lt;code>app_settings.token_login&lt;/code>&lt;/a> to be defined and enabled.
If &lt;code>app_settings.app_url&lt;/code> is not defined, the generated token-login URL will use the &lt;code>Host&lt;/code> request header, which may not always be correct.&lt;/p>
&lt;p>&lt;em>See Also&lt;/em>: &lt;a href="https://docs.communityhealthtoolkit.org/apps/concepts/access/#remote-login">Accessing CHT Apps&lt;/a>&lt;/p>
&lt;h3 id="get-apiv1users">GET /api/v1/users&lt;/h3>
&lt;p>&lt;em>DEPRECATED: use /api/v2/users&lt;/em>&lt;/p>
&lt;p>Returns a list of users and their profile data in JSON format.&lt;/p>
&lt;h4 id="permissions-3">Permissions&lt;/h4>
&lt;p>&lt;code>can_view_users&lt;/code>&lt;/p>
&lt;h4 id="examples-8">Examples&lt;/h4>
&lt;p>Get list of users:&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /api/v1/users
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
[
{
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:admin&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;10-6486428924d11781c107ea74de6b63b6&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;admin&amp;#34;,
&amp;#34;username&amp;#34;: &amp;#34;admin&amp;#34;
},
{
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:demo&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;14-8758c8493edcc6dac50366173fc3e24a&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;district-manager&amp;#34;,
&amp;#34;fullname&amp;#34;: &amp;#34;Example User&amp;#34;,
&amp;#34;username&amp;#34;: &amp;#34;demo&amp;#34;,
&amp;#34;place&amp;#34;: {
&amp;#34;_id&amp;#34;: &amp;#34;eeb17d6d-5dde-c2c0-62c4a1a0ca17d38b&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;district_hospital&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;Sample District&amp;#34;,
&amp;#34;contact&amp;#34;: {
&amp;#34;_id&amp;#34;: &amp;#34;eeb17d6d-5dde-c2c0-62c4a1a0ca17fd17&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;person&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;Paul&amp;#34;,
&amp;#34;phone&amp;#34;: &amp;#34;+2868917046&amp;#34;
}
},
&amp;#34;contact&amp;#34;: {
&amp;#34;_id&amp;#34;: &amp;#34;eeb17d6d-5dde-c2c0-62c4a1a0ca17fd17&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;person&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;Paul&amp;#34;,
&amp;#34;phone&amp;#34;: &amp;#34;+2868917046&amp;#34;
}
}
]
&lt;/code>&lt;/pre>&lt;h3 id="get-apiv2users">GET /api/v2/users&lt;/h3>
&lt;p>&lt;em>Added in 4.1.0&lt;/em>&lt;/p>
&lt;p>Returns a list of users and their profile data in JSON format.&lt;/p>
&lt;h4 id="permissions-4">Permissions&lt;/h4>
&lt;p>&lt;code>can_view_users&lt;/code>&lt;/p>
&lt;h4 id="examples-9">Examples&lt;/h4>
&lt;p>Get list of users:&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /api/v2/users
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
[
{
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:admin&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;10-6486428924d11781c107ea74de6b63b6&amp;#34;,
&amp;#34;roles&amp;#34;: [ &amp;#34;admin&amp;#34; ],
&amp;#34;username&amp;#34;: &amp;#34;admin&amp;#34;
},
{
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:demo&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;14-8758c8493edcc6dac50366173fc3e24a&amp;#34;,
&amp;#34;roles&amp;#34;: [ &amp;#34;district_admin&amp;#34;, &amp;#34;data_user&amp;#34; ],
&amp;#34;fullname&amp;#34;: &amp;#34;Example User&amp;#34;,
&amp;#34;username&amp;#34;: &amp;#34;demo&amp;#34;,
&amp;#34;place&amp;#34;: {
&amp;#34;_id&amp;#34;: &amp;#34;eeb17d6d-5dde-c2c0-62c4a1a0ca17d38b&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;district_hospital&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;Sample District&amp;#34;,
&amp;#34;contact&amp;#34;: {
&amp;#34;_id&amp;#34;: &amp;#34;eeb17d6d-5dde-c2c0-62c4a1a0ca17fd17&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;person&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;Paul&amp;#34;,
&amp;#34;phone&amp;#34;: &amp;#34;+2868917046&amp;#34;
}
},
&amp;#34;contact&amp;#34;: {
&amp;#34;_id&amp;#34;: &amp;#34;eeb17d6d-5dde-c2c0-62c4a1a0ca17fd17&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;person&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;Paul&amp;#34;,
&amp;#34;phone&amp;#34;: &amp;#34;+2868917046&amp;#34;
}
}
]
&lt;/code>&lt;/pre>&lt;h3 id="post-apiv1users">POST /api/v1/users&lt;/h3>
&lt;p>Create new users with a place and a contact.&lt;/p>
&lt;p>Creating multiple users at once by passing an array of users was introduced in version 3.15.
All users need to meet the following requirements before any of them are created:&lt;/p>
&lt;ul>
&lt;li>All required fields are filled in&lt;/li>
&lt;li>The password is at least 8 characters long and difficult to guess&lt;/li>
&lt;li>The phone number is valid when &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/token_login/">&lt;code>token_login&lt;/code>&lt;/a> is enabled&lt;/li>
&lt;/ul>
&lt;p>Users are created in parallel and the creation is not aborted even if one of the users fails to be created.&lt;/p>
&lt;p>Passing a single user in the request&amp;rsquo;s body will return a single object whereas
passing an array of users will return an array of objects as shown in the examples below.&lt;/p>
&lt;h4 id="permissions-5">Permissions&lt;/h4>
&lt;p>&lt;code>can_create_users&lt;/code>&lt;/p>
&lt;h4 id="examples-10">Examples&lt;/h4>
&lt;h5 id="create-one-user">Create one user&lt;/h5>
&lt;p>Create a new user that can authenticate with a username of &amp;ldquo;mary&amp;rdquo; and password
of &amp;ldquo;secret&amp;rdquo; that can submit reports and view or modify records associated to
their place. The place is created in the background and automatically linked
to the contact.&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /api/v1/users
Content-Type: application/json
{
&amp;#34;password&amp;#34;: &amp;#34;secret&amp;#34;,
&amp;#34;username&amp;#34;: &amp;#34;mary&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;district-manager&amp;#34;,
&amp;#34;place&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;Mary&amp;#39;s Area&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;health_center&amp;#34;,
&amp;#34;parent&amp;#34;: &amp;#34;d14e1c3d557761320b13a77e7806e8f8&amp;#34;
},
&amp;#34;contact&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;Mary Anyango&amp;#34;,
&amp;#34;phone&amp;#34;: &amp;#34;+2868917046&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200
Content-Type: application/json
{
&amp;#34;contact&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;65416b8ceb53ff88ac1847654501aeb3&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-0b74d219ae13137c1a06f03a0a52e187&amp;#34;
},
&amp;#34;user-settings&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:mary&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-6ac1d36b775143835f4af53f9895d7ae&amp;#34;
},
&amp;#34;user&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:mary&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-c3b82a0b47cfe68edd9284c89bebbae4&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;h5 id="create-many-users">Create many users&lt;/h5>
&lt;p>Create two new users that can authenticate with a username and a password
that can submit reports and view or modify records associated to their place.
The place is created in the background and automatically linked to the contact.&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /api/v1/users
Content-Type: application/json
[
{
&amp;#34;password&amp;#34;: &amp;#34;secret&amp;#34;,
&amp;#34;username&amp;#34;: &amp;#34;mary&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;district-manager&amp;#34;,
&amp;#34;place&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;Mary&amp;#39;s Area&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;health_center&amp;#34;,
&amp;#34;parent&amp;#34;: &amp;#34;d14e1c3d557761320b13a77e7806e8f8&amp;#34;
},
&amp;#34;contact&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;Mary Anyango&amp;#34;,
&amp;#34;phone&amp;#34;: &amp;#34;+2868917046&amp;#34;
}
},
{
&amp;#34;password&amp;#34;: &amp;#34;secret&amp;#34;,
&amp;#34;username&amp;#34;: &amp;#34;bob&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;district-manager&amp;#34;,
&amp;#34;place&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;Bob&amp;#39;s Area&amp;#34;,
&amp;#34;type&amp;#34;: &amp;#34;health_center&amp;#34;,
&amp;#34;parent&amp;#34;: &amp;#34;d14e1c3d557761320b13a77e7806e8f8&amp;#34;
},
&amp;#34;contact&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;Bob Johnson&amp;#34;,
&amp;#34;phone&amp;#34;: &amp;#34;+2868194607&amp;#34;
}
}
]
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200
Content-Type: application/json
[
{
&amp;#34;contact&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;65416b8ceb53ff88ac1847654501aeb3&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-0b74d219ae13137c1a06f03a0a52e187&amp;#34;
},
&amp;#34;user-settings&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:mary&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-6ac1d36b775143835f4af53f9895d7ae&amp;#34;
},
&amp;#34;user&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:mary&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-c3b82a0b47cfe68edd9284c89bebbae4&amp;#34;
}
},
{
&amp;#34;contact&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;8d8a741c1cb441058e29a60ab7596bf2&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-acbc31712fd105eae3cd0806cd20a8f4&amp;#34;
},
&amp;#34;user-settings&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:bob&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-d8629838127accd531043f845c416ef6&amp;#34;
},
&amp;#34;user&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:bob&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-5eac2542c801ba6b518728f53d9276a0&amp;#34;
}
}
]
&lt;/code>&lt;/pre>&lt;h4 id="errors-1">Errors&lt;/h4>
&lt;h5 id="response-when-the-username-already-exists">Response when the username already exists&lt;/h5>
&lt;pre tabindex="0">&lt;code>HTTP/1.1 400 Bad Request
Content-Type: application/json
{
&amp;#34;code&amp;#34;: 400,
&amp;#34;error&amp;#34;: {
&amp;#34;message&amp;#34;: &amp;#34;Username \&amp;#34;mary\&amp;#34; already taken.&amp;#34;,
&amp;#34;translationKey&amp;#34;: &amp;#34;username.taken&amp;#34;,
&amp;#34;translationParams&amp;#34;: {
&amp;#34;username&amp;#34;: &amp;#34;mary&amp;#34;
}
}
}
&lt;/code>&lt;/pre>&lt;h5 id="response-when-users-are-missing-required-fields">Response when users are missing required fields&lt;/h5>
&lt;pre tabindex="0">&lt;code>HTTP/1.1 400 Bad Request
Content-Type: application/json
{
&amp;#34;code&amp;#34;: 400,
&amp;#34;error&amp;#34;: &amp;#34;Missing required fields:\n\Missing fields username, password, type or roles for user at index 0\nMissing fields password, type or roles for user at index 1&amp;#34;,
&amp;#34;details&amp;#34;: {
&amp;#34;failingIndexes&amp;#34;: [
{
&amp;#34;fields&amp;#34;: [
&amp;#34;username&amp;#34;,
&amp;#34;password&amp;#34;,
&amp;#34;type or roles&amp;#34;
],
&amp;#34;index&amp;#34;: 0
},
{
&amp;#34;fields&amp;#34;: [
&amp;#34;password&amp;#34;,
&amp;#34;type or roles&amp;#34;
],
&amp;#34;index&amp;#34;: 1
}
]
}
}
&lt;/code>&lt;/pre>&lt;h5 id="response-when-some-users-failed-to-be-created">Response when some users failed to be created&lt;/h5>
&lt;pre tabindex="0">&lt;code>HTTP/1.1 200
Content-Type: application/json
[
{
&amp;#34;contact&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;65416b8ceb53ff88ac1847654501aeb3&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-0b74d219ae13137c1a06f03a0a52e187&amp;#34;
},
&amp;#34;user-settings&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:mary&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-6ac1d36b775143835f4af53f9895d7ae&amp;#34;
},
&amp;#34;user&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:mary&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-c3b82a0b47cfe68edd9284c89bebbae4&amp;#34;
}
},
{
&amp;#34;error&amp;#34;: &amp;#34;Failed to find place.&amp;#34;
}
]
&lt;/code>&lt;/pre>&lt;h3 id="post-apiv2users">POST /api/v2/users&lt;/h3>
&lt;p>&lt;em>Added in 3.16.0&lt;/em>
Create new users with a place and a contact from a CSV file.&lt;/p>
&lt;p>Creating users from a CSV file behaves the same as passing a JSON array of users into the &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/api/#post-apiv1users">&lt;code>POST /api/v1/users&lt;/code>&lt;/a>
where a row represents a user object and a column represents a user object property.&lt;br>
Columns with a &lt;code>:excluded&lt;/code> suffix will be ignored, this allows providing a more user-friendly experience with
autocompletion on fields or dealing with names instead of long, unreadable ids.&lt;/p>
&lt;p>In order to facilitate this process, we have made available a spreadsheet compatible with the &lt;code>default&lt;/code> configuration of the CHT.
&lt;a href="https://docs.google.com/spreadsheets/d/1yUenFP-5deQ0I9c-OYDTpbKYrkl3juv9djXoLLPoQ7Y/copy">Click here&lt;/a> to make a copy of the spreadsheet in Google Sheets.&lt;br>
&lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/data/users-bulk-load/">A guide&lt;/a> on how to import users with this spreadsheet from within the Admin Console is available
in case you don&amp;rsquo;t want to interact with this API yourself.&lt;/p>
&lt;h4 id="logging">Logging&lt;/h4>
&lt;p>A log entry is created with each bulk import that contains the import status for each user and the import progress status
that gets updated throughout the import and finalized upon completion.&lt;br>
These entries are saved in the &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/database/#medic-logs">&lt;code>medic-logs&lt;/code>&lt;/a> database and you can access them
by querying documents with a key that starts with &lt;code>bulk-user-upload-&lt;/code>.&lt;/p>
&lt;h4 id="headers-3">Headers&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Value&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Content-Type&lt;/td>
&lt;td>text/csv&lt;/td>
&lt;td>Processes form data in request body as JSON.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="permissions-6">Permissions&lt;/h4>
&lt;p>&lt;code>can_create_users&lt;/code>&lt;/p>
&lt;h4 id="example">Example&lt;/h4>
&lt;p>Create two new users that can authenticate with a username and a password
that can submit reports and view or modify records associated to their place.
Along with a new user, a new contact and new place are created as well.
The new place will be a child of &lt;code>place.parent&lt;/code> (see the UUID &lt;code>fe4da0f9-7d65-4834-bb42-88a5239bbd3b&lt;/code> below)
and must already exist or else the new place will be an orphan record in the hierarchy and not show up in the GUI.&lt;/p>
&lt;pre tabindex="0">&lt;code>POST /api/v2/users
Content-Type: text/csv
contact.first_name,contact.last_name,contact.sex,contact.phone,email,contact.meta.created_by,token_login,contact.role,contact.type,contact.contact_type,contact.name,username,password,phone,place.parent,place.type,place.name,place.contact_type,type,fullname
Mary,Anyango,female,+2868917046,,,FALSE,chw,contact,person,Mary Anyango,mary,WrAGyGD9805,2868917046,fe4da0f9-7d65-4834-bb42-88a5239bbd3b,health_center,Mary Anyango&amp;#39;s Health center,clinic,chw,Mary Anyango
Bob,Johnson,male,+2868194607,,,FALSE,chw,contact,person,Bob Johnson,bob,JzAEQzY2614,2868194607,fe4da0f9-7d65-4834-bb42-88a5239bbd3b,health_center,Bob Johnson&amp;#39;s Health center,clinic,chw,Bob Johnson
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200
Content-Type: application/json
[
{
&amp;#34;contact&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;65416b8ceb53ff88ac1847654501aeb3&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-0b74d219ae13137c1a06f03a0a52e187&amp;#34;
},
&amp;#34;user-settings&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:mary&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-6ac1d36b775143835f4af53f9895d7ae&amp;#34;
},
&amp;#34;user&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:mary&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-c3b82a0b47cfe68edd9284c89bebbae4&amp;#34;
}
},
{
&amp;#34;contact&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;8d8a741c1cb441058e29a60ab7596bf2&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-acbc31712fd105eae3cd0806cd20a8f4&amp;#34;
},
&amp;#34;user-settings&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:bob&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-d8629838127accd531043f845c416ef6&amp;#34;
},
&amp;#34;user&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:bob&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-5eac2542c801ba6b518728f53d9276a0&amp;#34;
}
}
]
&lt;/code>&lt;/pre>&lt;h4 id="errors-2">Errors&lt;/h4>
&lt;h5 id="response-when-the-username-already-exists-1">Response when the username already exists&lt;/h5>
&lt;pre tabindex="0">&lt;code>HTTP/1.1 400 Bad Request
Content-Type: application/json
[
{
&amp;#34;error&amp;#34;: &amp;#34;Missing required fields: username&amp;#34;
}
]
&lt;/code>&lt;/pre>&lt;h5 id="response-when-users-are-missing-required-fields-1">Response when users are missing required fields&lt;/h5>
&lt;pre tabindex="0">&lt;code>HTTP/1.1 400 Bad Request
Content-Type: application/json
[
{
&amp;#34;error&amp;#34;: &amp;#34;Missing required fields: username&amp;#34;
},
{
&amp;#34;error&amp;#34;: &amp;#34;Missing required fields: password&amp;#34;
}
]
&lt;/code>&lt;/pre>&lt;h5 id="response-when-some-users-failed-to-be-created-1">Response when some users failed to be created&lt;/h5>
&lt;pre tabindex="0">&lt;code>HTTP/1.1 200
Content-Type: application/json
[
{
&amp;#34;contact&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;65416b8ceb53ff88ac1847654501aeb3&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-0b74d219ae13137c1a06f03a0a52e187&amp;#34;
},
&amp;#34;user-settings&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:mary&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-6ac1d36b775143835f4af53f9895d7ae&amp;#34;
},
&amp;#34;user&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:mary&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;1-c3b82a0b47cfe68edd9284c89bebbae4&amp;#34;
}
},
{
&amp;#34;error&amp;#34;: &amp;#34;Failed to find place.&amp;#34;
}
]
&lt;/code>&lt;/pre>&lt;h3 id="post-apiv1usersusername">POST /api/v1/users/{{username}}&lt;/h3>
&lt;p>Allows you to change property values on a user account. Properties listed above
are supported except for &lt;code>contact.parent&lt;/code>. Creating or modifying people
through the user is not supported, see People section.&lt;/p>
&lt;h4 id="permissions-7">Permissions&lt;/h4>
&lt;p>&lt;code>can_update_users&lt;/code>, &lt;code>can_update_places&lt;/code>, &lt;code>can_update_people&lt;/code>&lt;/p>
&lt;h4 id="updating-yourself">Updating yourself&lt;/h4>
&lt;p>You do not need any of the above permissions if the user you are modifying is yourself. However, you are not allowed to modify your &lt;code>type&lt;/code>, &lt;code>roles&lt;/code>, &lt;code>contact&lt;/code> or &lt;code>place&lt;/code>.&lt;/p>
&lt;p>Further more, if you&amp;rsquo;re updating your &lt;code>password&lt;/code> you must be authenticating via Basic Auth (either the header or in the URL). This is to ensure the password is known at time of request, and no one is hijacking a cookie.&lt;/p>
&lt;h4 id="url-parameters">URL Parameters&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>username&lt;/td>
&lt;td>String identifier used for authentication.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="examples-11">Examples&lt;/h4>
&lt;pre tabindex="0">&lt;code>POST /api/v1/users/mary
Content-Type: application/json
{
&amp;#34;password&amp;#34;: &amp;#34;secret&amp;#34;,
&amp;#34;place&amp;#34;: &amp;#34;eeb17d6d-5dde-c2c0-62c4a1a0ca17e342&amp;#34;
}
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
{
&amp;#34;user&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:mary&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;23-858e01fafdfa0d367d798fe5b44751ff&amp;#34;
},
&amp;#34;user-settings&amp;#34;: {
&amp;#34;id&amp;#34;: &amp;#34;org.couchdb.user:mary&amp;#34;,
&amp;#34;rev&amp;#34;: &amp;#34;17-c6d03b86d2d5d70f7270c85e67fea96d&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;h3 id="delete-apiv1usersusername">DELETE /api/v1/users/{{username}}&lt;/h3>
&lt;p>Delete a user. Does not affect a person or place associated to a user.&lt;/p>
&lt;h4 id="permissions-8">Permissions&lt;/h4>
&lt;p>&lt;code>can_delete_users&lt;/code>&lt;/p>
&lt;h4 id="url-parameters-1">URL Parameters&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>username&lt;/td>
&lt;td>String identifier used for authentication.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="examples-12">Examples&lt;/h4>
&lt;pre tabindex="0">&lt;code>DELETE /api/v1/users/mary
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
&lt;/code>&lt;/pre>&lt;h3 id="get-apiv1users-info">GET /api/v1/users-info&lt;/h3>
&lt;p>Returns the total number of documents an offline user would replicate (&lt;code>total_docs&lt;/code>), the number of docs excluding tasks the user would replicate (&lt;code>warn_docs&lt;/code>), along with a &lt;code>warn&lt;/code> flag if this number exceeds the recommended limit (now set at 10 000).&lt;/p>
&lt;p>When the authenticated requester has an offline role, it returns the requester doc count.&lt;/p>
&lt;h4 id="example-1">Example&lt;/h4>
&lt;pre tabindex="0">&lt;code>GET /api/v1/users-info -H &amp;#39;Cookie: AuthSession=OFFLINE_USER_SESSION;&amp;#39;
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
{
&amp;#34;total_docs&amp;#34;: 5678,
&amp;#34;warn_docs&amp;#34;: 4852,
&amp;#34;warn&amp;#34;: false,
&amp;#34;limit: 10000
}
&lt;/code>&lt;/pre>&lt;p>When the requester has an online role, the following query parameters are accepted:&lt;/p>
&lt;h5 id="query-parameters-4">Query Parameters&lt;/h5>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Description&lt;/th>
&lt;th>Required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>facility_id&lt;/td>
&lt;td>String identifier representing the uuid of the user&amp;rsquo;s facility&lt;/td>
&lt;td>true&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>role&lt;/td>
&lt;td>String identifier representing the user role - must be configured as an offline role. Accepts valid UTF-8 JSON array for multiple of roles.&lt;/td>
&lt;td>true&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>contact_id&lt;/td>
&lt;td>String identifier representing the uuid of the user&amp;rsquo;s associated contact&lt;/td>
&lt;td>false&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>When requested as an online user, the number of tasks are never counted and never returned, so &lt;code>warn_docs&lt;/code> is always equal to &lt;code>total_docs&lt;/code>.&lt;/p>
&lt;h6 id="example-2">Example&lt;/h6>
&lt;pre tabindex="0">&lt;code>GET /api/v1/users-info?facility_id={{facility_uuid}}&amp;amp;role={{role}}&amp;amp;contact_id={{contact_uuid}} -H &amp;#39;Cookie: AuthSession=OFFLINE_USER_SESSION;&amp;#39;
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
{
&amp;#34;total_docs&amp;#34;: 10265,
&amp;#34;warn_docs&amp;#34;: 10265,
&amp;#34;warn&amp;#34;: true,
&amp;#34;limit: 10000
}
&lt;/code>&lt;/pre>&lt;p>In case any of the required query parameters are omitted or the requested role is not configured as an offline role, the request will result in an error:&lt;/p>
&lt;pre tabindex="0">&lt;code>GET /api/v1/users-info?role={{online_role}} -H &amp;#39;Cookie: AuthSession=OFFLINE_USER_SESSION;&amp;#39;
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 400 Bad Request
Content-Type: application/json
{
&amp;#34;code&amp;#34;: 400,
&amp;#34;error&amp;#34;: &amp;#34;Missing required query params: role and/or facility_id&amp;#34;
}
&lt;/code>&lt;/pre>&lt;h2 id="bulk-operations">Bulk Operations&lt;/h2>
&lt;h3 id="post-apiv1bulk-delete">POST /api/v1/bulk-delete&lt;/h3>
&lt;p>Bulk delete endpoint for deleting large numbers of documents. Docs will be batched into groups of 100 and will be sent sequentially to couch (new batch sent after the previous one has returned). The response will be chunked JSON (one batch at a time), so if you wish to get an indication of progress you will need to parse incomplete JSON (with a library such as &lt;a href="https://github.com/indgov/partial-json-parser">&lt;code>partial-json-parser&lt;/code>&lt;/a>.&lt;/p>
&lt;h4 id="permissions-9">Permissions&lt;/h4>
&lt;p>Only available to online users.&lt;/p>
&lt;h4 id="parameters-1">Parameters&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Parameter&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>docs&lt;/td>
&lt;td>Array of JSON objects with &lt;code>_id&lt;/code> properties&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>An array of objects each with an &lt;code>_id&lt;/code> property is required (rather than an array of strings representing ids) to ensure forwards compatibility if we choose to require that any additional document information (such as &lt;code>_rev&lt;/code>) also be passed in to this endpoint.&lt;/p>
&lt;h4 id="errors-3">Errors&lt;/h4>
&lt;p>If an error is encountered part-way through the response (eg on the third batch), it&amp;rsquo;s impossible to send new headers to indicate a 5xx error, so the connection will simply be terminated (as recommended here &lt;a href="https://github.com/expressjs/express/issues/2700)">https://github.com/expressjs/express/issues/2700)&lt;/a>.&lt;/p>
&lt;h4 id="examples-13">Examples&lt;/h4>
&lt;pre tabindex="0">&lt;code>POST /api/v1/bulk-delete
Content-Type: application/json
{
&amp;#34;docs&amp;#34;: [
{ &amp;#34;_id&amp;#34;: &amp;#34;id1&amp;#34; },
{ &amp;#34;_id&amp;#34;: &amp;#34;id2&amp;#34; },
...
{ &amp;#34;_id&amp;#34;: &amp;#34;id150&amp;#34; }
]
}
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
[
[
{ &amp;#34;ok&amp;#34;: true, &amp;#34;id&amp;#34;: &amp;#34;id1&amp;#34;, &amp;#34;rev&amp;#34;: &amp;#34;1-rev1&amp;#34; },
{ &amp;#34;ok&amp;#34;: true, &amp;#34;id&amp;#34;: &amp;#34;id2&amp;#34;, &amp;#34;rev&amp;#34;: &amp;#34;1-rev2&amp;#34; },
...
{ &amp;#34;ok&amp;#34;: true, &amp;#34;id&amp;#34;: &amp;#34;id100&amp;#34;, &amp;#34;rev&amp;#34;: &amp;#34;1-rev100&amp;#34; }
],
[
{ &amp;#34;ok&amp;#34;: true, &amp;#34;id&amp;#34;: &amp;#34;id101&amp;#34;, &amp;#34;rev&amp;#34;: &amp;#34;1-rev101&amp;#34; },
{ &amp;#34;ok&amp;#34;: true, &amp;#34;id&amp;#34;: &amp;#34;id102&amp;#34;, &amp;#34;rev&amp;#34;: &amp;#34;1-rev102&amp;#34; },
...
{ &amp;#34;ok&amp;#34;: true, &amp;#34;id&amp;#34;: &amp;#34;id150&amp;#34;, &amp;#34;rev&amp;#34;: &amp;#34;1-rev150&amp;#34; }
]
]
&lt;/code>&lt;/pre>&lt;h2 id="monitoring">Monitoring&lt;/h2>
&lt;p>See the &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/hosting/monitoring/">Monitoring and alerting on the CHT&lt;/a> page for how to use this API in production.&lt;/p>
&lt;h3 id="get-apiv1monitoring">GET /api/v1/monitoring&lt;/h3>
&lt;p>&lt;em>Deprecated in 3.12.x in favor of &lt;a href="#get-apiv2monitoring">/api/v2/monitoring&lt;/a>&lt;/em>
Used to retrieve a range of metrics about the instance. While the output is human-readable this is intended for automated monitoring allowing for tracking trends over time and alerting about potential issues.&lt;/p>
&lt;h4 id="permissions-10">Permissions&lt;/h4>
&lt;p>No permissions required.&lt;/p>
&lt;h4 id="examples-14">Examples&lt;/h4>
&lt;h5 id="json-format">JSON format&lt;/h5>
&lt;pre tabindex="0">&lt;code>curl http://localhost:5988/api/v1/monitoring
{&amp;#34;version&amp;#34;:{&amp;#34;app&amp;#34;:&amp;#34;3.9.0&amp;#34;,&amp;#34;node&amp;#34;:&amp;#34;v10.16.0&amp;#34;,&amp;#34;couchdb&amp;#34;:&amp;#34;2.3.1&amp;#34;},&amp;#34;couchdb&amp;#34;:{&amp;#34;medic&amp;#34;:{&amp;#34;name&amp;#34;:&amp;#34;medic&amp;#34;,&amp;#34;update_sequence&amp;#34;:5733,&amp;#34;doc_count&amp;#34;:278,&amp;#34;doc_del_count&amp;#34;:32,&amp;#34;fragmentation&amp;#34;:1.0283517758420173}...
&lt;/code>&lt;/pre>&lt;h4 id="response-content">Response content&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>JSON path&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>version.app&lt;/code>&lt;/td>
&lt;td>String&lt;/td>
&lt;td>The version of the webapp.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>version.node&lt;/code>&lt;/td>
&lt;td>String&lt;/td>
&lt;td>The version of NodeJS.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>version.couchdb&lt;/code>&lt;/td>
&lt;td>String&lt;/td>
&lt;td>The version of CouchDB.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>couchdb.&amp;lt;dbname&amp;gt;.name&lt;/code>&lt;/td>
&lt;td>String&lt;/td>
&lt;td>The name of the db, usually one of &amp;ldquo;medic&amp;rdquo;, &amp;ldquo;medic-sentinel&amp;rdquo;, &amp;ldquo;medic-users-meta&amp;rdquo;, &amp;ldquo;_users&amp;rdquo;.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>couchdb.&amp;lt;dbname&amp;gt;.update_sequence&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of changes in the db.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>couchdb.&amp;lt;dbname&amp;gt;.doc_count&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of docs in the db.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>couchdb.&amp;lt;dbname&amp;gt;.doc_del_count&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of deleted docs in the db.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>couchdb.&amp;lt;dbname&amp;gt;.fragmentation&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The fragmentation of the db, lower is better, &amp;ldquo;1&amp;rdquo; is no fragmentation.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>date.current&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The current server date in millis since the epoch, useful for ensuring the server time is correct.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>date.uptime&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>How long API has been running.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>sentinel.backlog&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of changes yet to be processed by Sentinel.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.state.due&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages due to be sent.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.state.scheduled&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages scheduled to be sent in the future.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.state.muted&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages that are muted and therefore will not be sent.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.state.delivered&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages that have been delivered or sent. As of 3.12.x.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.state.failed&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages have failed to be delivered. As of 3.12.x&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>outbound_push.backlog&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of changes yet to be processed by Outbound Push.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>feedback.count&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of feedback docs created usually indicative of client side errors.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>conflict.count&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of doc conflicts which need to be resolved manually.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>replication_limit.count&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of users that exceeded the replication limit of documents.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>connected_users.count&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of users that have connected to the api in a given number of days. The period defaults to 7 days but this can be changed by adding &lt;code>connected_user_interval&lt;/code> as a query parameter e.g. &lt;code>http://localhost:5988/api/v1/monitoring?connected_user_interval=14&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="errors-4">Errors&lt;/h4>
&lt;ul>
&lt;li>A metric of &lt;code>&amp;quot;&amp;quot;&lt;/code> (for string values) or &lt;code>-1&lt;/code> (for numeric values) indicates an error occurred while querying the metric - check the API logs for details.&lt;/li>
&lt;li>If no response or an error response is received the instance is unreachable. Thus, this API can be used as an uptime monitoring endpoint.&lt;/li>
&lt;/ul>
&lt;h3 id="get-apiv2monitoring">GET /api/v2/monitoring&lt;/h3>
&lt;p>Available as of 3.12.x.
Used to retrieve a range of metrics about the instance. While the output is human-readable this is intended for automated monitoring allowing for tracking trends over time and alerting about potential issues.&lt;/p>
&lt;h4 id="permissions-11">Permissions&lt;/h4>
&lt;p>No permissions required.&lt;/p>
&lt;h4 id="examples-15">Examples&lt;/h4>
&lt;h5 id="json-format-1">JSON format&lt;/h5>
&lt;pre tabindex="0">&lt;code>curl http://localhost:5988/api/v2/monitoring
{&amp;#34;version&amp;#34;:{&amp;#34;app&amp;#34;:&amp;#34;3.12.0&amp;#34;,&amp;#34;node&amp;#34;:&amp;#34;v10.16.0&amp;#34;,&amp;#34;couchdb&amp;#34;:&amp;#34;2.3.1&amp;#34;},&amp;#34;couchdb&amp;#34;:{&amp;#34;medic&amp;#34;:{&amp;#34;name&amp;#34;:&amp;#34;medic&amp;#34;,&amp;#34;update_sequence&amp;#34;:5733,&amp;#34;doc_count&amp;#34;:278,&amp;#34;doc_del_count&amp;#34;:32,&amp;#34;fragmentation&amp;#34;:1.0283517758420173}...
&lt;/code>&lt;/pre>&lt;h4 id="response-content-1">Response content&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>JSON path&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>version.app&lt;/code>&lt;/td>
&lt;td>String&lt;/td>
&lt;td>The version of the webapp.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>version.node&lt;/code>&lt;/td>
&lt;td>String&lt;/td>
&lt;td>The version of NodeJS.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>version.couchdb&lt;/code>&lt;/td>
&lt;td>String&lt;/td>
&lt;td>The version of CouchDB.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>couchdb.&amp;lt;dbname&amp;gt;.name&lt;/code>&lt;/td>
&lt;td>String&lt;/td>
&lt;td>The name of the db, usually one of &amp;ldquo;medic&amp;rdquo;, &amp;ldquo;medic-sentinel&amp;rdquo;, &amp;ldquo;medic-users-meta&amp;rdquo;, &amp;ldquo;_users&amp;rdquo;.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>couchdb.&amp;lt;dbname&amp;gt;.update_sequence&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of changes in the db.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>couchdb.&amp;lt;dbname&amp;gt;.doc_count&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of docs in the db.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>couchdb.&amp;lt;dbname&amp;gt;.doc_del_count&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of deleted docs in the db.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>couchdb.&amp;lt;dbname&amp;gt;.fragmentation&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The fragmentation of the db, lower is better, &amp;ldquo;1&amp;rdquo; is no fragmentation.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>date.current&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The current server date in millis since the epoch, useful for ensuring the server time is correct.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>date.uptime&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>How long API has been running.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>sentinel.backlog&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of changes yet to be processed by Sentinel.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.total.due&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages due to be sent.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.total.scheduled&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages scheduled to be sent in the future.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.total.muted&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages that are muted and therefore will not be sent.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.total.delivered&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages that have been delivered or sent.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.total.failed&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages have failed to be delivered.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.seven_days.due&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages due to be sent in the last seven days.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.seven_days.scheduled&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages that were scheduled to be sent in the last seven days.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.seven_days.muted&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages that were due in the last seven days and are muted.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.seven_days.delivered&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages that were due in the last seven days and have been delivered or sent.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.seven_days.failed&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>The number of messages that were due in the last seven days and have failed to be delivered.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.pending&lt;/code>&lt;/td>
&lt;td>Object&lt;/td>
&lt;td>Counts within last 100 messages that have received status updates, and are one of the &amp;ldquo;pending&amp;rdquo; group statuses&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.pending.pending&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of messages that are pending&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.pending.forwarded-to-gateway&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of messages that are forwarded-to-gateway&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.pending.received-by-gateway&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of messages that are received-by-gateway&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.pending.forwarded-by-gateway&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of messages that are forwarded-by-gateway&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.final&lt;/code>&lt;/td>
&lt;td>Object&lt;/td>
&lt;td>Counts within last 100 messages that have received status updates, and are in one of the &amp;ldquo;final&amp;rdquo; group statuses&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.final.sent&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of messages that are sent&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.final.delivered&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of messages that are delivered&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.final.failed&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of messages that are failed&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.muted&lt;/code>&lt;/td>
&lt;td>Object&lt;/td>
&lt;td>Counts within last 100 messages that have received status updates, and are in one of the &amp;ldquo;muted&amp;rdquo; group statuses&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.final.denied&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of messages that are denied&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.final.cleared&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of messages that are cleared&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.final.muted&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of messages that are muted&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messaging.outgoing.last_hundred.final.duplicate&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of messages that are duplicate&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>outbound_push.backlog&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of changes yet to be processed by Outbound Push.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>feedback.count&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of feedback docs created usually indicative of client side errors.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>conflict.count&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of doc conflicts which need to be resolved manually.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>replication_limit.count&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of users that exceeded the replication limit of documents.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>connected_users.count&lt;/code>&lt;/td>
&lt;td>Number&lt;/td>
&lt;td>Number of users that have connected to the api in a given number of days. The period defaults to 7 days but this can be changed by adding &lt;code>connected_user_interval&lt;/code> as a query parameter e.g. &lt;code>http://localhost:5988/api/v2/monitoring?connected_user_interval=14&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="errors-5">Errors&lt;/h4>
&lt;ul>
&lt;li>A metric of &lt;code>&amp;quot;&amp;quot;&lt;/code> (for string values) or &lt;code>-1&lt;/code> (for numeric values) indicates an error occurred while querying the metric - check the API logs for details.&lt;/li>
&lt;li>If no response or an error response is received the instance is unreachable. Thus, this API can be used as an uptime monitoring endpoint.&lt;/li>
&lt;/ul>
&lt;h2 id="upgrades">Upgrades&lt;/h2>
&lt;p>All of these endpoints require the &lt;code>can_configure&lt;/code> permission.&lt;/p>
&lt;p>All of these endpoints are asynchronous. Progress can be followed by watching the &lt;code>horti-upgrade&lt;/code> document and looking at the &lt;code>log&lt;/code> property.&lt;/p>
&lt;h3 id="post-apiv1upgrade">POST /api/v1/upgrade&lt;/h3>
&lt;p>Performs a complete upgrade to the provided version. This is equivalent of calling &lt;code>/api/v1/upgrade/stage&lt;/code> and then &lt;code>/api/v1/upgrade/complete&lt;/code> once staging has finished.&lt;/p>
&lt;h4 id="example-3">Example&lt;/h4>
&lt;pre tabindex="0">&lt;code>POST /api/v1/upgrade
{
&amp;#34;build&amp;#34;: {
&amp;#34;namespace&amp;#34;: &amp;#34;medic&amp;#34;,
&amp;#34;application&amp;#34;: &amp;#34;medic&amp;#34;,
&amp;#34;version&amp;#34;: &amp;#34;3.0.0-beta.1&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;p>For potential forwards compatibility, you must pass the &lt;code>namespace&lt;/code> and &lt;code>application&lt;/code> as &lt;code>medic&lt;/code>.&lt;/p>
&lt;p>The &lt;code>version&lt;/code> should correspond to a release, pre-release or branch that has been pushed to our builds server, which is currently hard-coded to &lt;code>https://staging.dev.medicmobile.org/builds&lt;/code>. This happens automatically upon a successful Continuous Integration run.&lt;/p>
&lt;p>Calling this endpoint will eventually cause api and sentinel to restart.&lt;/p>
&lt;p>It is expected that the caller ensures forwards or backwards compatibility is maintained between deployed versions. This endpoint does not stop you from &amp;ldquo;upgrading&amp;rdquo; to an earlier version, or a branch that is incompatible with your current state.&lt;/p>
&lt;h3 id="post-apiv1upgradestage">POST /api/v1/upgrade/stage&lt;/h3>
&lt;p>Stages an upgrade to the provided version. Does as much of the upgrade as possible without actually swapping versions over and restarting.&lt;/p>
&lt;p>Parameters are the same as &lt;code>/api/v1/upgrade&lt;/code>.&lt;/p>
&lt;p>You know that an upgrade has been staged when the &lt;code>horti-upgrade&lt;/code> document in CouchDB has &lt;code>&amp;quot;action&amp;quot;: &amp;quot;stage&amp;quot;&lt;/code> and &lt;code>&amp;quot;staging_complete&amp;quot;: true&lt;/code>.&lt;/p>
&lt;h3 id="post-apiv1upgradecomplete">POST /api/v1/upgrade/complete&lt;/h3>
&lt;p>Completes a staged upgrade. Throws a &lt;code>404&lt;/code> if there is no upgrade in the staged position.&lt;/p>
&lt;h2 id="hydrate">Hydrate&lt;/h2>
&lt;p>Accepts a JSON array of document uuids and returns fully hydrated documents, in the same order in which they were requested.
When documents are not found, an entry with the missing uuid and an error is added instead.
Supports both GET and POST.
Only allowed for users with &amp;ldquo;online&amp;rdquo; roles.&lt;/p>
&lt;h3 id="get-apiv1hydrate">GET /api/v1/hydrate&lt;/h3>
&lt;h4 id="query-parameters-5">Query parameters&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Required&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>doc_ids&lt;/td>
&lt;td>true&lt;/td>
&lt;td>A JSON array of document uuids&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="example-4">Example&lt;/h4>
&lt;pre tabindex="0">&lt;code>GET /api/v1/hydrate?doc_ids=[&amp;#34;id1&amp;#34;,&amp;#34;missingId&amp;#34;,&amp;#34;id3&amp;#34;]
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
[
{ &amp;#34;id&amp;#34;: &amp;#34;id1&amp;#34;, &amp;#34;doc&amp;#34;: { &amp;lt;...the hydrated document...&amp;gt; } },
{ &amp;#34;id&amp;#34;: &amp;#34;missingId1&amp;#34;, &amp;#34;error&amp;#34;: &amp;#34;not_found&amp;#34; },
{ &amp;#34;id&amp;#34;: &amp;#34;id3&amp;#34;, &amp;#34;doc&amp;#34;: { &amp;lt;...the hydrated document...&amp;gt; } },
]
&lt;/code>&lt;/pre>&lt;h3 id="post-apiv1hydrate">POST /api/v1/hydrate&lt;/h3>
&lt;h4 id="parameters-2">Parameters&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Required&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>doc_ids&lt;/td>
&lt;td>true&lt;/td>
&lt;td>A JSON array of document uuids&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="example-5">Example&lt;/h4>
&lt;pre tabindex="0">&lt;code>POST /api/v1/hydrate
Content-Type: application/json
{
&amp;#34;doc_ids&amp;#34;: [&amp;#34;id1&amp;#34;,&amp;#34;missingId&amp;#34;,&amp;#34;id3&amp;#34;]
}
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
[
{ &amp;#34;id&amp;#34;: &amp;#34;id1&amp;#34;, &amp;#34;doc&amp;#34;: { &amp;lt;...the hydrated document...&amp;gt; } },
{ &amp;#34;id&amp;#34;: &amp;#34;missingId&amp;#34;, &amp;#34;error&amp;#34;: &amp;#34;not_found&amp;#34; },
{ &amp;#34;id&amp;#34;: &amp;#34;id3&amp;#34;, &amp;#34;doc&amp;#34;: { &amp;lt;...the hydrated document...&amp;gt; } },
]
&lt;/code>&lt;/pre>&lt;h2 id="contacts-by-phone">Contacts by phone&lt;/h2>
&lt;p>&lt;em>Added in 3.10.0&lt;/em>
Accepts a phone number parameter and returns fully hydrated contacts that match the requested phone number.
If multiple contacts are found, all are returned. When no matches are found, a 404 error is returned.
Supports both GET and POST.
Only allowed for users with &amp;ldquo;online&amp;rdquo; roles.&lt;/p>
&lt;h3 id="get-apiv1contacts-by-phone">GET /api/v1/contacts-by-phone&lt;/h3>
&lt;h4 id="query-parameters-6">Query parameters&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Required&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>phone&lt;/td>
&lt;td>true&lt;/td>
&lt;td>A URL encoded string representing a phone number&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="example-6">Example&lt;/h4>
&lt;pre tabindex="0">&lt;code>GET /api/v1/contacts-by-phone?phone=&amp;#34;%2B40-(744)-999-999&amp;#34;
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
{
&amp;#34;ok&amp;#34;: true,
&amp;#34;docs&amp;#34;: {
{ &amp;lt;... first hydrated matching contact found ...&amp;gt; },
{ &amp;lt;... second hydrated matching contact found ...&amp;gt; },
...
}
}
&lt;/code>&lt;/pre>&lt;h3 id="post-apiv1contacts-by-phone">POST /api/v1/contacts-by-phone&lt;/h3>
&lt;h4 id="parameters-3">Parameters&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Required&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>phone&lt;/td>
&lt;td>true&lt;/td>
&lt;td>A string representing a phone number&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="example-7">Example&lt;/h4>
&lt;pre tabindex="0">&lt;code>POST /api/v1/contacts-by-phone
Content-Type: application/json
{
&amp;#34;phone&amp;#34;: &amp;#34;+40 (21) 222-3333&amp;#34;
}
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
{
&amp;#34;ok&amp;#34;: true,
&amp;#34;docs&amp;#34;: {
{ &amp;lt;... first hydrated matching contact found ...&amp;gt; },
{ &amp;lt;... second hydrated matching contact found ...&amp;gt; },
...
}
}
&lt;/code>&lt;/pre>&lt;h2 id="replication-limit">Replication Limit&lt;/h2>
&lt;p>&lt;em>Added in 3.11.0&lt;/em>
Returns the quantity of documents that were replicated by each user.
Accepts filtering by user name, when not provided, it returns all users.
Supports GET.
Only allowed for users with &amp;ldquo;_admin&amp;rdquo; role.&lt;/p>
&lt;h3 id="get-apiv1users-doc-count">GET /api/v1/users-doc-count&lt;/h3>
&lt;h4 id="query-parameters-7">Query parameters&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Required&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>user&lt;/td>
&lt;td>false&lt;/td>
&lt;td>User&amp;rsquo;s name&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="example-8">Example&lt;/h4>
&lt;pre tabindex="0">&lt;code>GET /api/v1/users-doc-count?user=mary&amp;#34;
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>HTTP/1.1 200 OK
Content-Type: application/json
{
&amp;#34;limit&amp;#34;: 10000,
&amp;#34;users&amp;#34;: {
&amp;#34;_id&amp;#34;: &amp;#34;replication-count-mary&amp;#34;,
&amp;#34;_rev&amp;#34;: &amp;#34;5-cd3252e852ae075da216c3c3fe461291&amp;#34;,
&amp;#34;user&amp;#34;: &amp;#34;mary&amp;#34;,
&amp;#34;date&amp;#34;: 1595328973273,
&amp;#34;count&amp;#34;: 58
}
}
&lt;/code>&lt;/pre>&lt;h2 id="credentials">Credentials&lt;/h2>
&lt;p>Securely store credentials for authentication with third party systems such as SMS aggregators and HMIS. Certain CHT services rely on these credentials when enabled.&lt;/p>
&lt;h3 id="put-apiv1credentials">PUT /api/v1/credentials&lt;/h3>
&lt;p>&lt;em>Added in 4.0.0&lt;/em>&lt;/p>
&lt;p>Provide the credential key as a URL parameter and the password in the request body, for example, to set a credential with key &amp;ldquo;mykey&amp;rdquo; and password &amp;ldquo;my pass&amp;rdquo; use the following command.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>curl -X PUT -H &lt;span style="color:#4e9a06">&amp;#34;Content-Type: text/plain&amp;#34;&lt;/span> https://&amp;lt;user&amp;gt;:&amp;lt;pass&amp;gt;@&amp;lt;domain&amp;gt;/api/v1/credentials/mykey -d &lt;span style="color:#4e9a06">&amp;#39;my pass&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3x-api">3.x API&lt;/h3>
&lt;p>For 3.x deployments credentials are stored in &lt;a href="https://docs.couchdb.org/en/stable/api/server/configuration.html">CouchDB configuration&lt;/a> in a custom &lt;code>medic-credentials&lt;/code> section.&lt;/p>
&lt;p>To add the credential to the admin config you need to PUT the value using curl, for example, to set a credential with key &amp;ldquo;mykey&amp;rdquo; and password &amp;ldquo;my pass&amp;rdquo; use the following command.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>curl -X PUT https://&amp;lt;user&amp;gt;:&amp;lt;pass&amp;gt;@&amp;lt;domain&amp;gt;/_node/_local/_config/medic-credentials/mykey -d &lt;span style="color:#4e9a06">&amp;#39;&amp;#34;my pass&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>You can also add it via Fauxton:&lt;/p>
&lt;ul>
&lt;li>Navigate to the Config screen at &lt;code>https://&amp;lt;domain&amp;gt;/_utils/#/_config&lt;/code>&lt;/li>
&lt;li>Click &lt;code>Add Option&lt;/code>&lt;/li>
&lt;li>The &lt;code>Section&lt;/code> should be &lt;code>medic-credentials&lt;/code>, the &lt;code>Name&lt;/code> should be (in this example) &lt;code>mykey&lt;/code> and the value should be the password&lt;/li>
&lt;li>Click &lt;code>Create&lt;/code>&lt;/li>
&lt;li>You should then be able to see your credential in the list of configuration shown&lt;/li>
&lt;/ul></description></item><item><title>Apps: forms/</title><link>https://docs.communityhealthtoolkit.org/apps/reference/forms/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/apps/reference/forms/</guid><description/></item><item><title>Apps: resources/</title><link>https://docs.communityhealthtoolkit.org/apps/reference/resources/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/apps/reference/resources/</guid><description>
&lt;h2 id="icons">Icons&lt;/h2>
&lt;p>Apps can be customized by defining the icons to use for tasks, targets, and contacts.&lt;/p>
&lt;p>Add icons to the &lt;code>resources&lt;/code> folder, and include them by name in the &lt;code>resources.json&lt;/code> file as the following example:&lt;/p>
&lt;pre tabindex="0">&lt;code> {
&amp;#34;icon-risk&amp;#34;: &amp;#34;icon-healthcare-warning@2x.png&amp;#34;,
&amp;#34;icon-treatment&amp;#34;: &amp;#34;icon-healthcare-medicine@2x.png&amp;#34;,
&amp;#34;medic-clinic&amp;#34;: &amp;#34;medic-family.svg&amp;#34;,
&amp;#34;medic-district-hospital&amp;#34;: &amp;#34;medic-family.svg&amp;#34;,
&amp;#34;medic-health-center&amp;#34;: &amp;#34;medic-chw-area.svg&amp;#34;,
&amp;#34;medic-person&amp;#34;: &amp;#34;medic-person.svg&amp;#34;
}
&lt;/code>&lt;/pre>
&lt;p>&lt;em>See Also&lt;/em>: &lt;a href="https://docs.communityhealthtoolkit.org/design/icons/">Icon Library&lt;/a>&lt;/p>
&lt;p>The folder and files structure would look like this:&lt;/p>
&lt;pre tabindex="0">&lt;code>./
resources.json
/resources
icon-healthcare-warning@2x.png
icon-healthcare-medicine@2x.png
medic-family.svg
medic-family.svg
medic-chw-area.svg
medic-person.svg
&lt;/code>&lt;/pre>&lt;p>Finally run the command: &lt;code>cht --local upload-resources&lt;/code>&lt;/p>
&lt;h2 id="branding">Branding&lt;/h2>
&lt;p>The site title, favicon, and header logo are configurable. The location to change these are in the Admin console on the images page under the branding tab.&lt;/p>
&lt;p>Another way to configure these options is by using the &lt;code>cht-conf&lt;/code>, add the favicon and the header logo in the &lt;code>branding&lt;/code> folder, then include the options in the &lt;code>branding.json&lt;/code> as the following example:&lt;/p>
&lt;pre tabindex="0">&lt;code> {
&amp;#34;title&amp;#34;: &amp;#34;My Clinic&amp;#34;,
&amp;#34;resources&amp;#34;: {
&amp;#34;logo&amp;#34;: &amp;#34;logo.png&amp;#34;,
&amp;#34;favicon&amp;#34;: &amp;#34;favicon.ico&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;p>The folder and files structure would look like this:&lt;/p>
&lt;pre tabindex="0">&lt;code>./
branding.json
/branding
logo.png
favicon.ico
&lt;/code>&lt;/pre>&lt;p>Finally run the command: &lt;code>cht --local upload-branding&lt;/code>&lt;/p>
&lt;h2 id="partner-logos">Partner logos&lt;/h2>
&lt;p>Adding your partner logos can be done in the Admin console on the images page under the Partners tab. This will add partner logos on the about page.&lt;/p>
&lt;p>Another way is by using the &lt;code>cht-conf&lt;/code>, add the partners logo in the &lt;code>partners&lt;/code> folder, then include them in the &lt;code>partners.json&lt;/code> as the following example:&lt;/p>
&lt;pre tabindex="0">&lt;code> {
&amp;#34;resources&amp;#34;: {
&amp;#34;partnerA&amp;#34;: &amp;#34;parnerA.png&amp;#34;,
&amp;#34;partnerB&amp;#34;: &amp;#34;parnerB.png&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;p>The folder and files structure would look like this:&lt;/p>
&lt;pre tabindex="0">&lt;code>./
partners.json
/partners
parnerA.png
parnerB.png
&lt;/code>&lt;/pre>&lt;p>Finally run the command: &lt;code>cht --local upload-partners&lt;/code>&lt;/p></description></item><item><title>Apps: translations/</title><link>https://docs.communityhealthtoolkit.org/apps/reference/translations/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/apps/reference/translations/</guid><description>
&lt;p>Given that CHT apps are used around the world, the Core Framework was designed with localization in mind. The Core Framework itself is available in English, French, Hindi, Nepali, Spanish, Swahili, and Indonesian.&lt;br>
In the &lt;code>app_settings.json&lt;/code> file the default language for the application is set by the &lt;code>locale&lt;/code> property, along with a separate default language for outgoing messages that are sent via SMS with the &lt;code>locale_outgoing&lt;/code> property.&lt;br>
Additionally, languages available to the user can be enabled and disabled through the &lt;code>languages&lt;/code> property which contains an array of objects. These objects should contain the &lt;code>locale&lt;/code> and &lt;code>enabled&lt;/code> properties representing respectively the 2 or 3 letter language code and whether that language should be enabled.&lt;/p>
&lt;div class="alert alert-info" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
Please open &lt;a href="https://github.com/medic/cht-core/issues/new">an issue&lt;/a> if you are interested in translating the app into a different language, as we can work together to make that language available to the community.
&lt;/div>
&lt;h2 id="translations">Translations&lt;/h2>
&lt;p>To modify some labels in the app add the key and modified label in a custom translations file in the &lt;code>translations&lt;/code> folder. All the properties files use the format &lt;code>messages-{language-code}.properties&lt;/code>, where the language code is the same 2-letter code used to identify the language in the application. For instance, for English, we would have a &lt;code>translations/messages-en.properties&lt;/code> file.&lt;/p>
&lt;p>New elements in CHT apps, such as tasks, targets, profiles, and forms should be localized as well. These labels should be included in the same custom translations properties file. If a translation is missing for the user&amp;rsquo;s language it will use that of the default language.&lt;/p>
&lt;p>Here is an example, including both a modified label, and a new one:&lt;/p>
&lt;h3 id="translationsmessages-language-codeproperties">&lt;code>translations/messages-{language-code}.properties&lt;/code>&lt;/h3>
&lt;pre tabindex="0">&lt;code> [Application Text]
contact.type.district_hospital = Community
targets.assessments.title = Assessments Completed
&lt;/code>&lt;/pre>&lt;h2 id="forms">Forms&lt;/h2>
&lt;p>Translations for XForms are defined within the forms themselves. The XLSForm notation is &lt;a href="http://xlsform.org/en/#multiple-language-support">documented here&lt;/a>, and would use the corresponding 2-character language codes.&lt;/p>
&lt;h2 id="reports">Reports&lt;/h2>
&lt;p>Submitted forms are shown on the Reports tab, with each value in the report displayed alongside a label. The label for each value is represented by a key in the &lt;code>report.{form-name}.{field-name}&lt;/code> format, which can be translated by including the key and translation in the &lt;a href="#translations">language files&lt;/a>. If the label is omitted in the translation the full key will show in the app.&lt;/p>
&lt;div class="alert alert-info" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
To hide report fields from showing on the Reports view altogether, the containing group or field must be included as &lt;code>hidden_fields&lt;/code>, as per the &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/forms/app/#properties">form properties file&lt;/a>.
&lt;/div>
&lt;h2 id="build">Build&lt;/h2>
&lt;p>Custom translations from the properties files are added to the app with the &lt;code>upload-custom-translations&lt;/code> action.&lt;/p>
&lt;p>&lt;code>cht --local upload-custom-translations&lt;/code>&lt;/p>
&lt;p>Updated translations from forms need to be added with the actions to upload forms.&lt;/p>
&lt;p>&lt;code>cht --local upload-contact-forms upload-app-forms&lt;/code>&lt;/p></description></item><item><title>Apps: app_settings.json</title><link>https://docs.communityhealthtoolkit.org/apps/reference/app-settings/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/apps/reference/app-settings/</guid><description>
&lt;p>The settings which control CHT apps are defined in the &lt;code>app_settings.json&lt;/code> file, and stored in the &lt;code>settings&lt;/code> doc in the database. Some settings can be modified in the &lt;a href="https://docs.communityhealthtoolkit.org/apps/features/admin/">&lt;strong>App Management&lt;/strong>&lt;/a> app, which updates the same settings file in the database.&lt;/p>
&lt;p>The settings get compiled into the &lt;code>app_settings.json&lt;/code> file with the &lt;code>compile-app-settings&lt;/code> action in the &lt;code>cht-conf&lt;/code> tool. Manually configurable settings are added to the &lt;code>app_settings&lt;/code> folder at the root of the config folder. The &lt;code>app_settings/base_settings.json&lt;/code> file can be manually edited to modify individual settings. &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/forms/">&lt;code>forms&lt;/code>&lt;/a> and &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/schedules/">&lt;code>schedules&lt;/code>&lt;/a> sections can be defined in separate files named &lt;code>app_settings/forms.json&lt;/code> and &lt;code>app_settings/schedules.json&lt;/code> respectively with the settings in the files overriding what might be already present in the &lt;code>app_settings/base_settings.json&lt;/code> or &lt;code>app_settings.json&lt;/code> files.&lt;/p>
&lt;p>Most sections are described on their own in the &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/">Reference Documentation&lt;/a>.&lt;/p>
&lt;h2 id="build">Build&lt;/h2>
&lt;p>To include your settings into your app, you must compile them to include modular components, then upload them to your instance.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>cht --local compile-app-settings backup-app-settings upload-app-settings
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="optional-settings">Optional Settings&lt;/h2>
&lt;p>The following settings do not need to be specified. They should only be defined when the default implementation needs to be changed.&lt;/p>
&lt;h3 id="app_settingsjson">&lt;code>app_settings.json&lt;/code>&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Setting&lt;/th>
&lt;th>Description&lt;/th>
&lt;th>Default&lt;/th>
&lt;th>Version&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>phone_validation&lt;/td>
&lt;td>&lt;ul>&lt;li>&amp;ldquo;full&amp;rdquo;: full validation of a phone number for a region using length and prefix information.&lt;/li>&lt;li>&amp;ldquo;partial&amp;rdquo;: quickly guesses whether a number is a possible phone number by using only the length information, much faster than a full validation.&lt;/li>&lt;li>&amp;ldquo;none&amp;rdquo;: allows almost any values but still fails for any phone that contains a-z chars.&lt;/li>&lt;/ul>&lt;/td>
&lt;td>&amp;ldquo;full&amp;rdquo;&lt;/td>
&lt;td>3.1.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>uhc.contacts_default_sort&lt;/td>
&lt;td>&lt;ul>&lt;li>&amp;ldquo;alpha&amp;rdquo;: Sort contacts alphanumerically&lt;/li>&lt;li>&amp;ldquo;last_visited_date&amp;rdquo;: sort contacts by the date they were most recently visited.&lt;/li>&lt;/ul>&lt;/td>
&lt;td>&amp;ldquo;alpha&amp;rdquo;&lt;/td>
&lt;td>2.18.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>uhc.visit_count.month_start_date&lt;/td>
&lt;td>The date of each month when the visit count is reset to 0.&lt;/td>
&lt;td>1&lt;/td>
&lt;td>2.18.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>uhc.visit_count.visit_count_goal&lt;/td>
&lt;td>The monthly visit count goal.&lt;/td>
&lt;td>0&lt;/td>
&lt;td>2.18.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>outgoing_deny_list&lt;/td>
&lt;td>All outgoing messages will be denied (unsent) if the recipient phone number starts with an entry in this list. A comma delimited list. (eg. &lt;code>outgoing_deny_list=&amp;quot;253,ORANGE&amp;quot;&lt;/code> will deny all messages sent to &lt;code>253 543 4448&lt;/code> and &lt;code>ORANGE NET&lt;/code>)&lt;/td>
&lt;td>&amp;quot;&amp;quot;&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>outgoing_deny_shorter_than&lt;/td>
&lt;td>Deny all messages to recipient phone numbers which are shorter than this value. Intended to avoid &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/messaging/message-loops/">message loops&lt;/a> with short codes used by gateways (eg. &lt;code>60396&lt;/code>). An integer.&lt;/td>
&lt;td>6&lt;/td>
&lt;td>3.3.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>outgoing_deny_with_alphas&lt;/td>
&lt;td>When &lt;code>true&lt;/code>, deny all messages to recipient phone numbers containing letters (eg. &lt;code>Safaricom&lt;/code>). Intended to avoid &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/messaging/message-loops/">message loops&lt;/a> with non-numeric senders used by gateways. A boolean.&lt;/td>
&lt;td>true&lt;/td>
&lt;td>3.3.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>outgoing_deny_with_alphas&lt;/td>
&lt;td>When &lt;code>true&lt;/code>, deny all messages to recipient phone numbers containing letters (eg. &lt;code>Safaricom&lt;/code>). Intended to avoid &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/messaging/message-loops/">message loops&lt;/a> with non-numeric senders used by gateways. A boolean.&lt;/td>
&lt;td>true&lt;/td>
&lt;td>3.3.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>task_day_limit&lt;/td>
&lt;td>The number of days before a task is due to show the due date.&lt;/td>
&lt;td>4&lt;/td>
&lt;td>3.9.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>app_url&lt;/td>
&lt;td>The URL of the app, eg: &amp;ldquo;&lt;a href="https://demo.app.medicmobile.org">https://demo.app.medicmobile.org&lt;/a>&amp;rdquo;&lt;/td>
&lt;td>&lt;/td>
&lt;td>3.10.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>task_days_overdue&lt;/td>
&lt;td>Display number of overdue days in tasks list&lt;/td>
&lt;td>false&lt;/td>
&lt;td>3.13.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>languages&lt;/td>
&lt;td>Array of objects with &lt;code>locale&lt;/code> and &lt;code>enabled&lt;/code> properties representing respectively the 2 or 3 letter language code and whether that language should be enabled. &lt;br/>If unset it falls back to the previous behavior of relying on the &lt;code>enabled&lt;/code> property of each translation document &lt;code>messages-XX.properties&lt;/code>. This fallback behavior is now deprecated and will be removed in the next major version (5.0). This &lt;code>languages&lt;/code> configuration property will be required for CHT 5.0+.&lt;/td>
&lt;td>&lt;/td>
&lt;td>4.2.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>place_hierarchy_types&lt;/td>
&lt;td>Array of contact types&amp;rsquo; IDs, should match the ones defined in &lt;code>contact_types&lt;/code>. This is used to define the Place Filter&amp;rsquo;s options in Reports tab.&lt;/td>
&lt;td>&lt;/td>
&lt;td>2.15.0&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="sms-workflows">SMS Workflows&lt;/h2>
&lt;p>Workflows involving SMS are configured by defining &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/schedules/">schedules&lt;/a>, &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/registrations/">registrations&lt;/a>, &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/patient_reports/">patient reports&lt;/a>, and &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/accept_case_reports/">case reports&lt;/a>. Schedules of automated messages can be sent from the server at specified times in the future, and reports can be associated to contacts. Forms can also be configured to clear the schedule, or silence it for a period of time.
As of &lt;code>3.11.0&lt;/code>, places are valid subjects for any SMS workflows.&lt;/p>
&lt;h2 id="sms-recipient-resolution">SMS recipient resolution&lt;/h2>
&lt;p>An outgoing SMS message configuration has the following fields:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>translation_key&lt;/code>&lt;/td>
&lt;td>The translation key of the message to send out. Available in 2.15+.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages&lt;/code>&lt;/td>
&lt;td>(&lt;strong>deprecated&lt;/strong>) Array of message objects, each with &lt;code>content&lt;/code> and &lt;code>locale&lt;/code> properties. From 2.15 on use &lt;code>translation_key&lt;/code> instead.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>recipient&lt;/code>&lt;/td>
&lt;td>Recipient of the message.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="recipient-values-and-resolutions">&lt;code>recipient&lt;/code> values and resolutions:&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>value&lt;/th>
&lt;th>resolves to&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;em>empty&lt;/em>&lt;/td>
&lt;td>submitter&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>reporting_unit&lt;/code>&lt;/td>
&lt;td>submitter&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>parent&lt;/code>&lt;/td>
&lt;td>primary contact of the subject&amp;rsquo;s/submitter&amp;rsquo;s place&amp;rsquo;s parent (&lt;code>patient.parent.parent.contact&lt;/code>)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>grandparent&lt;/code>&lt;/td>
&lt;td>primary contact of the subject&amp;rsquo;s/submitter&amp;rsquo;s place&amp;rsquo;s grandparent (&lt;code>patient.parent.parent.parent.contact&lt;/code>)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>clinic&lt;/code>&lt;/td>
&lt;td>primary contact of the &lt;code>clinic&lt;/code> in the subject&amp;rsquo;s/submitter&amp;rsquo;s lineage&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>health_center&lt;/code>&lt;/td>
&lt;td>primary contact of the &lt;code>health_center&lt;/code> in the subject&amp;rsquo;s/submitter&amp;rsquo;s lineage&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>district&lt;/code>&lt;/td>
&lt;td>primary contact of the &lt;code>district_hospital&lt;/code> in the subject&amp;rsquo;s/submitter&amp;rsquo;s lineage&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ancestor:&amp;lt;contact_type&amp;gt;&lt;/code>&lt;/td>
&lt;td>primary contact of the place of the requested type in the subject&amp;rsquo;s/submitter&amp;rsquo;s lineage&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>link:&amp;lt;tag&amp;gt;&lt;/code>&lt;/td>
&lt;td>Linked doc that has requested &lt;code>tag&lt;/code> in the subject&amp;rsquo;s / submitter&amp;rsquo;s lineage (direct mapping, not to primary contact). &lt;em>As of 3.10.x&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>link:&amp;lt;contact_type&amp;gt;&lt;/code>&lt;/td>
&lt;td>primary contact of the place of the requested &lt;code>contact_type&lt;/code> in the subject&amp;rsquo;s/submitter&amp;rsquo;s lineage. &lt;em>As of 3.10.x&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>custom object path&lt;/em>&lt;/td>
&lt;td>a direct object path in the &lt;a href="#message-context">message context object&lt;/a> eg: &lt;code>patient.parent.contact.other_phone&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>valid phone number&lt;/em>&lt;/td>
&lt;td>requested phone number&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
&lt;ul>
&lt;li>if &lt;code>recipient&lt;/code> resolution does not yield a phone number, it will default to submitter&amp;rsquo;s phone number&lt;/li>
&lt;li>if there is no submitter phone number available, the actual &lt;code>recipient&lt;/code> property value will be used&lt;/li>
&lt;li>when mapping a contact phone number, subject (&lt;code>patient&lt;/code> and/or &lt;code>place&lt;/code>) lineage and &lt;code>linked_docs&lt;/code> take precedence over &lt;code>submitter&lt;/code> lineage and &lt;code>linked_docs&lt;/code>.&lt;/li>
&lt;li>except for &lt;code>link:&amp;lt;tag&amp;gt;&lt;/code>, phone numbers are resolved to the primary contacts of the requested places. &lt;code>linked_docs&lt;/code> hydration is shallow, so the primary contact of the linked doc will not be available.&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h3 id="message-context">Message context&lt;/h3>
&lt;p>The message context object consists of:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>value description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;em>every property from the original report&lt;/em>&lt;/td>
&lt;td>unchanged unless specified below&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>every &lt;code>fields&lt;/code> property from the original report&lt;/em>&lt;/td>
&lt;td>eg: if the report has &lt;code>fields.test = 'test'&lt;/code> then &lt;code>context.test = 'test'&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>patient&lt;/td>
&lt;td>deeply hydrated patient contact (resolved from &lt;code>patient_id&lt;/code>, &lt;code>fields.patient_id&lt;/code> or &lt;code>fields.patient_uuid&lt;/code>)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>patient_name&lt;/td>
&lt;td>patient&amp;rsquo;s name&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>place&lt;/td>
&lt;td>deeply hydrated place document (resolved from &lt;code>place_id&lt;/code> or &lt;code>fields.place_id&lt;/code>)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>contact&lt;/td>
&lt;td>deeply hydrated submitter contact&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>parent&lt;/td>
&lt;td>deeply hydrated &lt;code>health_center&lt;/code> type document from the subject&amp;rsquo;s or submitter&amp;rsquo;s lineage&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>grandparent&lt;/td>
&lt;td>deeply hydrated &lt;code>district_hospital&lt;/code> type document from the subject&amp;rsquo;s or submitter&amp;rsquo;s lineage&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>clinic&lt;/td>
&lt;td>deeply hydrated &lt;code>clinic&lt;/code> type document from the subject&amp;rsquo;s or submitter&amp;rsquo;s lineage&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>health_center&lt;/td>
&lt;td>deeply hydrated &lt;code>health_center&lt;/code> type document from the subject&amp;rsquo;s or submitter&amp;rsquo;s lineage&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>district_hospital&lt;/td>
&lt;td>deeply hydrated &lt;code>district_hospital&lt;/code> type document from the subject&amp;rsquo;s or submitter&amp;rsquo;s lineage&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="variables">Variables&lt;/h2>
&lt;p>Outgoing messages can use &lt;a href="https://mustache.github.io/mustache.5.html">Mustache templating&lt;/a> to insert variables and specify data formats.
All &lt;a href="#message-context">message context fields&lt;/a> are available as variables.&lt;/p>
&lt;h3 id="code-sample">Code sample&lt;/h3>
&lt;p>The following translation label includes the &lt;code>name&lt;/code> field of &lt;code>contact&lt;/code>, along with the submitted &lt;code>patient_name&lt;/code> field, and the generated &lt;code>patient_id&lt;/code> field.&lt;/p>
&lt;h4 id="translationsmessages-enproperties">&lt;code>translations/messages-en.properties&lt;/code>&lt;/h4>
&lt;pre tabindex="0">&lt;code>messages.registration.report_accepted = Thank you {{contact.name}} for registering {{patient_name}}. Their ID is {{patient_id}}.
&lt;/code>&lt;/pre>&lt;h3 id="date-format-filters">Date Format Filters&lt;/h3>
&lt;p>The following filter functions are available for formating dates.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>filter&lt;/th>
&lt;th>description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>date&lt;/code>&lt;/td>
&lt;td>Displays dates according to the &lt;code>date_format&lt;/code> specified in app_settings. See &lt;a href="https://momentjs.com/docs/#/parsing/string-format/">doc for Moment.js format&lt;/a> for details.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>datetime&lt;/code>&lt;/td>
&lt;td>Displays dates according to the &lt;code>reported_date_format&lt;/code> specified in app_settings. See &lt;a href="https://momentjs.com/docs/#/parsing/string-format/">doc for Moment.js format&lt;/a> for details.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>bikram_sambat_date&lt;/code>&lt;/td>
&lt;td>Displays dates in Bikram Sambat calendar (most commonly used calendar in Nepal). Currently display format is hardcoded to e.g. &amp;ldquo;à¥§à¥« à¤šà¥ˆà¤¤ à¥¨à¥¦à¥­à¥©&amp;rdquo;.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="validations">Validations&lt;/h2>
&lt;p>Validation rules are code fragments used to determine if some input is valid. For example, to say a field is only valid if the value has at least five characters, you would use the lenMin(5). They are used in &lt;code>registrations[].validations.list[].rule&lt;/code> and &lt;code>patient_reports[].validations.list[].rule&lt;/code> to determine if an incoming report is accepted. A report is accepted as valid only if all rules return &lt;code>true&lt;/code>. If any validation rule returns &lt;code>false&lt;/code> then the report is marked as invalid, and a message is automatically sent to the submitter. The content for the message is set in the &lt;code>translation_key&lt;/code> associated to each rule. If a report fails multiple validations then each message will be sent. These can be combined into a single SMS by specifying &lt;code>&amp;quot;*.validations.join_responses&amp;quot; : true&lt;/code>.&lt;/p>
&lt;h3 id="operators">Operators&lt;/h3>
&lt;p>The available operators are:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Operator&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&amp;amp;&amp;amp;&lt;/td>
&lt;td>and&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>||&lt;/td>
&lt;td>or&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>!&lt;/td>
&lt;td>not&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>a ? b : c&lt;/td>
&lt;td>ternary, ie: if &amp;lsquo;a&amp;rsquo; is true, then check &amp;lsquo;b&amp;rsquo;, otherwise check &amp;lsquo;c&amp;rsquo;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>()&lt;/td>
&lt;td>nested blocks, eg: &amp;lsquo;a &amp;amp;&amp;amp; (b&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="rules">Rules&lt;/h3>
&lt;p>Validation settings may consist of Pupil.js rules and rules specific to the CHT.
These two types of rules cannot be combined as part of the same rule.&lt;/p>
&lt;p>Not OK:
&lt;code>rule: &amp;quot;regex(\d{5}) &amp;amp;&amp;amp; unique('patient_id')&amp;quot;&lt;/code>&lt;/p>
&lt;p>OK:
&lt;code>rule: &amp;quot;regex(\d{5}) &amp;amp;&amp;amp; max(11111)&amp;quot;&lt;/code>&lt;/p>
&lt;p>If for example you want to validate that patient_id is 5 numbers and it
is unique (or some other custom validation) you need to define two
validation configs/separate rules in your settings. Example validation
settings:&lt;/p>
&lt;pre tabindex="0">&lt;code>[
{
property: &amp;#34;patient_id&amp;#34;,
rule: &amp;#34;regex(\d{5})&amp;#34;,
message: [{
content: &amp;#34;Patient ID must be 5 numbers.&amp;#34;,
locale: &amp;#34;en&amp;#34;
}]
},
{
property: &amp;#34;patient_id&amp;#34;,
rule: &amp;#34;unique(&amp;#39;patient_id&amp;#39;)&amp;#34;,
message: [{
content: &amp;#34;Patient ID must be unique.&amp;#34;,
locale: &amp;#34;en&amp;#34;
}]
}
]
&lt;/code>&lt;/pre>&lt;p>&lt;code>validate()&lt;/code> modifies the property value of the second item to
&lt;code>patient_id_unique&lt;/code> so that pupil.validate() still returns a valid
result. Then we process the result once more to extract the custom
validation results and error messages.&lt;/p>
&lt;h4 id="pupiljs-validation-functions">Pupil.js validation functions&lt;/h4>
&lt;p>Available validation functions are available in the &lt;a href="https://github.com/medic/cht-core/tree/master/shared-libs/validation/src/pupil#validation-functions">Pupil documentation&lt;/a>.&lt;/p>
&lt;p>The following functions are available by default:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Function&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>equals&lt;/code>&lt;/td>
&lt;td>Comparison&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>iEquals&lt;/code>&lt;/td>
&lt;td>Case insensitive comparison&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>sEquals&lt;/code>&lt;/td>
&lt;td>Type sensitive equals&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>siEquals&lt;/code>&lt;/td>
&lt;td>Type sensitive case insensitive equals&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>lenMin&lt;/code>&lt;/td>
&lt;td>Minimum length&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>lenMax&lt;/code>&lt;/td>
&lt;td>Maximum length&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>lenEquals&lt;/code>&lt;/td>
&lt;td>Exact length&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>min&lt;/code>&lt;/td>
&lt;td>Minimum value&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>max&lt;/code>&lt;/td>
&lt;td>Maximum value&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>between&lt;/code>&lt;/td>
&lt;td>Minimum and maximum value&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>in&lt;/code>&lt;/td>
&lt;td>One of the provided values&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>required&lt;/code>&lt;/td>
&lt;td>Must have a value&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>optional&lt;/code>&lt;/td>
&lt;td>Always valid&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>numeric&lt;/code>&lt;/td>
&lt;td>Numbers only&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>integer&lt;/code>&lt;/td>
&lt;td>Integer numbers only&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>alpha&lt;/code>&lt;/td>
&lt;td>Letters only&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>alphaNumeric&lt;/code>&lt;/td>
&lt;td>Numbers and letters only&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>email&lt;/code>&lt;/td>
&lt;td>Email address format&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>regex&lt;/code>&lt;/td>
&lt;td>A custom regular expression&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>equalsTo&lt;/code>&lt;/td>
&lt;td>Compare to another field by its key&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h5 id="sample-usage">Sample usage&lt;/h5>
&lt;p>For case-insensitive comparison &lt;code>iEquals&lt;/code> function in Pupil,
And you can use &lt;code>||&lt;/code> for logical OR. Find documentation on these rules in the &lt;a href="https://github.com/medic/cht-core/tree/master/shared-libs/validation/src/pupil#rule-strings">Pupil documentation&lt;/a>.&lt;/p>
&lt;p>So you can do this :
&lt;code>rule: 'iEquals(&amp;quot;mary&amp;quot;) || iEquals(&amp;quot;john&amp;quot;)'&lt;/code>
matches &amp;ldquo;mary&amp;rdquo;, &amp;ldquo;Mary&amp;rdquo;, &amp;ldquo;john&amp;rdquo;, &amp;ldquo;John&amp;rdquo;, &amp;ldquo;JOhN&amp;rdquo;, etc. Not &amp;ldquo;maryjohn&amp;rdquo;&lt;/p>
&lt;h4 id="cht-validation-functions">CHT validation functions&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Function&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>unique(*fields)&lt;/code>&lt;/td>
&lt;td>Returns &lt;code>true&lt;/code> if no existing valid report has the same value for all of the listed fields. Fields are compared to those at the top level and within &lt;code>fields&lt;/code> for every report doc. To include the form type use &lt;code>'form'&lt;/code> as one of the fields. Eg &lt;code>unique('form', 'patient_id')&lt;/code> checks that this form was never submitted for this patient.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>uniqueWithin(*fields, time_period)&lt;/code>&lt;/td>
&lt;td>Same as &lt;code>unique&lt;/code> but the last argument is the time period in which to search. Eg &lt;code>uniqueWithin('form', 'patient_id', '1 week')&lt;/code> checks that the same form wasn&amp;rsquo;t submitted for this patient in the past week.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>exists(form_id, field)&lt;/code>&lt;/td>
&lt;td>Returns &lt;code>true&lt;/code> if a report matches the &lt;code>form_id&lt;/code> and value for &lt;code>field&lt;/code>. This is useful to check that a patient was registered for a service before reporting about it. Eg &lt;code>exists('REG', 'patient_id')&lt;/code> checks that a &lt;code>REG&lt;/code> form was already submitted for a patient. As of 2.12 most uses of this function are obsolete because checking for a valid &lt;code>patient_id&lt;/code> is done automatically by the &lt;code>accept_patient_report&lt;/code> transition using &lt;code>registration_not_found&lt;/code> in the &lt;code>messages.event_type&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isISOWeek(weekFieldName[, yearFieldName])&lt;/code>&lt;/td>
&lt;td>Returns &lt;code>true&lt;/code> if the current report has a week value that is less or equal to the number of ISO weeks of the current year or the year value of the same report. The first parameter is the field name for the week and the second parameter is the field name for the year: &lt;code>isISOWeek('week', 'year')&lt;/code>. If the second parameter is not specified, then the current year is used: &lt;code>isISOWeek('week')&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isAfter(duration)&lt;/code>&lt;/td>
&lt;td>Returns &lt;code>true&lt;/code> if the date property comes after today plus the duration. For this to work, the property should be a date type. e.g. &lt;code>isAfter('2 weeks')&lt;/code> checks that the date property is at least two weeks in the future from today. Negative values are also supported.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isBefore(duration)&lt;/code>&lt;/td>
&lt;td>Returns &lt;code>true&lt;/code> if the date property comes before today minus the duration. For this to work, the property should be a date type. e.g. &lt;code>isBefore('2 weeks')&lt;/code> checks that the date property is at least two weeks in the past from today. Negative values are also supported.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Apps: contact-summary.templated.js</title><link>https://docs.communityhealthtoolkit.org/apps/reference/contact-page/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/apps/reference/contact-page/</guid><description>
&lt;p>Contact profile pages display basic information about the contact along with their history and upcoming tasks.
A contact&amp;rsquo;s profile page is defined by the &lt;a href="#contact-summary">Fields&lt;/a>, &lt;a href="#condition-cards">Cards&lt;/a>, and &lt;a href="#care-guides">Care Guides&lt;/a> available.&lt;/p>
&lt;p>Helper variables and functions for the contact summary can be defined in &lt;code>contact-summary-extras.js&lt;/code>. There are several variables available to inspect to generate the summary information:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>contact&lt;/code>&lt;/td>
&lt;td>The currently selected contact. This has minimal stubs for the &lt;code>contact.parent&lt;/code>, so if you want to refer to a property on the parent use &lt;code>lineage&lt;/code> below.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>reports&lt;/code>&lt;/td>
&lt;td>An array of reports for the contact.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>lineage&lt;/code>&lt;/td>
&lt;td>An array of the contact&amp;rsquo;s parents (2.13+), eg &lt;code>lineage[0]&lt;/code> is the parent, &lt;code>lineage[1]&lt;/code> is the grandparent, etc. Each lineage entry has full information for the contact, so you can use &lt;code>lineage[1].contact.phone&lt;/code>. &lt;code>lineage&lt;/code> will include only those contacts which are visible to the logged in profile&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>targetDoc&lt;/code>&lt;/td>
&lt;td>Doc with &lt;a href="https://docs.communityhealthtoolkit.org/core/overview/db-schema/#targets">&lt;code>target&lt;/code>&lt;/a> document of the contact, hydrated with the config information of every target it contains a value for. If there is no target document available (for example when viewing a contact that does not upload targets), this value will be &lt;code>undefined&lt;/code>. This value might also be &lt;code>undefined&lt;/code> if the contact has not yet synced the current target document. Added in &lt;code>3.9.0&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>uhcStats&lt;/code>&lt;/td>
&lt;td>Object containing UHC stats information. Added in &lt;code>v3.12.0&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>uhcStats.uhcInterval&lt;/code>&lt;/td>
&lt;td>Object containing the start and end date of UHC reporting period, it is calculated from the &lt;code>uhc.visit_count.month_start_date&lt;/code> defined in the &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/#app_settingsjson">app settings&lt;/a>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>uhcStats.uhcInterval.start&lt;/code>&lt;/td>
&lt;td>Timestamp, start date of the UHC reporting period.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>uhcStats.uhcInterval.end&lt;/code>&lt;/td>
&lt;td>Timestamp, end date of the UHC reporting period.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>uhcStats.homeVisits&lt;/code>&lt;/td>
&lt;td>Object containing the contact&amp;rsquo;s home visits stats. The &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/hierarchy/#app_settingsjson-contact_types">contact&amp;rsquo;s type&lt;/a> should have &lt;code>count_visits&lt;/code> enabled and the &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/#app_settingsjson">UHC visit count settings&lt;/a> should be defined, additionally this information is only available for users that have &lt;code>can_view_uhc_stats&lt;/code> permission and that are not System Administrators.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>uhcStats.homeVisits.lastVisitedDate&lt;/code>&lt;/td>
&lt;td>Timestamp, date of contact&amp;rsquo;s last home visit.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>uhcStats.homeVisits.count&lt;/code>&lt;/td>
&lt;td>Number of contact&amp;rsquo;s home visits in the current reporting interval.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>uhcStats.homeVisits.countGoal&lt;/code>&lt;/td>
&lt;td>Number, home visits goal, defined in the &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/app-settings/#app_settingsjson">UHC visit count settings&lt;/a>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>cht&lt;/code>&lt;/td>
&lt;td>Object containing the &lt;a href="#cht-api">CHT API&lt;/a> for contact summary, targets and tasks. Added in &lt;code>v3.12.0&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="cht-api">CHT API&lt;/h2>
&lt;p>&lt;em>Introduced in v3.12.0&lt;/em>&lt;/p>
&lt;p>Provides CHT-Core Framework&amp;rsquo;s functions to contact summary, targets and tasks. The API is available in the &lt;code>cht&lt;/code> reserved variable under the &lt;code>v1&lt;/code> version.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Function&lt;/th>
&lt;th>Arguments&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>hasPermissions(permissions, userRoles, chtPermissionsSettings)&lt;/td>
&lt;td>&lt;code>permissions&lt;/code>: String or array of permission name(s).&lt;br>&lt;code>userRoles&lt;/code>: (Optional) Array of user roles. Default to the current logged in user.&lt;br>&lt;code>chtPermissionsSettings&lt;/code>: (Optional) Object of configured permissions in CHT-Core&amp;rsquo;s settings. Default to the current instance&amp;rsquo;s configured permissions.&lt;/td>
&lt;td>Returns true if the user has the permission(s), otherwise returns false.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>hasAnyPermission(permissionsGroups, userRoles, chtPermissionsSettings)&lt;/td>
&lt;td>&lt;code>permissionsGroups&lt;/code>: Array of groups of permission name(s).&lt;br>&lt;code>userRoles&lt;/code>: (Optional) Array of user roles. Default to the current logged in user.&lt;br>&lt;code>chtPermissionsSettings&lt;/code>: (Optional) Object of configured permissions in CHT-Core&amp;rsquo;s settings. Default to the current instance&amp;rsquo;s configured permissions.&lt;/td>
&lt;td>Returns true if the user has all the permissions of any of the provided groups, otherwise returns false.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>getExtensionLib(name)&lt;/td>
&lt;td>&lt;code>name&lt;/code>: String of script name&lt;/td>
&lt;td>Returns an executable function identified by the given name configured as &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/extension-libs/">extension-libs&lt;/a>.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="cht-apis-code-samples">CHT API&amp;rsquo;s code samples&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">canEdit&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hasPermissions&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_edit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">canManagePlaces&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hasPermissions&lt;/span>&lt;span style="color:#000;font-weight:bold">([&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_create_places&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;can_update_places&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">hasAnyGroup&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hasAnyPermission&lt;/span>&lt;span style="color:#000;font-weight:bold">([&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_view_messages&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;can_view_message_action&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_view_reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;can_verify_reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">averageFn&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">getExtensionLib&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;average.js&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;h2 id="contact-summary">Contact Summary&lt;/h2>
&lt;p>Each field that can be shown on a contact&amp;rsquo;s profile is defined as an object in the &lt;code>fields&lt;/code> array of &lt;code>contact-summary.templated.js&lt;/code>. The properties for each object determine how and when the field is shown.&lt;/p>
&lt;h3 id="contact-summarytemplatedjs-fields">&lt;code>contact-summary.templated.js .fields[]&lt;/code>&lt;/h3>
&lt;!-- If you change this table, update the duplicate descriptions in ### Cards -->
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>type&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>label&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>A translation key which is shown with the field.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>icon&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The name of the icon to display beside this field, as defined through the Configuration &amp;gt; Icons page.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>value&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The value shown for the field.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>filter&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The display filter to apply to the value, eg: &lt;code>{ value: '2005-10-09', filter: 'age' }&lt;/code> will render as &amp;ldquo;11 years&amp;rdquo;. Common filters are: &lt;code>age&lt;/code>, &lt;code>phone&lt;/code>, &lt;code>weeksPregnant&lt;/code>, &lt;code>relativeDate&lt;/code>, &lt;code>relativeDay&lt;/code>, &lt;code>fullDate&lt;/code>, &lt;code>simpleDate&lt;/code>, &lt;code>simpleDateTime&lt;/code>, &lt;code>lineage&lt;/code>, &lt;code>resourceIcon&lt;/code>, &lt;code>translate&lt;/code>. For the complete list of filters, and more details on what each does, check out the code in &lt;a href="https://github.com/medic/cht-core/tree/3.15.x/webapp/src/ts/pipes">&lt;code>webapp/src/ts/pipes&lt;/code> dir&lt;/a>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>width&lt;/code>&lt;/td>
&lt;td>&lt;code>integer&lt;/code>&lt;/td>
&lt;td>The horizontal space for the field. Common values are 12 for full width, 6 for half width, or 3 for quarter width. Default 12.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>translate&lt;/code>&lt;/td>
&lt;td>&lt;code>boolean&lt;/code>&lt;/td>
&lt;td>Whether or not to translate the &lt;code>value&lt;/code>. Defaults to false.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>context&lt;/code>&lt;/td>
&lt;td>&lt;code>object&lt;/code>&lt;/td>
&lt;td>When &lt;code>translate: true&lt;/code> and &lt;code>value&lt;/code> uses &lt;a href="https://angular-translate.github.io/docs/#/guide/06_variable-replacement">translation variables&lt;/a>, this value should provide the translation variables.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesIf&lt;/code>&lt;/td>
&lt;td>&lt;code>function()&lt;/code> or &lt;code>boolean&lt;/code>&lt;/td>
&lt;td>Return true if the field should be shown.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesToType&lt;/code>&lt;/td>
&lt;td>&lt;code>string[]&lt;/code>&lt;/td>
&lt;td>Filters the contacts for which &lt;code>appliesIf&lt;/code> will be evaluated. For example, &lt;code>['person']&lt;/code> or &lt;code>['clinic', 'health_center']&lt;/code>. It defaults to all types if it is not defined.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;!-- TODO: See [How to configure profile pages]() for an example. -->
&lt;h2 id="condition-cards">Condition Cards&lt;/h2>
&lt;p>Each condition card is defined as a card object in the &lt;code>cards&lt;/code> array of &lt;code>contact-summary.templated.js&lt;/code>. The properties for each object determine how and when the card and its fields are shown.&lt;/p>
&lt;h3 id="contact-summarytemplatedjs-cards">&lt;code>contact-summary.templated.js .cards[]&lt;/code>&lt;/h3>
&lt;!-- If you change the field data in this table, update the duplicate descriptions in ### Fields -->
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>type&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>label&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>Label on top of card.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesToType&lt;/code>&lt;/td>
&lt;td>&lt;code>string[]&lt;/code>&lt;/td>
&lt;td>A filter, so &lt;code>appliesIf&lt;/code> is called only if the contact&amp;rsquo;s type matches one or more of the elements. For example, &lt;code>['person']&lt;/code>. Please, note that &lt;code>['report']&lt;/code> is also allowed to create a report card. But, you cannot use it in conjunction with a contact&amp;rsquo;s type. It defaults to all types if it is not defined.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesIf&lt;/code>&lt;/td>
&lt;td>&lt;code>function(report)&lt;/code> or &lt;code>boolean&lt;/code>&lt;/td>
&lt;td>Return true if the field should be shown.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>modifyContext&lt;/code>&lt;/td>
&lt;td>&lt;code>function(context, report)&lt;/code>&lt;/td>
&lt;td>Used to modify or add data which is passed as input to forms filled from the contact page.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields&lt;/code>&lt;/td>
&lt;td>&lt;code>Array[]&lt;/code> of fields&lt;/td>
&lt;td>The content of the card.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].appliesIf&lt;/code>&lt;/td>
&lt;td>&lt;code>boolean&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>Same as Fields.appliesIf above.&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].label&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>Label shown with the field.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].icon&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>The name of the icon to display beside this field, as defined through the Configuration &amp;gt; Icons page.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].value&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>The value shown for the field.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].filter&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>The display filter to apply to the value, eg: &lt;code>{ value: '2005-10-09', filter: 'age' }&lt;/code> will render as &amp;ldquo;11 years&amp;rdquo;. Common filters are: &lt;code>age&lt;/code>, &lt;code>phone&lt;/code>, &lt;code>weeksPregnant&lt;/code>, &lt;code>relativeDate&lt;/code>, &lt;code>relativeDay&lt;/code>, &lt;code>fullDate&lt;/code>, &lt;code>simpleDate&lt;/code>, &lt;code>simpleDateTime&lt;/code>, &lt;code>lineage&lt;/code>, &lt;code>resourceIcon&lt;/code>, &lt;code>translate&lt;/code>. For the complete list of filters, and more details on what each does, check out the code in &lt;a href="https://github.com/medic/cht-core/tree/3.15.x/webapp/src/ts/pipes">&lt;code>webapp/src/ts/pipes&lt;/code> dir&lt;/a>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].width&lt;/code>&lt;/td>
&lt;td>&lt;code>integer&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>The horizontal space for the field. Common values are 12 for full width, 6 for half width, or 3 for quarter width. Default 12.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].translate&lt;/code>&lt;/td>
&lt;td>&lt;code>boolean&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>Whether or not to translate the &lt;code>value&lt;/code>. Defaults to false.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].context&lt;/code>&lt;/td>
&lt;td>&lt;code>object&lt;/code>&lt;/td>
&lt;td>When &lt;code>translate: true&lt;/code> and &lt;code>value&lt;/code> uses &lt;a href="https://angular-translate.github.io/docs/#/guide/06_variable-replacement">translation variables&lt;/a>, this value should provide the translation variables. Only supports properties &lt;code>count&lt;/code> and &lt;code>total&lt;/code> on cards.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;!-- TODO: See [How to configure profile pages]() for an example. -->
&lt;h2 id="care-guides">Care Guides&lt;/h2>
&lt;p>Each care guide accessible from a contact profile is defined as an &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/forms/app/">App Form&lt;/a>. Context information can be provided to forms via the &lt;code>context&lt;/code> object of &lt;code>contact-summary.templated.js&lt;/code>.&lt;/p>
&lt;p>To show an App Form on a contact&amp;rsquo;s profile, the form&amp;rsquo;s &lt;code>expression&lt;/code> field in its properties file must evaluate to true for that contact. The context infomation from the profile is accessible as the variable &lt;code>summary&lt;/code>.&lt;/p>
&lt;p>The context data is also available directly within the app forms&amp;rsquo; XForm calculations, as &lt;code>instance('contact-summary')/context/${variable}&lt;/code>. For instance if &lt;code>context.is_pregnant&lt;/code> is used in the contact summary, it can be accessed in an XForm field&amp;rsquo;s calculation as &lt;code>instance('contact-summary')/context/is_pregnant&lt;/code>. Note that these fields are not available when editing a previously completed form, or when accessing the form from outside of the profile page.&lt;/p>
&lt;!-- TODO: See [How to configure profile pages]() and [How to build app forms]() for examples and more information. -->
&lt;h2 id="code-samples">Code samples&lt;/h2>
&lt;p>The following samples show how fields, cards, and care guide context comes together in the &lt;code>contact-summary.templated.js&lt;/code> file.&lt;/p>
&lt;h3 id="contact-summarytemplatedjs">&lt;code>contact-summary.templated.js&lt;/code>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">use_cases&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">anc&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">isCoveredByUseCaseInLineage&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">lineage&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;anc&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">pnc&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">isCoveredByUseCaseInLineage&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">lineage&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;pnc&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">fields&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;patient_id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">patient_id&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">width&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.age&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">date_of_birth&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">width&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">filter&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;age&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.parent&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">lineage&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">filter&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;lineage&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;!person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">parent&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#000">lineage&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">];&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.parent&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">lineage&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">filter&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;lineage&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">cards&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.profile.pregnancy&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;report&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">isActivePregnancy&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">fields&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.profile.edd&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">fields&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">edd_8601&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">filter&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;relativeDay&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">width&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">12&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.profile.visit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.profile.visits.of&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">translate&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">count&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">getSubsequentVisits&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">length&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">total&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">width&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">6&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.profile.risk.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">isHighRiskPregnancy&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">?&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;high&amp;#39;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;normal&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">translate&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">width&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">isHighRiskPregnancy&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">?&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;risk&amp;#39;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">modifyContext&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ctx&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">ctx&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">pregnant&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// don&amp;#39;t show Create Pregnancy Report button
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="contact-summary-extrasjs">&lt;code>contact-summary-extras.js&lt;/code>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">isActivePregnancy&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">isCoveredByUseCaseInLineage&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">lineage&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">usecase&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">isHighRiskPregnancy&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">getSubsequentVisits&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="build">Build&lt;/h2>
&lt;p>To update the Contact profiles for an app, changes must be compiled into &lt;code>app-settings&lt;/code>, then uploaded.&lt;/p>
&lt;p>&lt;code>cht --local compile-app-settings backup-app-settings upload-app-settings&lt;/code>&lt;/p></description></item><item><title>Apps: extension-libs/</title><link>https://docs.communityhealthtoolkit.org/apps/reference/extension-libs/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/apps/reference/extension-libs/</guid><description>
&lt;p>&lt;em>Introduced in v4.2.0&lt;/em>&lt;/p>
&lt;h2 id="introduction">Introduction&lt;/h2>
&lt;p>Extension libraries are blocks of code that are cached with the CHT web application giving app developers a powerful tool to extend the CHT. This is an advanced feature and requires an app developer with some software development experience.&lt;/p>
&lt;p>An example of a use for this feature is to provide a function to calculate a risk score based on a machine learning model. The function can then be called passing in values from app forms and return the result to be stored with the report.&lt;/p>
&lt;h3 id="library">Library&lt;/h3>
&lt;p>The first step is to create the js file to return the function that will be called by the web application. Create a new file using this template:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#8f5902;font-style:italic">/* parameters */&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">result&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now populate the function as needed. For complex functions, it is recommended to use third party libraries (such as momentjs, lodash, etc) and use a bundler (eg: &lt;a href="https://webpack.js.org/">webpack&lt;/a>) to make it easy to build a single file. It&amp;rsquo;s recommended to use development best practices such as linting, unit tests, and minification to ensure quality and small download size.&lt;/p>
&lt;h4 id="xpath-functions">xpath functions&lt;/h4>
&lt;p>To call the function from within a form the parameters and return value will need to have a very specific structure to work with Enketo xforms.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;t&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#a40000">&amp;lt;type&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;v&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#a40000">&amp;lt;value&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Where the type is one of &amp;ldquo;bool&amp;rdquo;, &amp;ldquo;num&amp;rdquo;, &amp;ldquo;str&amp;rdquo;, &amp;ldquo;date&amp;rdquo;, or &amp;ldquo;arr&amp;rdquo;. For example, to calculate the average of two inputs, you would use:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">getValue&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">obj&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">let&lt;/span> &lt;span style="color:#000">val&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">obj&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">t&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">===&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;arr&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">val&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">obj&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#000">obj&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">length&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#000">obj&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#204a87;font-weight:bold">else&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">val&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">obj&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">!&lt;/span>&lt;span style="color:#000">val&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">parsed&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#204a87">parseInt&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">val&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">textContent&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#204a87">isNaN&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">parsed&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">?&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">parsed&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">first&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">second&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">average&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">getValue&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">first&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span> &lt;span style="color:#000">getValue&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">second&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">/&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">t&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;num&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">v&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">average&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="uploading-to-the-cht">Uploading to the CHT&lt;/h3>
&lt;p>Create a folder within the project configuration to contain the libraries, for example:&lt;/p>
&lt;pre tabindex="0">&lt;code>./extension-libs
average.js
calculate-risk-score.js
&lt;/code>&lt;/pre>&lt;p>Now run the command: &lt;code>cht upload-extension-libs&lt;/code>&lt;/p>
&lt;p>This will create or update a document to CouchDB with an ID of &lt;code>extension-libs&lt;/code> with each of the configured scripts attached. Once this is created the webapp service worker will be updated so the libraries are cached on the phone ready for use offline.&lt;/p>
&lt;h3 id="invoking-the-function">Invoking the function&lt;/h3>
&lt;h4 id="cht-api">CHT API&lt;/h4>
&lt;p>The function will now be available via the CHT API for &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/tasks/">tasks&lt;/a>, &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/targets/">targets&lt;/a>, and &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/contact-page/">contact summary&lt;/a> configurations.&lt;/p>
&lt;h4 id="cht-xpath-functions">CHT xPath functions&lt;/h4>
&lt;p>To execute the function from within an xform use the &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/forms/app/#chtextension-lib">&lt;code>cht:extension-lib&lt;/code> xpath function&lt;/a>.&lt;/p></description></item><item><title>Apps: targets.js</title><link>https://docs.communityhealthtoolkit.org/apps/reference/targets/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/apps/reference/targets/</guid><description>
&lt;p>&lt;img src="counts.png" alt="Percentages">&lt;/p>
&lt;p>&lt;img src="percentages.png" alt="Percentages">&lt;/p>
&lt;p>All targets are defined in the &lt;code>targets.js&lt;/code> file as an array of objects according to the Targets schema defined below. Each object corresponds to a target widget that shows in the app. The order of objects in the array defines the display order of widgets on the Targets tab. The properties of the object are used to define when the target should appear, what it should look like, and the values it will display.&lt;/p>
&lt;p>&lt;em>See Also&lt;/em>: &lt;a href="https://docs.communityhealthtoolkit.org/apps/features/targets/">Targets Overview&lt;/a>&lt;/p>
&lt;h2 id="targetsjs">&lt;code>targets.js&lt;/code>&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>type&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>id&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>An identifier for the target.&lt;/td>
&lt;td>yes, unique&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>icon&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The icon to show alongside the target. Should correspond with a value defined in &lt;code>resources.json&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>translation_key&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>Translation key for the title of this target.&lt;/td>
&lt;td>no, but recommended&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>subtitle_translation_key&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>Translation key for the subtitle of this target. If none supplied the subtitle will be blank.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>percentage_count_translation_key&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>Translation key for the percentage value detail shown at the bottom of the target, eg &amp;ldquo;(5 of 6 deliveries)&amp;rdquo;. The translation context has &lt;code>pass&lt;/code> and &lt;code>total&lt;/code> variables available. If none supplied this defaults to &lt;code>targets.count.default&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>context&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>A string containing a JavaScript expression. This widget will only be shown if the expression evaluates to true. Details of the current user is available through the variable &lt;code>user&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>type&lt;/code>&lt;/td>
&lt;td>&lt;code>'count'&lt;/code> or &lt;code>'percent'&lt;/code>&lt;/td>
&lt;td>The type of the widget.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>goal&lt;/code>&lt;/td>
&lt;td>&lt;code>integer&lt;/code>&lt;/td>
&lt;td>For targets with &lt;code>type: 'percent'&lt;/code>, an integer from 0 to 100. For &lt;code>type: 'count'&lt;/code>, any positive number. If there is no goal, put -1.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesTo&lt;/code>&lt;/td>
&lt;td>&lt;code>'contacts'&lt;/code> or &lt;code>'reports'&lt;/code>&lt;/td>
&lt;td>Do you want to count reports or contacts? This attribute controls the behavior of other attributes herein.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesToType&lt;/code>&lt;/td>
&lt;td>If &lt;code>appliesTo: 'reports'&lt;/code>, an array of form codes. If &lt;code>appliesTo: 'contacts'&lt;/code>, an array of contact types.&lt;/td>
&lt;td>Filters the contacts or reports for which &lt;code>appliesIf&lt;/code> will be evaluated. For example, &lt;code>['person']&lt;/code> or &lt;code>['clinic', 'health_center']&lt;/code>. For example, &lt;code>['pregnancy']&lt;/code> or &lt;code>['P', 'pregnancy']&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesIf&lt;/code>&lt;/td>
&lt;td>&lt;code>function(contact, report)&lt;/code>&lt;/td>
&lt;td>If &lt;code>appliesTo: 'contacts'&lt;/code>, this function is invoked once per contact and &lt;code>report&lt;/code> is undefined. If &lt;code>appliesTo: 'reports'&lt;/code>, this function is invoked once per report. Return true to count this document. For &lt;code>type: 'percent'&lt;/code>, this controls the denominator.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>passesIf&lt;/code>&lt;/td>
&lt;td>&lt;code>function(contact, report)&lt;/code>&lt;/td>
&lt;td>For &lt;code>type: 'percent'&lt;/code>, return true to increment the numerator.&lt;/td>
&lt;td>yes, if &lt;code>type: 'percent'&lt;/code>. Forbidden when &lt;code>groupBy&lt;/code> is defined.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>date&lt;/code>&lt;/td>
&lt;td>&lt;code>'reported'&lt;/code> or &lt;code>'now'&lt;/code> or &lt;code>function(contact, report)&lt;/code>&lt;/td>
&lt;td>When &lt;code>'reported'&lt;/code>, the target will count documents with a &lt;code>reported_date&lt;/code> within the current month. When &lt;code>'now'&lt;/code>, target includes all documents. A function can be used to indicate when the document should be counted. When this property is undefined or the value is null the default is &amp;rsquo;now'.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>idType&lt;/code>&lt;/td>
&lt;td>&lt;code>'report'&lt;/code> or &lt;code>'contact'&lt;/code> or &lt;code>function(contact, report)&lt;/code>&lt;/td>
&lt;td>The target&amp;rsquo;s values are incremented once per unique ID. To count individual contacts that have one or more reports that apply, use &lt;code>'contact'&lt;/code>. Use &lt;code>'report'&lt;/code> to count all reports, even if there are multiple that apply for a single contact. If you need more than a single count for each applying contact or report then a custom function can be used returning an array with unique IDs â€” one element for each count.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>groupBy&lt;/code>&lt;/td>
&lt;td>&lt;code>function(contact, report)&lt;/code> returning string&lt;/td>
&lt;td>Allows for target ids to be aggregated and scored in groups. Not required for most targets. Use with passesIfGroupCount.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>passesIfGroupCount&lt;/code>&lt;/td>
&lt;td>&lt;code>object&lt;/code>&lt;/td>
&lt;td>The criteria to determine if the target ids within a group should be counted as passing&lt;/td>
&lt;td>yes when &lt;code>groupBy&lt;/code> is defined&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>passesIfGroupCount.gte&lt;/code>&lt;/td>
&lt;td>&lt;code>number&lt;/code>&lt;/td>
&lt;td>The group should be counted as passing if the number of target ids in the group is greater-than-or-equal-to this value&lt;/td>
&lt;td>yes when &lt;code>groupBy&lt;/code> is defined&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dhis&lt;/code>&lt;/td>
&lt;td>&lt;code>object&lt;/code> or &lt;code>object[]&lt;/code>&lt;/td>
&lt;td>Settings relevant to the &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/integrations/dhis2-aggregate/#configuration">DHIS2 Integration&lt;/a>&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dhis[n].dataElement&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The hash id of a data element configured in the DHIS2 data set you&amp;rsquo;re integrating with&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dhis[n].dataSet&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The hash id of the data set that contains the data element you&amp;rsquo;re integrating with. If this is left undefined, the data element will appear in all data sets.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>visible&lt;/code>&lt;/td>
&lt;td>&lt;code>boolean&lt;/code>&lt;/td>
&lt;td>Whether the target is visible in the targets page. &lt;strong>Default: true&lt;/strong>&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>aggregate&lt;/code>&lt;/td>
&lt;td>&lt;code>boolean&lt;/code>&lt;/td>
&lt;td>As of 3.9, defines whether the target will be displayed on the TargetAggregates page&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="utils">Utils&lt;/h2>
&lt;p>Utility functions in the Core Framework can make common tasks much easier. These are available only for Tasks and Targets. To use the function call &lt;code>Utils.&amp;lt;function-name&amp;gt;(&amp;lt;params&amp;gt;)&lt;/code>, for example &lt;code>Utils.addDate(report.reported_date, 10)&lt;/code>.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>isTimely(date, event)&lt;/code>&lt;/td>
&lt;td>Returns true if the given date is after the start date and before the end date of the event.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>addDate(date, days)&lt;/code>&lt;/td>
&lt;td>Returns a new Date set to midnight the given number of days after the given date. If no date is given the date defaults to today.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getLmpDate(doc)&lt;/code>&lt;/td>
&lt;td>Attempts to work out the LMP from the given doc. If no LMP is given it defaults to four weeks before the reported_date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getSchedule(name)&lt;/code>&lt;/td>
&lt;td>Returns the task schedule with the given name from the configuration.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getMostRecentTimestamp(reports, form)&lt;/code>&lt;/td>
&lt;td>Returns the reported_date of the most recent of the reports with form ID matching the given form.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getMostRecentReport(reports, form)&lt;/code>&lt;/td>
&lt;td>Like &lt;code>getMostRecentTimestamp&lt;/code> but returns the report, not just the reported_date. From CHT v3.14.0, it also accepts an array of forms.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isFormSubmittedInWindow(reports, form, start, end)&lt;/code>&lt;/td>
&lt;td>Returns true if any of the given reports are for the given form and were reported after start and before end.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isFirstReportNewer(firstReport, secondReport)&lt;/code>&lt;/td>
&lt;td>Returns true if the firstReport was reported before the secondReport.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isDateValid(date)&lt;/code>&lt;/td>
&lt;td>Returns true if the given date is a validate JavaScript Date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>now()&lt;/code>&lt;/td>
&lt;td>Returns the current Date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getField(report, fieldPath)&lt;/code>&lt;/td>
&lt;td>Returns the value of the specified fieldPath. The fieldPath is a period separated json path.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>MS_IN_DAY&lt;/code>&lt;/td>
&lt;td>A constant for the number of milliseconds in a day.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Please open &lt;a href="https://github.com/medic/cht-core/issues/new">an issue&lt;/a> if you&amp;rsquo;d like other functions included.&lt;/p>
&lt;h2 id="cht-api">CHT API&lt;/h2>
&lt;p>&lt;em>Introduced in v3.12.0&lt;/em>&lt;/p>
&lt;p>Provides CHT-Core Framework&amp;rsquo;s functions to contact summary, targets and tasks. The API is available in the &lt;code>cht&lt;/code> reserved variable under the &lt;code>v1&lt;/code> version.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Function&lt;/th>
&lt;th>Arguments&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>hasPermissions(permissions, userRoles, chtPermissionsSettings)&lt;/td>
&lt;td>&lt;code>permissions&lt;/code>: String or array of permission name(s).&lt;br>&lt;code>userRoles&lt;/code>: (Optional) Array of user roles. Default to the current logged in user.&lt;br>&lt;code>chtPermissionsSettings&lt;/code>: (Optional) Object of configured permissions in CHT-Core&amp;rsquo;s settings. Default to the current instance&amp;rsquo;s configured permissions.&lt;/td>
&lt;td>Returns true if the user has the permission(s), otherwise returns false.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>hasAnyPermission(permissionsGroups, userRoles, chtPermissionsSettings)&lt;/td>
&lt;td>&lt;code>permissionsGroups&lt;/code>: Array of groups of permission name(s).&lt;br>&lt;code>userRoles&lt;/code>: (Optional) Array of user roles. Default to the current logged in user.&lt;br>&lt;code>chtPermissionsSettings&lt;/code>: (Optional) Object of configured permissions in CHT-Core&amp;rsquo;s settings. Default to the current instance&amp;rsquo;s configured permissions.&lt;/td>
&lt;td>Returns true if the user has all the permissions of any of the provided groups, otherwise returns false.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>getExtensionLib(name)&lt;/td>
&lt;td>&lt;code>name&lt;/code>: String of script name&lt;/td>
&lt;td>Returns an executable function identified by the given name configured as &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/extension-libs/">extension-libs&lt;/a>.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="cht-apis-code-samples">CHT API&amp;rsquo;s code samples&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">canEdit&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hasPermissions&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_edit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">canManagePlaces&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hasPermissions&lt;/span>&lt;span style="color:#000;font-weight:bold">([&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_create_places&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;can_update_places&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">hasAnyGroup&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hasAnyPermission&lt;/span>&lt;span style="color:#000;font-weight:bold">([&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_view_messages&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;can_view_message_action&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_view_reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;can_verify_reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">averageFn&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">getExtensionLib&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;average.js&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;h2 id="code-samples">Code Samples&lt;/h2>
&lt;p>This sample &lt;code>targets.js&lt;/code> generates three widgets, and uses functions written in the &lt;code>targets-extras.js&lt;/code> file.&lt;/p>
&lt;h3 id="targetsjs-1">&lt;code>targets.js&lt;/code>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">isHealthyDelivery&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">countReportsSubmittedInWindow&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">require&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;./targets-extras&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// BIRTHS THIS MONTH
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;births-this-month&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;count&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;infant&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">goal&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">translation_key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;targets.births.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">subtitle_translation_key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;targets.this_month.subtitle&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">isHealthyDelivery&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;reported&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// % DELIVERIES ALL TIME WITH 1+ VISITS
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;delivery-with-min-1-visit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;percent&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;nurse&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">goal&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">100&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">translation_key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;targets.delivery_1_visit.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">subtitle_translation_key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;targets.all_time.subtitle&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">idType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;report&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">isHealthyDelivery&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">passesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">var&lt;/span> &lt;span style="color:#000">visits&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">countReportsSubmittedInWindow&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">antenatalForms&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span> &lt;span style="color:#000">MAX_DAYS_IN_PREGNANCY&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">MS_IN_DAY&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">visits&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;now&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;2-home-visits-per-family&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;home-visit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;percent&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">goal&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">100&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">translation_key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">`target.2-home-visits-per-family`&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;user.role === &amp;#34;chw&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;reported&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contacts&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">idType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">contact&lt;/span> &lt;span style="color:#000;font-weight:bold">=&amp;gt;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Determines the target ids which will be in the group.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// eg. &amp;#34;family1~2000-02-15&amp;#34; and &amp;#34;family1~2000-02-16&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">householdVisitDates&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#204a87;font-weight:bold">new&lt;/span> &lt;span style="color:#000">Set&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">map&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span> &lt;span style="color:#000;font-weight:bold">=&amp;gt;&lt;/span> &lt;span style="color:#000">toDateString&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span>&lt;span style="color:#000;font-weight:bold">)));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">familyId&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#204a87">Array&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">from&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">householdVisitDates&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">map&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">date&lt;/span> &lt;span style="color:#000;font-weight:bold">=&amp;gt;&lt;/span> &lt;span style="color:#4e9a06">`&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">familyId&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">~&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">date&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">`&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">groupBy&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">contact&lt;/span> &lt;span style="color:#000;font-weight:bold">=&amp;gt;&lt;/span> &lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">passesIfGroupCount&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">gte&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="targets-extrasjs">&lt;code>targets-extras.js&lt;/code>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">isHealthyDelivery&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">form&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">===&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;D&amp;#39;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">form&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">===&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;delivery&amp;#39;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">fields&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">pregnancy_outcome&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">===&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;healthy&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">countReportsSubmittedInWindow&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">form&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">var&lt;/span> &lt;span style="color:#000">reportsFound&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">forEach&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">form&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">indexOf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">form&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;=&lt;/span> &lt;span style="color:#000">start&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;=&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">reportsFound&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">++&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">reportsFound&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="build">Build&lt;/h2>
&lt;p>To build your targets into your app, you must compile them into app-settings, then upload them to your instance.&lt;/p>
&lt;p>&lt;code>cht --local compile-app-settings backup-app-settings upload-app-settings&lt;/code>&lt;/p></description></item><item><title>Apps: tasks.js</title><link>https://docs.communityhealthtoolkit.org/apps/reference/tasks/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/apps/reference/tasks/</guid><description>
&lt;p>&lt;img src="task-with-description.png" alt="task">&lt;/p>
&lt;p>Task generation is configured in the &lt;code>tasks.js&lt;/code> file. This file is a JavaScript module which defines an array of objects conforming to the Task schema detailed below. When defining tasks, all the data about contacts on the device (both people and places) along with all their reports are available. Tasks are available only for users of type &amp;ldquo;restricted to their place&amp;rdquo;. Tasks can pull in fields from reports and pass data as inputs to the form that opens when the task is selected, enabling richer user experiences.&lt;/p>
&lt;p>Task generation occurs on the client periodically and creates documents which track the status of the task over time. To avoid performance issues the developer needs to be conscious about generating too many tasks. For example, to remind a user to do something every day, you could generate one task for each day and fill up the user&amp;rsquo;s device. The recommended approach is to only generate the tasks for the near future, or only once the previous task is resolved. To limit the impact of this misconfiguration, the CHT will only generate tasks that can be completed between 60 days in the past, and (as of 4.0.0) 180 days in the future.&lt;/p>
&lt;p>&lt;em>See Also&lt;/em>: &lt;a href="https://docs.communityhealthtoolkit.org/apps/features/tasks/">Tasks Overview&lt;/a>&lt;/p>
&lt;h2 id="tasksjs">&lt;code>tasks.js&lt;/code>&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>type&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>name&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>A unique identifier for the task. Used for querying task completeness.&lt;/td>
&lt;td>yes, unique&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>icon&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The icon to show alongside the task. Should correspond with a value defined in &lt;code>resources.json&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>title&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>The title of the task (labeled above).&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesTo&lt;/code>&lt;/td>
&lt;td>&lt;code>'contacts'&lt;/code> or &lt;code>'reports'&lt;/code>&lt;/td>
&lt;td>Do you want to emit one task per report, or one task per contact? See &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/tasks/task-schema-parameters/">Understanding the Parameters in the Task Schema&lt;/a>.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesIf&lt;/code>&lt;/td>
&lt;td>&lt;code>function(contact, report)&lt;/code>&lt;/td>
&lt;td>If &lt;code>appliesTo: 'contacts'&lt;/code>, this function is invoked once per contact and &lt;code>report&lt;/code> is undefined. If &lt;code>appliesTo: 'reports'&lt;/code>, this function is invoked once per report. Return true if the task should appear for the given documents. See &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/tasks/task-schema-parameters/">Understanding the Parameters in the Task Schema&lt;/a>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesToType&lt;/code>&lt;/td>
&lt;td>&lt;code>string[]&lt;/code>&lt;/td>
&lt;td>Filters the contacts or reports for which &lt;code>appliesIf&lt;/code> will be evaluated. If &lt;code>appliesTo: 'reports'&lt;/code>, this is an array of form codes. If &lt;code>appliesTo: 'contacts'&lt;/code>, this is an array of contact types. For example, &lt;code>['person']&lt;/code> or &lt;code>['clinic', 'health_center']&lt;/code>. For example, &lt;code>['pregnancy']&lt;/code> or &lt;code>['P', 'pregnancy']&lt;/code>. See &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/tasks/task-schema-parameters/">Understanding the Parameters in the Task Schema&lt;/a>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>contactLabel&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code> or &lt;code>function(contact, report)&lt;/code>&lt;/td>
&lt;td>Controls the label describing the subject of the task. Defaults to the name of the contact (&lt;code>contact.contact.name&lt;/code>).&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>resolvedIf&lt;/code>&lt;/td>
&lt;td>&lt;code>function(contact, report, event, dueDate)&lt;/code>&lt;/td>
&lt;td>Return true to mark the task as &amp;ldquo;resolved&amp;rdquo;. A resolved task uses memory on the phone, but is not displayed.&lt;/td>
&lt;td>no, if any &lt;code>actions[n].type&lt;/code> is &lt;code>'report'&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events&lt;/code>&lt;/td>
&lt;td>&lt;code>object[]&lt;/code>&lt;/td>
&lt;td>An event is used to specify the timing of the task.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events[n].id&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>A descriptive identifier. Used for querying task completeness.&lt;/td>
&lt;td>yes if task has multiple events, unique&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events[n].days&lt;/code>&lt;/td>
&lt;td>&lt;code>integer&lt;/code>&lt;/td>
&lt;td>Number of days after the doc&amp;rsquo;s &lt;code>reported_date&lt;/code> that the event is due&lt;/td>
&lt;td>yes, if &lt;code>dueDate&lt;/code> is not set&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events[n].dueDate&lt;/code>&lt;/td>
&lt;td>&lt;code>function(event, contact, report)&lt;/code>&lt;/td>
&lt;td>Returns a &lt;code>Date&lt;/code> object for the day when this event is due.&lt;/td>
&lt;td>yes, if &lt;code>days&lt;/code> is not set&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events[n].start&lt;/code>&lt;/td>
&lt;td>&lt;code>integer&lt;/code>&lt;/td>
&lt;td>Number of days to show the task before it is due.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events[n].end&lt;/code>&lt;/td>
&lt;td>&lt;code>integer&lt;/code>&lt;/td>
&lt;td>Number of days to show the task after it is due.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>actions&lt;/code>&lt;/td>
&lt;td>&lt;code>object[]&lt;/code>&lt;/td>
&lt;td>The actions (forms) that a user can access after clicking on a task. If you put multiple forms here, the user will see a task summary screen where they can select which action they would like to complete.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>actions[n].type&lt;/code>&lt;/td>
&lt;td>&lt;code>'report'&lt;/code> or &lt;code>'contact'&lt;/code>&lt;/td>
&lt;td>When &lt;code>'report'&lt;/code>, the action opens the given form. When &lt;code>'contact'&lt;/code>, the action redirects to a contact&amp;rsquo;s profile page. Defaults to &amp;lsquo;report&amp;rsquo;.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>actions[n].form&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The code of the form that should open when you select the action.&lt;/td>
&lt;td>yes, if &lt;code>actions[n].type&lt;/code> is &lt;code>'report'&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>actions[n].label&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>The label that should appear on the task summary screen if multiple actions are present.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>actions[n].modifyContent&lt;/code>&lt;/td>
&lt;td>&lt;code>function (content, contact, report, event)&lt;/code>&lt;/td>
&lt;td>Set the values on the content object to control the data which will be passed as &lt;code>inputs&lt;/code> to the form which opens when the action is selected. See &lt;a href="https://docs.communityhealthtoolkit.org/apps/guides/tasks/pass-data-to-form/">Passing data from a task into the app form&lt;/a>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>priority&lt;/code>&lt;/td>
&lt;td>&lt;code>object&lt;/code> or &lt;code>function(contact, report)&lt;/code> returning object of same schema&lt;/td>
&lt;td>Controls the &amp;ldquo;high risk&amp;rdquo; line seen above.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>priority.level&lt;/code>&lt;/td>
&lt;td>&lt;code>high&lt;/code> or &lt;code>medium&lt;/code>&lt;/td>
&lt;td>Tasks that are &lt;code>high&lt;/code> will display a high risk icon with the task. Default: &lt;code>medium&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>priority.label&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>Text shown with the task associated to the risk level.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="utils">Utils&lt;/h2>
&lt;p>Utility functions in the Core Framework can make common tasks much easier. These are available only for Tasks and Targets. To use the function call &lt;code>Utils.&amp;lt;function-name&amp;gt;(&amp;lt;params&amp;gt;)&lt;/code>, for example &lt;code>Utils.addDate(report.reported_date, 10)&lt;/code>.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>isTimely(date, event)&lt;/code>&lt;/td>
&lt;td>Returns true if the given date is after the start date and before the end date of the event.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>addDate(date, days)&lt;/code>&lt;/td>
&lt;td>Returns a new Date set to midnight the given number of days after the given date. If no date is given the date defaults to today.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getLmpDate(doc)&lt;/code>&lt;/td>
&lt;td>Attempts to work out the LMP from the given doc. If no LMP is given it defaults to four weeks before the reported_date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getSchedule(name)&lt;/code>&lt;/td>
&lt;td>Returns the task schedule with the given name from the configuration.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getMostRecentTimestamp(reports, form)&lt;/code>&lt;/td>
&lt;td>Returns the reported_date of the most recent of the reports with form ID matching the given form.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getMostRecentReport(reports, form)&lt;/code>&lt;/td>
&lt;td>Like &lt;code>getMostRecentTimestamp&lt;/code> but returns the report, not just the reported_date. From CHT v3.14.0, it also accepts an array of forms.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isFormSubmittedInWindow(reports, form, start, end)&lt;/code>&lt;/td>
&lt;td>Returns true if any of the given reports are for the given form and were reported after start and before end.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isFirstReportNewer(firstReport, secondReport)&lt;/code>&lt;/td>
&lt;td>Returns true if the firstReport was reported before the secondReport.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isDateValid(date)&lt;/code>&lt;/td>
&lt;td>Returns true if the given date is a validate JavaScript Date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>now()&lt;/code>&lt;/td>
&lt;td>Returns the current Date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getField(report, fieldPath)&lt;/code>&lt;/td>
&lt;td>Returns the value of the specified fieldPath. The fieldPath is a period separated json path.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>MS_IN_DAY&lt;/code>&lt;/td>
&lt;td>A constant for the number of milliseconds in a day.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Please open &lt;a href="https://github.com/medic/cht-core/issues/new">an issue&lt;/a> if you&amp;rsquo;d like other functions included.&lt;/p>
&lt;h2 id="cht-api">CHT API&lt;/h2>
&lt;p>&lt;em>Introduced in v3.12.0&lt;/em>&lt;/p>
&lt;p>Provides CHT-Core Framework&amp;rsquo;s functions to contact summary, targets and tasks. The API is available in the &lt;code>cht&lt;/code> reserved variable under the &lt;code>v1&lt;/code> version.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Function&lt;/th>
&lt;th>Arguments&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>hasPermissions(permissions, userRoles, chtPermissionsSettings)&lt;/td>
&lt;td>&lt;code>permissions&lt;/code>: String or array of permission name(s).&lt;br>&lt;code>userRoles&lt;/code>: (Optional) Array of user roles. Default to the current logged in user.&lt;br>&lt;code>chtPermissionsSettings&lt;/code>: (Optional) Object of configured permissions in CHT-Core&amp;rsquo;s settings. Default to the current instance&amp;rsquo;s configured permissions.&lt;/td>
&lt;td>Returns true if the user has the permission(s), otherwise returns false.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>hasAnyPermission(permissionsGroups, userRoles, chtPermissionsSettings)&lt;/td>
&lt;td>&lt;code>permissionsGroups&lt;/code>: Array of groups of permission name(s).&lt;br>&lt;code>userRoles&lt;/code>: (Optional) Array of user roles. Default to the current logged in user.&lt;br>&lt;code>chtPermissionsSettings&lt;/code>: (Optional) Object of configured permissions in CHT-Core&amp;rsquo;s settings. Default to the current instance&amp;rsquo;s configured permissions.&lt;/td>
&lt;td>Returns true if the user has all the permissions of any of the provided groups, otherwise returns false.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>getExtensionLib(name)&lt;/td>
&lt;td>&lt;code>name&lt;/code>: String of script name&lt;/td>
&lt;td>Returns an executable function identified by the given name configured as &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/extension-libs/">extension-libs&lt;/a>.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="cht-apis-code-samples">CHT API&amp;rsquo;s code samples&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">canEdit&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hasPermissions&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_edit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">canManagePlaces&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hasPermissions&lt;/span>&lt;span style="color:#000;font-weight:bold">([&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_create_places&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;can_update_places&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">hasAnyGroup&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hasAnyPermission&lt;/span>&lt;span style="color:#000;font-weight:bold">([&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_view_messages&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;can_view_message_action&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_view_reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;can_verify_reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">averageFn&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">getExtensionLib&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;average.js&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;h2 id="code-samples">Code samples&lt;/h2>
&lt;h3 id="basic-task">Basic task&lt;/h3>
&lt;p>This sample &lt;code>tasks.js&lt;/code> generates two postnatal-visit tasks for each delivery form. The tasks are due 7 and 14 days after the delivery report was submitted. Each task is displayed for 2 days before the due date and 2 days after the due date.&lt;/p>
&lt;h4 id="tasksjs-1">tasks.js&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;mother-child&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">title&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;task.postnatal_followup&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;delivery&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">actions&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">form&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;postnatal_visit&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">events&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;postnatal-followup-1&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">7&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;postnatal-followup-2&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">resolvedIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">isFormSubmittedInWindow&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#39;delivery&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">start&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">end&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">];&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="tasks-with-functions">Tasks with functions&lt;/h3>
&lt;p>These samples show more complex tasks which use functions kept in a separate &lt;code>nools-extras.js&lt;/code> file&lt;/p>
&lt;h4 id="tasksjs-2">&lt;code>tasks.js&lt;/code>&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">extras&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">require&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;./nools-extras&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">isFormFromArraySubmittedInWindow&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// PNC TASK 1: If a home delivery, needs clinic tasks
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;mother-child&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">title&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;task.postnatal_followup.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;D&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;delivery&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">isCoveredByUseCase&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;pnc&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">fields&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">fields&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">delivery_code&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">fields&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">delivery_code&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">toUpperCase&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">!==&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;F&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">actions&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">form&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;postnatal_visit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Pass content that will be used within the task form
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000">modifyContent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">content&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">content&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">delivery_place&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;home&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">content&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">event_id&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">id&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">events&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;postnatal-visit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">priority&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">level&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;high&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">locale&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;en&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">content&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;Home Birth&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">resolvedIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Resolved if there a visit report received in time window or a newer pregnancy
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">getNewestDeliveryTimestamp&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">getNewestPregnancyTimestamp&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">isFormFromArraySubmittedInWindow&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">postnatalForms&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">start&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Option 1a: Place-based task: Family survey when place is created, then every 6 months
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;family&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">title&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;task.family_survey.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contacts&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;clinic&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">actions&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">form&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;family_survey&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">events&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;family-survey&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">resolvedIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Resolved if there a family survey received in time window
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">isFormFromArraySubmittedInWindow&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;family_survey&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">start&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Regular check for infants
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;infant&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">title&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;task.infant.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contacts&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">actions&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">form&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;infant_assessment&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">events&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;infant_asssessment-q1&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">91&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">7&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;infant_asssessment-q2&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">182&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">7&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;infant_asssessment-q3&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">273&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">7&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;infant_asssessment-q4&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">365&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">7&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Option 2: Place-based task: Family survey every 6 months
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;family&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">title&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;task.family_survey.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contacts&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;clinic&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">needsFamilySurvey&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// function returns true if family doesn&amp;#39;t have survey in previous 6 months
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000">actions&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">form&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;family_survey&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">events&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;family-survey&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">getNextFamilySurveyDate&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// function gets expected date of next family survey
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">resolvedIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// Resolved if there a family survey received in time window
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">isFormFromArraySubmittedInWindow&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;family_survey&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">start&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="nools-extrasjs">&lt;code>nools-extras.js&lt;/code>&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">isCoveredByUseCase&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">usecase&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">getNewestDeliveryTimestamp&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">getNewestPregnancyTimestamp&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">isFormFromArraySubmittedInWindow&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">formsArray&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">startTime&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">endTime&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="default-resolvedif-method">Default resolvedIf method&lt;/h3>
&lt;p>If the &lt;code>resolvedIf&lt;/code> is undefined in an action of type &lt;code>report&lt;/code>, then &lt;code>resolvedIf&lt;/code> is going to default to &lt;code>defaultResolvedIf&lt;/code> method.&lt;/p>
&lt;p>The &lt;code>defaultResolvedIf&lt;/code> method returns &lt;code>true&lt;/code> if it finds any report assigned to the contact that matches the &lt;code>form&lt;/code> defined in the action of type &lt;code>report&lt;/code>. Only the reports submitted during a specific time period are considered:&lt;/p>
&lt;ul>
&lt;li>For a contact-based task, the period is the same as the task window period i.e. when the task is visible.&lt;/li>
&lt;li>For a report based task, the period is determined between &lt;code>start&lt;/code> and &lt;code>end&lt;/code> as:
&lt;ul>
&lt;li>&lt;code>start&lt;/code>: the latest date between start of the task window and one millisecond after the report&amp;rsquo;s reported date&lt;/li>
&lt;li>&lt;code>end&lt;/code>: end of the task window&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>You can also use &lt;code>this.definition.defaultResolvedIf&lt;/code> inside the &lt;code>resolvedIf&lt;/code> definition and optionally add more conditions:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">resolvedIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#204a87;font-weight:bold">this&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">definition&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">defaultResolvedIf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#000">otherConditions&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="build">Build&lt;/h2>
&lt;p>To build your tasks into your app, you must compile them into app-settings, then upload them to your instance.&lt;/p>
&lt;p>&lt;code>cht --local compile-app-settings backup-app-settings upload-app-settings&lt;/code>&lt;/p></description></item><item><title>Apps: CHT API</title><link>https://docs.communityhealthtoolkit.org/apps/reference/_partial_cht_api/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/apps/reference/_partial_cht_api/</guid><description>
&lt;p>&lt;em>Introduced in v3.12.0&lt;/em>&lt;/p>
&lt;p>Provides CHT-Core Framework&amp;rsquo;s functions to contact summary, targets and tasks. The API is available in the &lt;code>cht&lt;/code> reserved variable under the &lt;code>v1&lt;/code> version.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Function&lt;/th>
&lt;th>Arguments&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>hasPermissions(permissions, userRoles, chtPermissionsSettings)&lt;/td>
&lt;td>&lt;code>permissions&lt;/code>: String or array of permission name(s).&lt;br>&lt;code>userRoles&lt;/code>: (Optional) Array of user roles. Default to the current logged in user.&lt;br>&lt;code>chtPermissionsSettings&lt;/code>: (Optional) Object of configured permissions in CHT-Core&amp;rsquo;s settings. Default to the current instance&amp;rsquo;s configured permissions.&lt;/td>
&lt;td>Returns true if the user has the permission(s), otherwise returns false.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>hasAnyPermission(permissionsGroups, userRoles, chtPermissionsSettings)&lt;/td>
&lt;td>&lt;code>permissionsGroups&lt;/code>: Array of groups of permission name(s).&lt;br>&lt;code>userRoles&lt;/code>: (Optional) Array of user roles. Default to the current logged in user.&lt;br>&lt;code>chtPermissionsSettings&lt;/code>: (Optional) Object of configured permissions in CHT-Core&amp;rsquo;s settings. Default to the current instance&amp;rsquo;s configured permissions.&lt;/td>
&lt;td>Returns true if the user has all the permissions of any of the provided groups, otherwise returns false.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>getExtensionLib(name)&lt;/td>
&lt;td>&lt;code>name&lt;/code>: String of script name&lt;/td>
&lt;td>Returns an executable function identified by the given name configured as &lt;a href="https://docs.communityhealthtoolkit.org/apps/reference/extension-libs/">extension-libs&lt;/a>.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="cht-apis-code-samples">CHT API&amp;rsquo;s code samples&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">canEdit&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hasPermissions&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_edit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">canManagePlaces&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hasPermissions&lt;/span>&lt;span style="color:#000;font-weight:bold">([&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_create_places&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;can_update_places&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">hasAnyGroup&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">hasAnyPermission&lt;/span>&lt;span style="color:#000;font-weight:bold">([&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_view_messages&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;can_view_message_action&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;can_view_reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;can_verify_reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">averageFn&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">cht&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">getExtensionLib&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;average.js&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Apps: Utils Functions</title><link>https://docs.communityhealthtoolkit.org/apps/reference/_partial_utils/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/apps/reference/_partial_utils/</guid><description>
&lt;p>Utility functions in the Core Framework can make common tasks much easier. These are available only for Tasks and Targets. To use the function call &lt;code>Utils.&amp;lt;function-name&amp;gt;(&amp;lt;params&amp;gt;)&lt;/code>, for example &lt;code>Utils.addDate(report.reported_date, 10)&lt;/code>.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>isTimely(date, event)&lt;/code>&lt;/td>
&lt;td>Returns true if the given date is after the start date and before the end date of the event.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>addDate(date, days)&lt;/code>&lt;/td>
&lt;td>Returns a new Date set to midnight the given number of days after the given date. If no date is given the date defaults to today.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getLmpDate(doc)&lt;/code>&lt;/td>
&lt;td>Attempts to work out the LMP from the given doc. If no LMP is given it defaults to four weeks before the reported_date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getSchedule(name)&lt;/code>&lt;/td>
&lt;td>Returns the task schedule with the given name from the configuration.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getMostRecentTimestamp(reports, form)&lt;/code>&lt;/td>
&lt;td>Returns the reported_date of the most recent of the reports with form ID matching the given form.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getMostRecentReport(reports, form)&lt;/code>&lt;/td>
&lt;td>Like &lt;code>getMostRecentTimestamp&lt;/code> but returns the report, not just the reported_date. From CHT v3.14.0, it also accepts an array of forms.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isFormSubmittedInWindow(reports, form, start, end)&lt;/code>&lt;/td>
&lt;td>Returns true if any of the given reports are for the given form and were reported after start and before end.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isFirstReportNewer(firstReport, secondReport)&lt;/code>&lt;/td>
&lt;td>Returns true if the firstReport was reported before the secondReport.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isDateValid(date)&lt;/code>&lt;/td>
&lt;td>Returns true if the given date is a validate JavaScript Date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>now()&lt;/code>&lt;/td>
&lt;td>Returns the current Date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getField(report, fieldPath)&lt;/code>&lt;/td>
&lt;td>Returns the value of the specified fieldPath. The fieldPath is a period separated json path.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>MS_IN_DAY&lt;/code>&lt;/td>
&lt;td>A constant for the number of milliseconds in a day.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Please open &lt;a href="https://github.com/medic/cht-core/issues/new">an issue&lt;/a> if you&amp;rsquo;d like other functions included.&lt;/p></description></item></channel></rss>