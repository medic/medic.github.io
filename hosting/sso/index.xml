<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Community Health Toolkit â€“ Single Sign-On</title><link>https://docs.communityhealthtoolkit.org/hosting/sso/</link><description>Recent content in Single Sign-On on Community Health Toolkit</description><generator>Hugo -- gohugo.io</generator><language>en</language><atom:link href="https://docs.communityhealthtoolkit.org/hosting/sso/index.xml" rel="self" type="application/rss+xml"/><item><title>Using CHT with Keycloak</title><link>https://docs.communityhealthtoolkit.org/hosting/sso/keycloak/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/hosting/sso/keycloak/</guid><description>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-orange-100 hx-bg-orange-50 hx-text-orange-800 dark:hx-border-orange-400/30 dark:hx-bg-orange-400/20 dark:hx-text-orange-300"&gt;
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2"&gt;&lt;/div&gt;
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7"&gt;
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0"&gt;Introduced in 4.20.0. This feature is only compatible with cht-android version &lt;code&gt;v1.5.2&lt;/code&gt; or greater.&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Introduction&lt;span class="hx-absolute -hx-mt-20" id="introduction"&gt;&lt;/span&gt;
&lt;a href="#introduction" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;These steps document how to configure Keycloak as the Single Sign On (SSO) identity provider for the CHT. As well, it walks through provisioning a single user for SSO.&lt;/p&gt;
&lt;h2&gt;Prerequisites&lt;span class="hx-absolute -hx-mt-20" id="prerequisites"&gt;&lt;/span&gt;
&lt;a href="#prerequisites" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class="hextra-scrollbar hx-overflow-x-auto hx-overflow-y-hidden hx-overscroll-x-contain"&gt;
&lt;div class="hx-mt-4 hx-flex hx-w-max hx-min-w-full hx-border-b hx-border-gray-200 hx-pb-px dark:hx-border-neutral-800"&gt;&lt;button
class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
role="tab"
type="button"
aria-controls="tabs-panel-0" aria-selected="true" tabindex="0" data-state="selected"&gt;Production&lt;/button&gt;&lt;button
class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
role="tab"
type="button"
aria-controls="tabs-panel-1"&gt;Development&lt;/button&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;div
class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
id="tabs-panel-0"
role="tabpanel" tabindex="0" data-state="selected" &gt;&lt;ul&gt;
&lt;li&gt;Keycloak server - ensure you are running a &lt;a href="https://github.com/keycloak/keycloak/security/policy#supported-versions" target="_blank" rel="noopener"&gt;supported version&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;CHT server - ensure you are running version &lt;code&gt;4.20.0&lt;/code&gt; or later&lt;/li&gt;
&lt;li&gt;DNS Entries for CHT and Keycloak&lt;/li&gt;
&lt;li&gt;TLS enabled on CHT and Keycloak&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div
class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
id="tabs-panel-1"
role="tabpanel"&gt;&lt;p&gt;Start with creating a Keycloak compose file and two cert files in a new &lt;code&gt;~/cht-keycloak&lt;/code&gt; directory by running this code:&lt;/p&gt;
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code"&gt;
&lt;div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="l"&gt;mkdir -p $HOME/cht-keycloak/data&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="l"&gt;curl -so $HOME/cht-keycloak/server.crt https://local-ip.medicmobile.org/fullchain&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="l"&gt;curl -so $HOME/cht-keycloak/server.key https://local-ip.medicmobile.org/key&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="l"&gt;cat &amp;gt; $HOME/cht-keycloak/compose.yaml &amp;lt;&amp;lt; EOF&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;services&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;keycloak&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;quay.io/keycloak/keycloak&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;environment&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;KEYCLOAK_ADMIN&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;medic&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;KEYCLOAK_ADMIN_PASSWORD&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;password&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;KC_HTTPS_CERTIFICATE_FILE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;/opt/keycloak/conf/server.crt&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;KC_HTTPS_CERTIFICATE_KEY_FILE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;/opt/keycloak/conf/server.key&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="s2"&gt;&amp;#34;8443:8443&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;command&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;start-dev&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;$HOME/cht-keycloak/server.crt:/opt/keycloak/conf/server.crt&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;$HOME/cht-keycloak/server.key:/opt/keycloak/conf/server.key&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;- &lt;span class="l"&gt;$HOME/cht-keycloak/data:/opt/keycloak/data&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="l"&gt;EOF&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="l"&gt;cd $HOME/cht-keycloak&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="l"&gt;docker compose up -d&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
&gt;
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The Keycloak instance is accessible on your Docker Helper URL, but on port &lt;code&gt;8443&lt;/code&gt;. For example &lt;code&gt;https://192-168-68-26.local-ip.medicmobile.org:8443&lt;/code&gt;. The username is &lt;code&gt;medic&lt;/code&gt; and the password is &lt;code&gt;password&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now create an instance of &lt;a href="https://docs.communityhealthtoolkit.org/hosting/cht/app-developer/#cht-docker-helper-for-4x" &gt;Docker Helper&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Keycloak Setup&lt;span class="hx-absolute -hx-mt-20" id="keycloak-setup"&gt;&lt;/span&gt;
&lt;a href="#keycloak-setup" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class="steps hx-ml-4 hx-mb-12 ltr:hx-border-l rtl:hx-border-r hx-border-gray-200 ltr:hx-pl-6 rtl:hx-pr-6 dark:hx-border-neutral-800 [counter-reset:step]"&gt;
&lt;h3&gt;Open Keycloak&lt;span class="hx-absolute -hx-mt-20" id="open-keycloak"&gt;&lt;/span&gt;
&lt;a href="#open-keycloak" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Be sure you&amp;rsquo;re logged in&lt;/p&gt;
&lt;p&gt;
&lt;img src="../keycloak/welcome.png" alt="welcome.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;h3&gt;Add new Client&lt;span class="hx-absolute -hx-mt-20" id="add-new-client"&gt;&lt;/span&gt;
&lt;a href="#add-new-client" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Add new Client in Keycloak by going to &amp;ldquo;Clients&amp;rdquo; &amp;gt; &amp;ldquo;Create Client&amp;rdquo;. Be sure to replace &lt;code&gt;CHT_URL&lt;/code&gt; with the production URL of your CHT instance. If you&amp;rsquo;re on a development instance be sure to include the port:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Client Type: &lt;code&gt;OpenID Connect&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Client ID: &lt;code&gt;CHT&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Client authentication: &lt;code&gt;On&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Authentication Flow: &lt;code&gt;Standard flow&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Valid redirect URIs: &lt;code&gt;https://&amp;lt;CHT_URL&amp;gt;/medic/login/oidc&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
&lt;img src="../keycloak/newclient-new.png" alt="Create new Client" loading="lazy" /&gt;&lt;/p&gt;
&lt;p&gt;
&lt;img src="../keycloak/newclient-new2.png" alt="Client ID" loading="lazy" /&gt;&lt;/p&gt;
&lt;p&gt;
&lt;img src="../keycloak/newclient-new3.png" alt="Client authentication" loading="lazy" /&gt;&lt;/p&gt;
&lt;p&gt;
&lt;img src="../keycloak/newclient-new4.png" alt="Valid redirect URIs" loading="lazy" /&gt;&lt;/p&gt;
&lt;h3&gt;Copy Secret&lt;span class="hx-absolute -hx-mt-20" id="copy-secret"&gt;&lt;/span&gt;
&lt;a href="#copy-secret" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;On the new &lt;code&gt;CHT&lt;/code&gt; client go to &amp;ldquo;Credentials&amp;rdquo; and copy the &amp;ldquo;Client Secret&amp;rdquo; value. You&amp;rsquo;ll need this later when configuring the CHT.&lt;/p&gt;
&lt;p&gt;
&lt;img src="../keycloak/copy.secret.png" alt="copy.secret.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;CHT Setup&lt;span class="hx-absolute -hx-mt-20" id="cht-setup"&gt;&lt;/span&gt;
&lt;a href="#cht-setup" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class="steps hx-ml-4 hx-mb-12 ltr:hx-border-l rtl:hx-border-r hx-border-gray-200 ltr:hx-pl-6 rtl:hx-pr-6 dark:hx-border-neutral-800 [counter-reset:step]"&gt;
&lt;h3&gt;CHT App Settings&lt;span class="hx-absolute -hx-mt-20" id="cht-app-settings"&gt;&lt;/span&gt;
&lt;a href="#cht-app-settings" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;In the config directory for your app, update your &lt;code&gt;app_settings.json&lt;/code&gt; file to contain this additional JSON at the end, before the very last &lt;code&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Be sure to replace &lt;code&gt;KEYCLOAK_URL&lt;/code&gt; with the production URL of your Keycloak instance and &lt;code&gt;CHT_URL&lt;/code&gt; with the production URL of your CHT instance. If you&amp;rsquo;re using a development instance, be sure the &lt;code&gt;CHT_URL&lt;/code&gt; includes your port.&lt;/p&gt;
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code"&gt;
&lt;div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="s2"&gt;&amp;#34;oidc_provider&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;client_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;CHT&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;discovery_url&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;https://&amp;lt;KEYCLOAK_URL&amp;gt;/realms/master/.well-known/openid-configuration&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="s2"&gt;&amp;#34;app_url&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;https://&amp;lt;CHT_URL&amp;gt;/&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
&gt;
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Upload CHT config&lt;span class="hx-absolute -hx-mt-20" id="upload-cht-config"&gt;&lt;/span&gt;
&lt;a href="#upload-cht-config" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class="hextra-scrollbar hx-overflow-x-auto hx-overflow-y-hidden hx-overscroll-x-contain"&gt;
&lt;div class="hx-mt-4 hx-flex hx-w-max hx-min-w-full hx-border-b hx-border-gray-200 hx-pb-px dark:hx-border-neutral-800"&gt;&lt;button
class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
role="tab"
type="button"
aria-controls="tabs-panel-0" aria-selected="true" tabindex="0" data-state="selected"&gt;Production&lt;/button&gt;&lt;button
class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
role="tab"
type="button"
aria-controls="tabs-panel-1"&gt;Development&lt;/button&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;div
class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
id="tabs-panel-0"
role="tabpanel" tabindex="0" data-state="selected" &gt;&lt;p&gt;Upload the config using CHT Conf. Replace &lt;code&gt;CHT_URL&lt;/code&gt; with the production URL of your CHT instance, &lt;code&gt;USER&lt;/code&gt; with your admin user and &lt;code&gt;PASSWORD&lt;/code&gt; with your password:&lt;/p&gt;
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code"&gt;
&lt;div&gt;&lt;pre&gt;&lt;code&gt;cht --url=https://&amp;lt;USER&amp;gt;:&amp;lt;PASSWORD&amp;gt;@&amp;lt;CHT_URL&amp;gt; compile-app-settings upload-app-settings&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
&gt;
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div
class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
id="tabs-panel-1"
role="tabpanel"&gt;&lt;p&gt;Upload the config using CHT Conf. Replace &lt;code&gt;CHT_URL&lt;/code&gt; with the docker helper URL, including port:&lt;/p&gt;
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code"&gt;
&lt;div&gt;&lt;pre&gt;&lt;code&gt;cht --url=https://medic:password@&amp;lt;CHT_URL&amp;gt; compile-app-settings upload-app-settings&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
&gt;
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Client Secret in CHT&lt;span class="hx-absolute -hx-mt-20" id="client-secret-in-cht"&gt;&lt;/span&gt;
&lt;a href="#client-secret-in-cht" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Use the &lt;a href="https://docs.communityhealthtoolkit.org/building/reference/api/#put-apiv1credentials" target="_blank" rel="noopener"&gt;&lt;code&gt;/api/v1/credentials&lt;/code&gt; REST api&lt;/a&gt; to set the client secret as the &lt;code&gt;oidc:client-secret&lt;/code&gt; credential.&lt;/p&gt;
&lt;div class="hextra-scrollbar hx-overflow-x-auto hx-overflow-y-hidden hx-overscroll-x-contain"&gt;
&lt;div class="hx-mt-4 hx-flex hx-w-max hx-min-w-full hx-border-b hx-border-gray-200 hx-pb-px dark:hx-border-neutral-800"&gt;&lt;button
class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
role="tab"
type="button"
aria-controls="tabs-panel-0" aria-selected="true" tabindex="0" data-state="selected"&gt;Production&lt;/button&gt;&lt;button
class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
role="tab"
type="button"
aria-controls="tabs-panel-1"&gt;Development&lt;/button&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;div
class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
id="tabs-panel-0"
role="tabpanel" tabindex="0" data-state="selected" &gt;&lt;p&gt;Be sure to replace &lt;code&gt;SECRET&lt;/code&gt; with the value from &lt;a href="#copy-secret" &gt;step 5 above&lt;/a&gt;. As well, replace &lt;code&gt;CHT_URL&lt;/code&gt; with the production URL of your CHT instance, &lt;code&gt;USER&lt;/code&gt; with your admin user and &lt;code&gt;PASSWORD&lt;/code&gt; with your password:&lt;/p&gt;
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code"&gt;
&lt;div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;curl -X PUT https://&amp;lt;USER&amp;gt;:&amp;lt;PASSWORD&amp;gt;@&amp;lt;CHT_URL&amp;gt;/api/v1/credentials/oidc:client-secret &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -H &lt;span class="s2"&gt;&amp;#34;Content-Type: text/plain&amp;#34;&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; --data &lt;span class="s2"&gt;&amp;#34;&amp;lt;SECRET&amp;gt;&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
&gt;
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div
class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
id="tabs-panel-1"
role="tabpanel"&gt;&lt;p&gt;Be sure to replace &lt;code&gt;SECRET&lt;/code&gt; with the value from &lt;a href="#copy-secret" &gt;step 5 above&lt;/a&gt;. As well, replace &lt;code&gt;CHT_URL&lt;/code&gt; with the docker helper URL, including port:&lt;/p&gt;
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code"&gt;
&lt;div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;curl -X PUT https://medic:password@&amp;lt;CHT_URL&amp;gt;/api/v1/credentials/oidc:client-secret &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -H &lt;span class="s2"&gt;&amp;#34;Content-Type: text/plain&amp;#34;&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; --data &lt;span class="s2"&gt;&amp;#34;&amp;lt;SECRET&amp;gt;&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
&gt;
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Upon success, &lt;code&gt;curl&lt;/code&gt; should show the JSON &lt;code&gt;{&amp;quot;ok&amp;quot;:true}&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;Further, going to the CHT login screen should now show an extra login button &amp;ldquo;Login with SSO&amp;rdquo;. You may need to hold down the &amp;ldquo;shift&amp;rdquo; key and click reload to clear the browser cache:&lt;/p&gt;
&lt;p&gt;
&lt;img src="../keycloak/login-with-sso-button.png" alt="login-with-sso-button.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;Add a test user (optional)&lt;span class="hx-absolute -hx-mt-20" id="add-a-test-user-optional"&gt;&lt;/span&gt;
&lt;a href="#add-a-test-user-optional" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class="steps hx-ml-4 hx-mb-12 ltr:hx-border-l rtl:hx-border-r hx-border-gray-200 ltr:hx-pl-6 rtl:hx-pr-6 dark:hx-border-neutral-800 [counter-reset:step]"&gt;
&lt;h3&gt;Add Keycloak user&lt;span class="hx-absolute -hx-mt-20" id="add-keycloak-user"&gt;&lt;/span&gt;
&lt;a href="#add-keycloak-user" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;In Keycloak, create a new user by going to &amp;ldquo;Users&amp;rdquo; &amp;gt; &amp;ldquo;Add user&amp;rdquo;. Specify username of &lt;code&gt;test&lt;/code&gt; and and email of &lt;code&gt;test@test.com&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;
&lt;img src="../keycloak/new.user.png" alt="new.user.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;h3&gt;Set Keycloak users&amp;rsquo;s password&lt;span class="hx-absolute -hx-mt-20" id="set-keycloak-userss-password"&gt;&lt;/span&gt;
&lt;a href="#set-keycloak-userss-password" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Go to the user&amp;rsquo;s &amp;ldquo;Credentials&amp;rdquo; tab and select &amp;ldquo;Set password&amp;rdquo;&lt;/p&gt;
&lt;p&gt;
&lt;img src="../keycloak/set.password.png" alt="set.password.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;p&gt;
&lt;img src="../keycloak/password.png" alt="password.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;h3&gt;Add CHT user&lt;span class="hx-absolute -hx-mt-20" id="add-cht-user"&gt;&lt;/span&gt;
&lt;a href="#add-cht-user" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;From the &amp;ldquo;App Management&amp;rdquo; console in the CHT, go to &amp;ldquo;Users&amp;rdquo; &amp;gt; &amp;ldquo;Add user&amp;rdquo;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;User name: &lt;code&gt;test&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;SSO Email Address: &lt;code&gt;test@test.com&lt;/code&gt; (must match email &lt;a href="#add-keycloak-user" &gt;from step #1&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Note&lt;/strong&gt; - the &lt;code&gt;E-mail address&lt;/code&gt; field is not used for SSO.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
&lt;img src="../keycloak/cht.new.user.png" alt="cht.new.user.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;h3&gt;Test login&lt;span class="hx-absolute -hx-mt-20" id="test-login"&gt;&lt;/span&gt;
&lt;a href="#test-login" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Logout as the Admin user and then on the CHT login screen, select &amp;ldquo;Login with SSO&amp;rdquo;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Your browser will be redirected to the Keycloak login screen&lt;/li&gt;
&lt;li&gt;Enter the username/password for your Keycloak user&lt;/li&gt;
&lt;li&gt;You will be redirected back to the CHT app and logged in as your CHT user&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3&gt;References&lt;span class="hx-absolute -hx-mt-20" id="references"&gt;&lt;/span&gt;
&lt;a href="#references" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.keycloak.org/getting-started/getting-started-docker" target="_blank" rel="noopener"&gt;Keycloak Docker Quickstart&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Using CHT with Entra</title><link>https://docs.communityhealthtoolkit.org/hosting/sso/entra/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/hosting/sso/entra/</guid><description>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-orange-100 hx-bg-orange-50 hx-text-orange-800 dark:hx-border-orange-400/30 dark:hx-bg-orange-400/20 dark:hx-text-orange-300"&gt;
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2"&gt;&lt;/div&gt;
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7"&gt;
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0"&gt;Introduced in 4.20.0. This feature is only compatible with cht-android version &lt;code&gt;v1.5.2&lt;/code&gt; or greater.&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Introduction&lt;span class="hx-absolute -hx-mt-20" id="introduction"&gt;&lt;/span&gt;
&lt;a href="#introduction" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;These steps document how to configure Microsoft Entra as the Single Sign On (SSO) identity provider for the CHT. As well, it walks through provisioning a single user for SSO.&lt;/p&gt;
&lt;h2&gt;Prerequisites&lt;span class="hx-absolute -hx-mt-20" id="prerequisites"&gt;&lt;/span&gt;
&lt;a href="#prerequisites" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="https://entra.microsoft.com" target="_blank" rel="noopener"&gt;Microsoft Entra&lt;/a&gt; business account with credit card added. Free trial accounts work, but require a credit card.&lt;/li&gt;
&lt;li&gt;CHT server - ensure you are running version &lt;code&gt;4.20.0&lt;/code&gt; or later. This can be an instance of &lt;a href="https://docs.communityhealthtoolkit.org/hosting/cht/app-developer/#cht-docker-helper-for-4x" &gt;Docker Helper&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;DNS Entries and TLS enabled on CHT&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Entra Setup&lt;span class="hx-absolute -hx-mt-20" id="entra-setup"&gt;&lt;/span&gt;
&lt;a href="#entra-setup" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class="steps hx-ml-4 hx-mb-12 ltr:hx-border-l rtl:hx-border-r hx-border-gray-200 ltr:hx-pl-6 rtl:hx-pr-6 dark:hx-border-neutral-800 [counter-reset:step]"&gt;
&lt;h3&gt;Login&lt;span class="hx-absolute -hx-mt-20" id="login"&gt;&lt;/span&gt;
&lt;a href="#login" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Login to &lt;a href="https://entra.microsoft.com" target="_blank" rel="noopener"&gt;Entra&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;Add new Client&lt;span class="hx-absolute -hx-mt-20" id="add-new-client"&gt;&lt;/span&gt;
&lt;a href="#add-new-client" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Navigate to &amp;ldquo;Applications&amp;rdquo; &amp;gt; &amp;ldquo;App registrations&amp;rdquo; &amp;gt; &amp;ldquo;New registration&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Add a &amp;ldquo;user-facing display name&amp;rdquo; of &lt;code&gt;CHT&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Under &amp;ldquo;Redirect URI (optional)&amp;rdquo; select &lt;code&gt;Web&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Enter &lt;code&gt;https://&amp;lt;CHT_URL&amp;gt;/medic/login/oidc&lt;/code&gt; as the redirect URI, being sure to replace &lt;code&gt;CHT_URL&lt;/code&gt; with your production CHT URL&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
&lt;img src="../entra/new-registration.png" alt="new-registration.png" loading="lazy" /&gt;
&lt;img src="../entra/new-registration2.png" alt="new-registration2.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;h3&gt;Copy Secret&lt;span class="hx-absolute -hx-mt-20" id="copy-secret"&gt;&lt;/span&gt;
&lt;a href="#copy-secret" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Navigate to &amp;ldquo;Certificates &amp;amp; secrets&amp;rdquo; &amp;gt; &amp;ldquo;Client secrets&amp;rdquo; &amp;gt; &amp;ldquo;New client secret&amp;rdquo;. Add a new secret and copy the &lt;code&gt;Value&lt;/code&gt; string&lt;/p&gt;
&lt;p&gt;
&lt;img src="../entra/new-secret.png" alt="new-secret.png" loading="lazy" /&gt;
&lt;img src="../entra/copy-secret.png" alt="copy-secret.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;h3&gt;Copy Discovery URL&lt;span class="hx-absolute -hx-mt-20" id="copy-discovery-url"&gt;&lt;/span&gt;
&lt;a href="#copy-discovery-url" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;From the &amp;ldquo;Overview&amp;rdquo; page copy the &amp;ldquo;Application (client) ID&amp;rdquo; and the &amp;ldquo;Directory (tenant) ID&amp;rdquo; which are needed for the &lt;code&gt;client_id&lt;/code&gt; and &lt;code&gt;discovery_url&lt;/code&gt; respectively in step 1 below.&lt;/p&gt;
&lt;p&gt;
&lt;img src="../entra/client-overview.png" alt="client-overview.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;CHT Setup&lt;span class="hx-absolute -hx-mt-20" id="cht-setup"&gt;&lt;/span&gt;
&lt;a href="#cht-setup" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class="steps hx-ml-4 hx-mb-12 ltr:hx-border-l rtl:hx-border-r hx-border-gray-200 ltr:hx-pl-6 rtl:hx-pr-6 dark:hx-border-neutral-800 [counter-reset:step]"&gt;
&lt;h3&gt;CHT App Settings&lt;span class="hx-absolute -hx-mt-20" id="cht-app-settings"&gt;&lt;/span&gt;
&lt;a href="#cht-app-settings" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;In the config directory for your app, update your &lt;code&gt;app_settings.json&lt;/code&gt; file to contain this additional JSON at the end, before the very last &lt;code&gt;}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Be sure to replace &lt;code&gt;APP_ID&lt;/code&gt; with the Application (client) ID and &lt;code&gt;DIRECTORY_ID&lt;/code&gt; with Directory (tenant) ID both from step 4 above. Replace the &lt;code&gt;CHT_URL&lt;/code&gt; with the production URL of your CHT instance. If you&amp;rsquo;re using a development instance, be sure the &lt;code&gt;CHT_URL&lt;/code&gt; includes your port.&lt;/p&gt;
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code"&gt;
&lt;div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="s2"&gt;&amp;#34;oidc_provider&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;client_id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;&amp;lt;APP_ID&amp;gt;&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;discovery_url&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;https://login.microsoftonline.com/&amp;lt;DIRECTORY_ID&amp;gt;/v2.0/.well-known/openid-configuration&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="s2"&gt;&amp;#34;app_url&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;https://&amp;lt;CHT_URL&amp;gt;/&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
&gt;
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Upload CHT config&lt;span class="hx-absolute -hx-mt-20" id="upload-cht-config"&gt;&lt;/span&gt;
&lt;a href="#upload-cht-config" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class="hextra-scrollbar hx-overflow-x-auto hx-overflow-y-hidden hx-overscroll-x-contain"&gt;
&lt;div class="hx-mt-4 hx-flex hx-w-max hx-min-w-full hx-border-b hx-border-gray-200 hx-pb-px dark:hx-border-neutral-800"&gt;&lt;button
class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
role="tab"
type="button"
aria-controls="tabs-panel-0" aria-selected="true" tabindex="0" data-state="selected"&gt;Production&lt;/button&gt;&lt;button
class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
role="tab"
type="button"
aria-controls="tabs-panel-1"&gt;Development&lt;/button&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;div
class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
id="tabs-panel-0"
role="tabpanel" tabindex="0" data-state="selected" &gt;&lt;p&gt;Upload the config using CHT Conf. Replace &lt;code&gt;CHT_URL&lt;/code&gt; with the production URL of your CHT instance, &lt;code&gt;USER&lt;/code&gt; with your admin user and &lt;code&gt;PASSWORD&lt;/code&gt; with your password:&lt;/p&gt;
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code"&gt;
&lt;div&gt;&lt;pre&gt;&lt;code&gt;cht --url=https://&amp;lt;USER&amp;gt;:&amp;lt;PASSWORD&amp;gt;@&amp;lt;CHT_URL&amp;gt; compile-app-settings upload-app-settings&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
&gt;
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div
class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
id="tabs-panel-1"
role="tabpanel"&gt;&lt;p&gt;Upload the config using CHT Conf. Replace &lt;code&gt;CHT_URL&lt;/code&gt; with the docker helper URL, including port:&lt;/p&gt;
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code"&gt;
&lt;div&gt;&lt;pre&gt;&lt;code&gt;cht --url=https://medic:password@&amp;lt;CHT_URL&amp;gt; compile-app-settings upload-app-settings&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
&gt;
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Client Secret in CHT&lt;span class="hx-absolute -hx-mt-20" id="client-secret-in-cht"&gt;&lt;/span&gt;
&lt;a href="#client-secret-in-cht" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Use the &lt;a href="https://docs.communityhealthtoolkit.org/building/reference/api/#put-apiv1credentials" target="_blank" rel="noopener"&gt;&lt;code&gt;/api/v1/credentials&lt;/code&gt; REST api&lt;/a&gt; to set the client secret as the &lt;code&gt;oidc:client-secret&lt;/code&gt; credential.&lt;/p&gt;
&lt;div class="hextra-scrollbar hx-overflow-x-auto hx-overflow-y-hidden hx-overscroll-x-contain"&gt;
&lt;div class="hx-mt-4 hx-flex hx-w-max hx-min-w-full hx-border-b hx-border-gray-200 hx-pb-px dark:hx-border-neutral-800"&gt;&lt;button
class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
role="tab"
type="button"
aria-controls="tabs-panel-0" aria-selected="true" tabindex="0" data-state="selected"&gt;Production&lt;/button&gt;&lt;button
class="hextra-tabs-toggle data-[state=selected]:hx-border-primary-500 data-[state=selected]:hx-text-primary-600 data-[state=selected]:dark:hx-border-primary-500 data-[state=selected]:dark:hx-text-primary-600 hx-mr-2 hx-rounded-t hx-p-2 hx-font-medium hx-leading-5 hx-transition-colors -hx-mb-0.5 hx-select-none hx-border-b-2 hx-border-transparent hx-text-gray-600 hover:hx-border-gray-200 hover:hx-text-black dark:hx-text-gray-200 dark:hover:hx-border-neutral-800 dark:hover:hx-text-white"
role="tab"
type="button"
aria-controls="tabs-panel-1"&gt;Development&lt;/button&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;div
class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
id="tabs-panel-0"
role="tabpanel" tabindex="0" data-state="selected" &gt;&lt;p&gt;Be sure to replace &lt;code&gt;SECRET&lt;/code&gt; with the value from &lt;a href="#copy-secret" &gt;step 3 above&lt;/a&gt;. As well, replace &lt;code&gt;CHT_URL&lt;/code&gt; with the production URL of your CHT instance, &lt;code&gt;USER&lt;/code&gt; with your admin user and &lt;code&gt;PASSWORD&lt;/code&gt; with your password:&lt;/p&gt;
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code"&gt;
&lt;div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;curl -X PUT https://&amp;lt;USER&amp;gt;:&amp;lt;PASSWORD&amp;gt;@&amp;lt;CHT_URL&amp;gt;/api/v1/credentials/oidc:client-secret &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -H &lt;span class="s2"&gt;&amp;#34;Content-Type: text/plain&amp;#34;&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; --data &lt;span class="s2"&gt;&amp;#34;&amp;lt;SECRET&amp;gt;&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
&gt;
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div
class="hextra-tabs-panel hx-rounded hx-pt-6 hx-hidden data-[state=selected]:hx-block"
id="tabs-panel-1"
role="tabpanel"&gt;&lt;p&gt;Be sure to replace &lt;code&gt;SECRET&lt;/code&gt; with the value from &lt;a href="#copy-secret" &gt;step 3 above&lt;/a&gt;. As well, replace &lt;code&gt;CHT_URL&lt;/code&gt; with the docker helper URL, including port:&lt;/p&gt;
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code"&gt;
&lt;div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;curl -X PUT https://medic:password@&amp;lt;CHT_URL&amp;gt;/api/v1/credentials/oidc:client-secret &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -H &lt;span class="s2"&gt;&amp;#34;Content-Type: text/plain&amp;#34;&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; --data &lt;span class="s2"&gt;&amp;#34;&amp;lt;SECRET&amp;gt;&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
&gt;
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Upon success, &lt;code&gt;curl&lt;/code&gt; should show the JSON &lt;code&gt;{&amp;quot;ok&amp;quot;:true}&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;Further, going to the CHT login screen should now show an extra login button &amp;ldquo;Login with SSO&amp;rdquo;. You may need to hold down the &amp;ldquo;shift&amp;rdquo; key and click reload to clear the browser cache:&lt;/p&gt;
&lt;p&gt;
&lt;img src="../keycloak/login-with-sso-button.png" alt="login-with-sso-button.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;Add a test user (optional)&lt;span class="hx-absolute -hx-mt-20" id="add-a-test-user-optional"&gt;&lt;/span&gt;
&lt;a href="#add-a-test-user-optional" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class="steps hx-ml-4 hx-mb-12 ltr:hx-border-l rtl:hx-border-r hx-border-gray-200 ltr:hx-pl-6 rtl:hx-pr-6 dark:hx-border-neutral-800 [counter-reset:step]"&gt;
&lt;h3&gt;Add Entra user: Screen 1&lt;span class="hx-absolute -hx-mt-20" id="add-entra-user-screen-1"&gt;&lt;/span&gt;
&lt;a href="#add-entra-user-screen-1" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Navigate to &amp;ldquo;Users&amp;rdquo; &amp;gt; &amp;ldquo;All users&amp;rdquo; &amp;gt; &amp;ldquo;New user&amp;rdquo; &amp;gt; &amp;ldquo;Create new user&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Enter details for your test user. Specifically note the &amp;ldquo;Mail nickname&amp;rdquo; value as this will need to match the &lt;code&gt;email&lt;/code&gt; value for your CHT user.&lt;/li&gt;
&lt;li&gt;Specify &amp;ldquo;User principal name&amp;rdquo; of &lt;code&gt;test&lt;/code&gt; which will translate to &lt;code&gt;test@&amp;lt;DOMAIN&amp;gt;.com&lt;/code&gt; where &lt;code&gt;DOMAIN&lt;/code&gt; is the domain you have configured for Entra.&lt;/li&gt;
&lt;li&gt;Be sure to copy the principal name and the generated password&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
&lt;img src="../entra/create-new-user.png" alt="create-new-user.png" loading="lazy" /&gt;
&lt;img src="../entra/create-new-user2.png" alt="create-new-user2.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;h3&gt;Add Entra user: Screen 2&lt;span class="hx-absolute -hx-mt-20" id="add-entra-user-screen-2"&gt;&lt;/span&gt;
&lt;a href="#add-entra-user-screen-2" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;On the 2nd &amp;ldquo;Properties&amp;rdquo; screen, you must paste the exact &amp;ldquo;User principal name&amp;rdquo; into &amp;ldquo;Contact Information&amp;rdquo; -&amp;gt; &amp;ldquo;Email&amp;rdquo; from the prior screen. This is what will get passed to the CHT:&lt;/p&gt;
&lt;p&gt;
&lt;img src="../entra/create-new-user3.png" alt="create-new-user3.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;h3&gt;Add CHT user&lt;span class="hx-absolute -hx-mt-20" id="add-cht-user"&gt;&lt;/span&gt;
&lt;a href="#add-cht-user" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;From the &amp;ldquo;App Management&amp;rdquo; console in the CHT, go to &amp;ldquo;Users&amp;rdquo; &amp;gt; &amp;ldquo;Add user&amp;rdquo;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;User name: &lt;code&gt;test&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;SSO Email Address: &lt;code&gt;test@test.com&lt;/code&gt; (must match email from prior step)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Note&lt;/strong&gt; - the &lt;code&gt;E-mail address&lt;/code&gt; field is not used for SSO.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
&lt;img src="../entra/cht-new-user.png" alt="cht.new.user.png" loading="lazy" /&gt;&lt;/p&gt;
&lt;h3&gt;Test login&lt;span class="hx-absolute -hx-mt-20" id="test-login"&gt;&lt;/span&gt;
&lt;a href="#test-login" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Logout as the Admin user and then on the CHT login screen, select &amp;ldquo;Login with SSO&amp;rdquo;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Your browser will be redirected to the Entra login screen&lt;/li&gt;
&lt;li&gt;Enter the username/password for your Entra user&lt;/li&gt;
&lt;li&gt;You will be redirected back to the CHT app and logged in as your CHT user&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3&gt;References&lt;span class="hx-absolute -hx-mt-20" id="references"&gt;&lt;/span&gt;
&lt;a href="#references" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;tk&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>SSO technical reference</title><link>https://docs.communityhealthtoolkit.org/hosting/sso/technical/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/hosting/sso/technical/</guid><description>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-orange-100 hx-bg-orange-50 hx-text-orange-800 dark:hx-border-orange-400/30 dark:hx-bg-orange-400/20 dark:hx-text-orange-300"&gt;
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2"&gt;&lt;/div&gt;
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7"&gt;
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0"&gt;Introduced in 4.20.0. This feature is only compatible with cht-android version &lt;code&gt;v1.5.2&lt;/code&gt; or greater.&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;CHT &lt;code&gt;4.20.0&lt;/code&gt; introduced the single sign on (SSO) feature allowing deployments to use the industry standard &lt;a href="https://openid.net/" target="_blank" rel="noopener"&gt;OpenID Connect&lt;/a&gt; (OIDC) protocol to authenticate users. Below are some key points on the SSO functionality in the CHT. See the &lt;a href="https://docs.google.com/document/d/1LUn1ZRetAmYE04CtdcTmp-bEBvl37AZ0CvFXZChXqfU/edit?tab=t.0" target="_blank" rel="noopener"&gt;technical design document&lt;/a&gt; for all the details.&lt;/p&gt;
&lt;h2&gt;Setup&lt;span class="hx-absolute -hx-mt-20" id="setup"&gt;&lt;/span&gt;
&lt;a href="#setup" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Follow the &lt;a href="https://docs.communityhealthtoolkit.org/hosting/sso/" &gt;setup steps&lt;/a&gt; to &lt;a href="https://docs.communityhealthtoolkit.org/building/reference/app-settings/oidc_provider/" &gt;configure your CHT instance&lt;/a&gt; for SSO Login. Once the server has been properly configured, the &amp;ldquo;Login with SSO&amp;rdquo; button will be visible on the CHT Login page. CHT users with the &lt;a href="https://docs.communityhealthtoolkit.org/building/reference/api/#login-by-oidc" &gt;&lt;code&gt;oidc_username&lt;/code&gt; property&lt;/a&gt; will be able to log in with their SSO credentials. The &amp;ldquo;SSO Email Address&amp;rdquo; field will be also be visible in the create/update users modal in the &lt;a href="https://docs.communityhealthtoolkit.org/building/admin/admin-overview/" &gt;App Management interface&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;User Mapping&lt;span class="hx-absolute -hx-mt-20" id="user-mapping"&gt;&lt;/span&gt;
&lt;a href="#user-mapping" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Note that the &amp;ldquo;SSO Email Address&amp;rdquo; field is used to populate the user&amp;rsquo;s &lt;code&gt;oidc_username&lt;/code&gt; property. The &lt;code&gt;oidc_username&lt;/code&gt; is stored separately from the user&amp;rsquo;s normal &lt;code&gt;email&lt;/code&gt; property (populated from the &amp;ldquo;Email Address&amp;rdquo; field in the App Management interface) and different values can be provided for each. Only the &lt;code&gt;oidc_username&lt;/code&gt; will be considered when logging in an SSO user. Users with the &lt;code&gt;can_edit_profile&lt;/code&gt; permission are able to edit their &lt;code&gt;email&lt;/code&gt; value, but only administrators can edit a user&amp;rsquo;s &lt;code&gt;oidc_username&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;If someone selects the &amp;ldquo;Login with SSO&amp;rdquo; button and successfully authenticates with the OIDC provider, but their OIDC user account does not have a corresponding CHT user (the &lt;code&gt;email&lt;/code&gt; claim from the OIDC user does not match any CHT user &lt;code&gt;oidc_username&lt;/code&gt;), they will not be logged into the CHT. Instead they will be redirected back to the login page with an error message indicating that they are not allowed to log in with SSO.&lt;/p&gt;
&lt;p&gt;Users with a currently active OIDC session may not be required to re-authenticate. Instead, when logging into the CHT for the first time they will be prompted by their OIDC Provider to allow the CHT to access their user information.&lt;/p&gt;
&lt;p&gt;A user with the &lt;code&gt;oidc_username&lt;/code&gt; property is only allowed to log in with SSO. Any other authentication method (e.g. username/password or token login) will fail.&lt;/p&gt;
&lt;p&gt;To convert an SSO user in the CHT back to a normal CHT user (with username/password authentication), simply remove the user&amp;rsquo;s &lt;code&gt;oidc_username&lt;/code&gt; (by deleting the value from the &amp;ldquo;SSO Email Address&amp;rdquo; field). A new password must then be set for the user. All the user&amp;rsquo;s existing sessions will be invalidated and the user must log in again (this time by using their CHT username/password).&lt;/p&gt;
&lt;h2&gt;CHT User session&lt;span class="hx-absolute -hx-mt-20" id="cht-user-session"&gt;&lt;/span&gt;
&lt;a href="#cht-user-session" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Once an SSO user has successfully authenticated with the CHT (by completing the OIDC flow), their browser receives a valid Couch session cookie (equivalent to the session cookies provided to normal CHT users). For all subsequent operations, the CHT does not distinguish between SSO and non-SSO users since both types of users are authenticating with the same type of session cookie.&lt;/p&gt;
&lt;p&gt;It is very important to note that once an SSO user has successfully authenticated with the CHT, the CHT does not contact the OIDC Provider for subsequent requests from that user. If the user is removed from the OIDC Provider (or their OIDC session is otherwise invalidated), they will still be able to access the CHT. This is because their CHT session cookie is still valid. You can prevent the user from accessing the CHT by disabling their CHT user account, updating their &amp;ldquo;SSO Email Address&amp;rdquo; or removing it and setting a new password for the user.&lt;/p&gt;
&lt;h2&gt;OIDC Login Sequence&lt;span class="hx-absolute -hx-mt-20" id="oidc-login-sequence"&gt;&lt;/span&gt;
&lt;a href="#oidc-login-sequence" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The following diagram demonstrates the sequence of events when a user logs in to the CHT using SSO:&lt;/p&gt;
&lt;pre class="mermaid hx-mt-6"&gt;
sequenceDiagram
autonumber
participant cht as CHT &amp;lt;br/&amp;gt;(api server)
participant user_agent as User &amp;lt;br/&amp;gt;(web browser)
participant auth_server as OIDC Provider &amp;lt;br/&amp;gt;(authorization server)
user_agent-&amp;gt;&amp;gt;cht: Request SSO login authorization
cht-&amp;gt;&amp;gt;user_agent: Redirect to authorize endpoint on OIDC provider
user_agent-&amp;gt;&amp;gt;auth_server: Request OIDC authorization &amp;lt;br/&amp;gt;(happens automatically)
auth_server-&amp;gt;&amp;gt;user_agent: Respond with authentication challenge &amp;lt;br/&amp;gt;(e.g. login page)
user_agent-&amp;gt;&amp;gt;auth_server: User authenticates &amp;lt;br/&amp;gt;(e.g. submits SSO username/password)
auth_server--&amp;gt;&amp;gt;auth_server: Authenticate user
auth_server-&amp;gt;&amp;gt;user_agent: Redirect back to CHT &amp;lt;br/&amp;gt;(with authorization_code)
user_agent-&amp;gt;&amp;gt;cht: Submit authorization_code &amp;lt;br/&amp;gt;(happens automatically)
cht--&amp;gt;&amp;gt;auth_server: Request id_token with email scope
auth_server--&amp;gt;&amp;gt;auth_server: Validates authorization_code &amp;lt;br/&amp;gt;and client credentials
auth_server--&amp;gt;&amp;gt;cht: Reply with id_token (including email claim)
cht-&amp;gt;&amp;gt;user_agent: Reply with session cookie
Note over cht,user_agent: Subsequent requests are made with the &amp;lt;br/&amp;gt;session cookie and do not require contacting&amp;lt;br/&amp;gt;the OIDC provider
&lt;/pre&gt;&lt;h2&gt;Limitations&lt;span class="hx-absolute -hx-mt-20" id="limitations"&gt;&lt;/span&gt;
&lt;a href="#limitations" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;While completely compliant with the OIDC specification, the SSO functionality in the CHT currently has several notable limitations (any of which may be addressed in future releases):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;User auto-provisioning is not supported. Users must be created in the CHT before they can log in with SSO. The CHT does not automatically create users when they log in with SSO for the first time.&lt;/li&gt;
&lt;li&gt;Back-channel logout is not supported. As noted above, when a user&amp;rsquo;s OIDC session is ended, it does not automatically end their CHT session.&lt;/li&gt;
&lt;li&gt;User mapping between OIDC and CHT users only supports matching on the &lt;code&gt;email&lt;/code&gt; claim from the OIDC user. The CHT does not support mapping on other claims (e.g. &lt;code&gt;sub&lt;/code&gt; or &lt;code&gt;preferred_username&lt;/code&gt;).&lt;/li&gt;
&lt;/ul&gt;</description></item></channel></rss>