<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Community Health Toolkit â€“ Contributing Android Code</title><link>https://docs.communityhealthtoolkit.org/community/contributing/code/android/</link><description>Recent content in Contributing Android Code on Community Health Toolkit</description><generator>Hugo -- gohugo.io</generator><language>en</language><atom:link href="https://docs.communityhealthtoolkit.org/community/contributing/code/android/index.xml" rel="self" type="application/rss+xml"/><item><title>Android Dev Environment</title><link>https://docs.communityhealthtoolkit.org/community/contributing/code/android/development-setup/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/community/contributing/code/android/development-setup/</guid><description>
&lt;p&gt;The following instructions allows you to setup a development environment for the &lt;strong&gt;&lt;a href="https://github.com/medic/cht-android" rel="external"&gt;CHT Android&lt;/a&gt;&lt;/strong&gt; apps, and the &lt;strong&gt;&lt;a href="https://github.com/medic/cht-gateway" rel="external"&gt;CHT Gateway&lt;/a&gt;&lt;/strong&gt; app as well.&lt;/p&gt;
&lt;p&gt;Finally, you will learn how to assemble the app, run the tests, and how to choose the right artifacts when installing or publishing the apps.&lt;/p&gt;
&lt;h2&gt;Requirements&lt;span class="hx:absolute hx:-mt-20" id="requirements"&gt;&lt;/span&gt;
&lt;a href="#requirements" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Java 17+ (OpenJDK versions work).&lt;/li&gt;
&lt;li&gt;Android SDK, and optionally Android Studio.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;adb&lt;/code&gt; command for debugging and get the logs.&lt;/li&gt;
&lt;li&gt;The source code. To run all the tests in the CHT Android app you need to clone also the submodules: &lt;code&gt;git clone --recurse-submodules https://github.com/medic/cht-android.git&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;make&lt;/code&gt; command.&lt;/li&gt;
&lt;li&gt;If you are going to build a new flavor (CHT Android), you also need to have installed: &lt;code&gt;head&lt;/code&gt;, &lt;code&gt;xxd&lt;/code&gt;, &lt;code&gt;openssl&lt;/code&gt; and &lt;code&gt;apksigner&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Gradle&lt;/strong&gt; is also used but it&amp;rsquo;s downloaded and installed in the user space the first time &lt;code&gt;make&lt;/code&gt; is executed. You can also build and launch the app with &lt;a href="https://docs.communityhealthtoolkit.org/community/contributing/code/android/development-setup/#android-studio"&gt;Android Studio&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Below are the instructions of how to install and setup some of the tools required.&lt;/p&gt;
&lt;h2&gt;Install&lt;span class="hx:absolute hx:-mt-20" id="install"&gt;&lt;/span&gt;
&lt;a href="#install" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Java&lt;span class="hx:absolute hx:-mt-20" id="java"&gt;&lt;/span&gt;
&lt;a href="#java" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Java 17+ needs to be installed. The &lt;code&gt;bin/&lt;/code&gt; folder of the JDK must added into the &lt;code&gt;$PATH&lt;/code&gt; environment variable, and it&amp;rsquo;s recommended to have &lt;code&gt;$JAVA_HOME&lt;/code&gt; pointing to the JDK folder as well.&lt;/p&gt;
&lt;p&gt;To install different versions of Java and without the need to have root permissions, checkout &lt;a href="https://sdkman.io/" rel="external"&gt;Sdkman!&lt;/a&gt;, if you are familiar with tools like &lt;code&gt;nvm&lt;/code&gt; or &lt;code&gt;rvm&lt;/code&gt;, this tool is pretty much the same for Java, and the command takes care of adding the selected JDK to the &lt;code&gt;$PATH&lt;/code&gt; variable and to set the &lt;code&gt;$JAVA_HOME&lt;/code&gt; variable when switching across different versions.&lt;/p&gt;
&lt;h3&gt;Android Studio and the SDK&lt;span class="hx:absolute hx:-mt-20" id="android-studio-and-the-sdk"&gt;&lt;/span&gt;
&lt;a href="#android-studio-and-the-sdk" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Android Studio is the full package: the IDE based on IntelliJ IDEA, the Android SDK and the SDK Manager with the UI to manage different packages visually, while the SDK alone only includes the command line tools like the &lt;code&gt;sdkmanager&lt;/code&gt; CLI.&lt;/p&gt;
&lt;p&gt;You don&amp;rsquo;t need the IDE to build the app or to install a &amp;ldquo;debug&amp;rdquo; version in a device, or get the logs, but it&amp;rsquo;s recommended if you also want to debug the app or modify the code.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Android Studio: download from &lt;a href="https://developer.android.com/studio" rel="external"&gt;https://developer.android.com/studio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Command line tools only: download from &lt;a href="https://developer.android.com/studio" rel="external"&gt;https://developer.android.com/studio&lt;/a&gt;. Scroll down to the &amp;lsquo;Command Line Tools Only&amp;rsquo; section of the page.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you install Android Studio it&amp;rsquo;s still recommended to download and setup the command line tools separately to be able to use them without the IDE.&lt;/p&gt;
&lt;p&gt;The binary folder of the command also need to be added to the &lt;code&gt;$PATH&lt;/code&gt;, and &lt;code&gt;$ANDROID_HOME&lt;/code&gt; pointing to the root of the SDK. Moreover, the SDK requires to be stored in the &lt;code&gt;$ANDROID_HOME&lt;/code&gt; and inside a folder called &lt;code&gt;latest&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Here are the steps from the command line you can follow to install the CLI tools once downloaded the zip file:&lt;/p&gt;
&lt;div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"&gt;
&lt;div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;mkdir -p Android/Sdk/cmdline-tools
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;unzip commandlinetools-linux-7583922_latest.zip
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;mv cmdline-tools/ Android/Sdk/cmdline-tools/latest/&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50"
title="Copy code"
&gt;
&lt;div class="hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"&gt;&lt;/div&gt;
&lt;div class="hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Then, to add the environment variables required, you can add the following to your &lt;code&gt;~/.bashrc&lt;/code&gt; file:&lt;/p&gt;
&lt;div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"&gt;
&lt;div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;ANDROID_HOME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="nv"&gt;$HOME&lt;/span&gt;&lt;span class="s2"&gt;/Android/Sdk&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;&lt;/span&gt;&lt;span class="nv"&gt;$PATH&lt;/span&gt;&lt;span class="s2"&gt;:&lt;/span&gt;&lt;span class="nv"&gt;$ANDROID_HOME&lt;/span&gt;&lt;span class="s2"&gt;/cmdline-tools/latest/bin&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50"
title="Copy code"
&gt;
&lt;div class="hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"&gt;&lt;/div&gt;
&lt;div class="hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Debug tool &lt;code&gt;adb&lt;/code&gt;&lt;span class="hx:absolute hx:-mt-20" id="debug-tool-adb"&gt;&lt;/span&gt;
&lt;a href="#debug-tool-adb" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Old SDK distributions used to have it pre-packaged, now you have to install it separately. Once installed SDK following the steps above, you can install the latest version of &lt;code&gt;adb&lt;/code&gt; with:&lt;/p&gt;
&lt;div class="hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code"&gt;
&lt;div&gt;&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sdkmanager --install platform-tools&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0"&gt;
&lt;button
class="hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50"
title="Copy code"
&gt;
&lt;div class="hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4"&gt;&lt;/div&gt;
&lt;div class="hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4"&gt;&lt;/div&gt;
&lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;If you also installed Android Studio you can use the &lt;a href="https://developer.android.com/studio/intro/update#sdk-manager" rel="external"&gt;SDK Manager&lt;/a&gt; instead.&lt;/p&gt;
&lt;p&gt;Finally edit again the &lt;code&gt;$PATH&lt;/code&gt; environment variable to add the adb path: &lt;code&gt;$ANDROID_HOME/platform-tools&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;apksigner&lt;/code&gt;&lt;span class="hx:absolute hx:-mt-20" id="apksigner"&gt;&lt;/span&gt;
&lt;a href="#apksigner" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;This tool is used automatically by the Android SDK for signing APKs, and to check the certificate of a given APK, so chances are that after installing the SDK following the steps above you already have it installed, but not configured in the &lt;code&gt;$PATH&lt;/code&gt; that is needed to manually check APKs signature.&lt;/p&gt;
&lt;p&gt;The CLI is part of other CLI tolls under the &lt;code&gt;build-tools&lt;/code&gt; package, and multiple build tools package can be installed, so check what versions you have under the &lt;code&gt;$ANDROID_HOME/build-tools&lt;/code&gt; folder, and add the most up to date to the &lt;code&gt;$PATH&lt;/code&gt; folder. E.g. if you have the version 30.0.3 installed in you computer, apksigner should be installed at &lt;code&gt;$ANDROID_HOME/build-tools/30.0.3/apksigner&lt;/code&gt;, so add the &lt;code&gt;$ANDROID_HOME/build-tools/30.0.3&lt;/code&gt; folder to the &lt;code&gt;$PATH&lt;/code&gt; variable.&lt;/p&gt;
&lt;p&gt;In case you don&amp;rsquo;t have it installed or want to install a newer version, checkout the versions available with &lt;code&gt;sdkmanager --list&lt;/code&gt;. You will see a table with a list of installed and available packages, not just the build tools.&lt;/p&gt;
&lt;p&gt;To install the version 31.0.0: &lt;code&gt;sdkmanager --install 'build-tools;31.0.0'&lt;/code&gt;. Then update or add it to the &lt;code&gt;$PATH&lt;/code&gt; variable.&lt;/p&gt;
&lt;h2&gt;Development&lt;span class="hx:absolute hx:-mt-20" id="development"&gt;&lt;/span&gt;
&lt;a href="#development" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Flavor selection&lt;span class="hx:absolute hx:-mt-20" id="flavor-selection"&gt;&lt;/span&gt;
&lt;a href="#flavor-selection" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;em&gt;Only CHT Android&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Some &lt;code&gt;make&lt;/code&gt; targets support the flavor as &lt;code&gt;make flavor=[Flavor] [task]&lt;/code&gt;, where &lt;code&gt;[Flavor]&lt;/code&gt; is the branded version with the first letter capitalized. The &lt;code&gt;[task]&lt;/code&gt; is the action to execute: &lt;code&gt;deploy&lt;/code&gt;, &lt;code&gt;assemble&lt;/code&gt;, &lt;code&gt;lint&lt;/code&gt;, etc.&lt;/p&gt;
&lt;p&gt;The default value for &lt;code&gt;flavor&lt;/code&gt; is &lt;code&gt;Unbranded&lt;/code&gt;, e.g. executing &lt;code&gt;make deploy&lt;/code&gt; will assemble and install that flavor, while executing &lt;code&gt;make flavor=Medicmobilegamma deploy&lt;/code&gt; will do the same for the &lt;em&gt;Medicmobilegamma&lt;/em&gt; brand.&lt;/p&gt;
&lt;p&gt;See the &lt;a href="https://github.com/medic/cht-android/blob/master/Makefile" rel="external"&gt;Makefile&lt;/a&gt; for more details.&lt;/p&gt;
&lt;h3&gt;Build and assemble&lt;span class="hx:absolute hx:-mt-20" id="build-and-assemble"&gt;&lt;/span&gt;
&lt;a href="#build-and-assemble" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;To build and assemble the apps within the console use:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;make assemble
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The command above builds and assembles the &lt;em&gt;debug&lt;/em&gt; and &lt;em&gt;release&lt;/em&gt; APKs of the apps, and for the CHT-Android project the Unbranded flavor is built and assembled by default.&lt;/p&gt;
&lt;p&gt;Each APK will be generated and stored in &lt;code&gt;build/outputs/apk/[flavor]/[debug|release]/&lt;/code&gt;, for example after assembling the &lt;em&gt;Medicmobilegamma&lt;/em&gt; flavor with &lt;code&gt;make flavor=Medicmobilegamma assemble&lt;/code&gt;, the &lt;em&gt;release&lt;/em&gt; versions of the APKs generated are stored in &lt;code&gt;build/outputs/apk/medicmobilegamma/release/&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;To assemble other flavors, use the following command: &lt;code&gt;make flavour=[Flavor] assemble&lt;/code&gt;. See the &lt;a href="https://docs.communityhealthtoolkit.org/community/contributing/code/android/development-setup/#flavor-selection"&gt;Flavor selection&lt;/a&gt; section for more details about &lt;code&gt;make&lt;/code&gt; commands.&lt;/p&gt;
&lt;p&gt;To create the &lt;code&gt;.aab&lt;/code&gt; bundle file, use &lt;code&gt;make bundle&lt;/code&gt;, although signed versions are generated when &lt;a href="https://docs.communityhealthtoolkit.org/community/contributing/code/android/releasing/"&gt;releasing&lt;/a&gt;, and the Play Store requires the AAB to be signed with the right key.&lt;/p&gt;
&lt;p&gt;To clean the APKs and compiled resources: &lt;code&gt;make clean&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Testing&lt;span class="hx:absolute hx:-mt-20" id="testing"&gt;&lt;/span&gt;
&lt;a href="#testing" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;To execute unit tests and static analysis, run: &lt;code&gt;make test&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;To generate a unit test coverage report, run: &lt;code&gt;make test-coverage&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Find the generated report in:
&lt;code&gt;build/reports/jacoco/makeUnbrandedDebugUnitTestCoverageReport/html/index.html&lt;/code&gt;&lt;/p&gt;
&lt;h4&gt;Static checks&lt;span class="hx:absolute hx:-mt-20" id="static-checks"&gt;&lt;/span&gt;
&lt;a href="#static-checks" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;em&gt;Only CHT Android&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;To only execute the &lt;strong&gt;linter checks&lt;/strong&gt;, run: &lt;code&gt;make lint&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;Instrumentation Tests&lt;span class="hx:absolute hx:-mt-20" id="instrumentation-tests"&gt;&lt;/span&gt;
&lt;a href="#instrumentation-tests" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;em&gt;Only CHT Android&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The UI tests run on a device.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Uninstall previous versions of the app, otherwise an &lt;code&gt;InstallException: INSTALL_FAILED_VERSION_DOWNGRADE&lt;/code&gt; can cause tests to fail.&lt;/li&gt;
&lt;li&gt;Select English as default language in the device.&lt;/li&gt;
&lt;li&gt;Ensure you meet all the &lt;a href="https://docs.communityhealthtoolkit.org/community/contributing/code/android/development-setup/#requirements"&gt;Requirements&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Execute: &lt;code&gt;make test-ui-all&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;Shell tests&lt;span class="hx:absolute hx:-mt-20" id="shell-tests"&gt;&lt;/span&gt;
&lt;a href="#shell-tests" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;em&gt;Only CHT Android&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The project has bash tests that verify the Make targets used to create and manage the keystores used to sign the apps. Use &lt;code&gt;make test-bash-keystore&lt;/code&gt; to run them. In CI they are executed in Linux and MacOS VMs.&lt;/p&gt;
&lt;p&gt;If you get an error like &lt;code&gt;make: ./src/test/bash/bats/bin/bats: Command not found&lt;/code&gt;, it&amp;rsquo;s because you cloned the project without the &lt;code&gt;--recurse-submodules&lt;/code&gt; git argument. Execute first &lt;code&gt;git submodule update --init&lt;/code&gt; to clone
the submodules within the cht-android folder.&lt;/p&gt;
&lt;h4&gt;Connecting to the server locally&lt;span class="hx:absolute hx:-mt-20" id="connecting-to-the-server-locally"&gt;&lt;/span&gt;
&lt;a href="#connecting-to-the-server-locally" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;em&gt;Only CHT Android&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Refer to the &lt;a href="https://docs.communityhealthtoolkit.org/community/contributing/code/core/dev-environment/#nginx-local-ip"&gt;CHT Core Developer Guide&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;Manually testing with older Android versions&lt;span class="hx:absolute hx:-mt-20" id="manually-testing-with-older-android-versions"&gt;&lt;/span&gt;
&lt;a href="#manually-testing-with-older-android-versions" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;em&gt;Only CHT Android&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Later versions of the CHT, only support &lt;a href="https://docs.communityhealthtoolkit.org/releases/#dependencies"&gt;running on Chrome/Webview 90+&lt;/a&gt;. Some older versions of Android will not have a new enough Android System Webview to be able to run the CHT webapp. This is particularly true of emulated Android devices, which typically are configured to not receive updates. To test the CHT functionality on these devices you must manually upgrade the version of the Chrome/Webview apk used as the Android System Webview.&lt;/p&gt;
&lt;p&gt;To upgrade the necessary apk on an emulated Android device:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Start by using the &lt;code&gt;Google APIs&lt;/code&gt; variant of the Android image. The base AOSP image bakes in the &lt;code&gt;com.android.webview&lt;/code&gt; package, making it difficult to update.&lt;/li&gt;
&lt;li&gt;Depending on your version of Android, you will need to manually download a new version of the apk (make sure to get the correct variant for your architecture):
&lt;ul&gt;
&lt;li&gt;For Android 7-9, you should download a new version of &lt;code&gt;com.android.chrome&lt;/code&gt; (e.g. from &lt;a href="https://www.apkmirror.com/apk/google-inc/chrome/" rel="external"&gt;apkMirror&lt;/a&gt;).&lt;/li&gt;
&lt;li&gt;For Android 10+, you should download a new version of &lt;code&gt;com.google.android.webview&lt;/code&gt; (e.g. from &lt;a href="https://www.apkmirror.com/apk/google-inc/android-system-webview/" rel="external"&gt;apkMirror&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Then, you can use adb to install the apk into the device: &lt;code&gt;adb install -r *your_apk*.apk&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="hx:overflow-x-auto hx:mt-6 hx:flex hx:flex-col hx:rounded-lg hx:border hx:py-4 hx:px-4 hx:border-gray-200 hx:contrast-more:border-current hx:contrast-more:dark:border-current hx:border-blue-200 hx:bg-blue-100 hx:text-blue-900 hx:dark:border-blue-200/30 hx:dark:bg-blue-900/30 hx:dark:text-blue-200"&gt;
&lt;p class="hx:flex hx:items-center hx:font-medium"&gt;&lt;svg height=16px class="hx:inline-block hx:align-middle hx:mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/&gt;&lt;/svg&gt;Note&lt;/p&gt;
&lt;div class="hx:w-full hx:min-w-0 hx:leading-7"&gt;
&lt;div class="hx:mt-6 hx:leading-7 hx:first:mt-0"&gt;&lt;p&gt;Testing using an Android 5-6 device can be more challenging. The &lt;code&gt;com.android.webview&lt;/code&gt; package seems to be baked into the system partition regardless of the image variant. It is possible use a custom ROM (e.g. CyanogenMod) with an upgraded WebView version on a physical device. Another approach to testing with older versions of Android is to simply test against an older version of the CHT (e.g. CHT &lt;code&gt;3.x.&lt;/code&gt; only requires Chrome/Webview 53). The functionality of cht-android can still be validated by interacting with this old CHT version.&lt;/p&gt;
&lt;p&gt;If using the docker-helper to deploy CHT instances for testing with old Android versions, be aware that the &lt;code&gt;local-ip.medicmobile.org&lt;/code&gt; SSL certificates may not work with the device (because the root certificate is not recognized). On Android 5-6 you can manually install the root certificate via Settings &amp;gt; Security &amp;gt; Install from SD Card.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Android Studio&lt;span class="hx:absolute hx:-mt-20" id="android-studio"&gt;&lt;/span&gt;
&lt;a href="#android-studio" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The &lt;a href="https://developer.android.com/studio" rel="external"&gt;Android Studio&lt;/a&gt; can be used to build and launch the app instead. Be sure to select the right flavor from the &lt;em&gt;Build Variants&lt;/em&gt; dialog (see &lt;a href="https://developer.android.com/studio/run#changing-variant" rel="external"&gt;Change the build variant&lt;/a&gt;). To launch the app in an emulator, you need to uncomment the code that has the strings for the &lt;code&gt;x86&lt;/code&gt; or the &lt;code&gt;x86_64&lt;/code&gt; architecture in the &lt;code&gt;android&lt;/code&gt; / &lt;code&gt;splits&lt;/code&gt; / &lt;code&gt;include&lt;/code&gt; sections of the &lt;code&gt;build.gradle&lt;/code&gt; file.&lt;/p&gt;
&lt;h3&gt;Artifact formats&lt;span class="hx:absolute hx:-mt-20" id="artifact-formats"&gt;&lt;/span&gt;
&lt;a href="#artifact-formats" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;When building the app there are two output formats you can use: Android App Bundle or APK.&lt;/p&gt;
&lt;h4&gt;Android App Bundles&lt;span class="hx:absolute hx:-mt-20" id="android-app-bundles"&gt;&lt;/span&gt;
&lt;a href="#android-app-bundles" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;em&gt;Only CHT Android&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://github.com/medic/cht-android/blob/master/.github/workflows/publish.yml" rel="external"&gt;publish&lt;/a&gt; script in CI produces multiple AABs for publishing to the &lt;strong&gt;Google Play Store&lt;/strong&gt;, so the generated &lt;code&gt;.aab&lt;/code&gt; files need to be uploaded instead of the &lt;code&gt;.apk&lt;/code&gt; files if the Play Store require so. Old apps published for the first time before Aug 1, 2021 can be updated with the APK format.
If distributing AABs via the Play Store, upload all AABs and it will automatically choose the right one for the target device. The AABs are named as follows: &lt;code&gt;cht-android-{version}-{brand}-release.aab&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;APKs&lt;span class="hx:absolute hx:-mt-20" id="apks"&gt;&lt;/span&gt;
&lt;a href="#apks" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;For compatibility with a wide range of devices, the &lt;a href="https://github.com/medic/cht-android/blob/master/.github/workflows/publish.yml" rel="external"&gt;publish&lt;/a&gt; script in CI produces multiple APKs. The two variables are the instruction set used by the device&amp;rsquo;s CPU, and the supported Android version. When sideloading the application, it is essential to pick the correct APK or the application may crash.&lt;/p&gt;
&lt;p&gt;If distributing APKs via the Play Store, upload all APKs and it will automatically choose the right one for the target device.&lt;/p&gt;
&lt;p&gt;To help you pick which APK to install, you can find information about the version of Android and the CPU in the About section of the phone&amp;rsquo;s settings menu.&lt;/p&gt;
&lt;p&gt;The APKs are named as follows: &lt;code&gt;cht-android-{version}-{brand}-{instruction-set}-release.apk&lt;/code&gt;.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Instruction set&lt;/th&gt;
&lt;th&gt;Android version&lt;/th&gt;
&lt;th&gt;Notes&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;arm64-v8a&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;5+&lt;/td&gt;
&lt;td&gt;Preferred. Use this APK if possible.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;armeabi-v7a&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;5+&lt;/td&gt;
&lt;td&gt;Built as support for older devices, ignore if possible.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</description></item><item><title>Releasing</title><link>https://docs.communityhealthtoolkit.org/community/contributing/code/android/releasing/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/community/contributing/code/android/releasing/</guid><description>
&lt;p&gt;All Medic&amp;rsquo;s Android projects automatically build, sign, and release builds via GitHub Actions. The following guide applies to any of these apps, although the last 2 are in maintenance mode (links pointing to the release sections):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/medic/cht-android/releases" rel="external"&gt;cht-android&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/medic/cht-gateway/releases" rel="external"&gt;cht-gateway&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/medic/medic-collect/releases" rel="external"&gt;medic-collect&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/medic/rdt-capture/releases" rel="external"&gt;rdt-capture&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Alpha for release testing&lt;span class="hx:absolute hx:-mt-20" id="alpha-for-release-testing"&gt;&lt;/span&gt;
&lt;a href="#alpha-for-release-testing" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Ensure all issues for this release have passed AT and been merged into &lt;code&gt;master&lt;/code&gt;. You can also create an alpha release from a feature branch, to provide the needed &lt;code&gt;.apk&lt;/code&gt; files to the QA team.&lt;/li&gt;
&lt;li&gt;Create a git tag starting with &lt;code&gt;v&lt;/code&gt; and ending with the alpha version, e.g. &lt;code&gt;git tag v1.2.3-alpha.1&lt;/code&gt;, and push the tag to GitHub (&lt;code&gt;git push --tags&lt;/code&gt;). For features branches, you can add the name of the branch or whatever keyword helps to identify the release, e.g. &lt;code&gt;v1.2.3-alpha.dark-theme.4&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Creating the tag will trigger the building and signing of the app in CI. The release-ready APKs are available for side-loading from the Releases section in the project (e.g. &lt;a href="https://github.com/medic/cht-android/releases" rel="external"&gt;CHT-Android Releases&lt;/a&gt;), along with the AABs that the Google Play Store may require. Note that the created release on GitHub with the generated artifacts will not be explicitly linked to the tag because the release is in a draft state.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Side-Load&lt;/strong&gt;: for testing internally, or apps that are not published in the Play Store like Collect and Gateway: Navigate to the GitHub Releases page (linked above) and download the relevant APKs for distribution.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Production release&lt;span class="hx:absolute hx:-mt-20" id="production-release"&gt;&lt;/span&gt;
&lt;a href="#production-release" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Update the CHANGELOG with the details of what&amp;rsquo;s in this release.&lt;/li&gt;
&lt;li&gt;Repeat steps 2-3 from the above &lt;a href="https://docs.communityhealthtoolkit.org/community/contributing/code/android/releasing/#alpha-for-release-testing"&gt;alpha release section&lt;/a&gt; with the naming convention &lt;code&gt;v&amp;lt;major&amp;gt;.&amp;lt;minor&amp;gt;.&amp;lt;patch&amp;gt;&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;The CI build for the tag will create a new draft release on GitHub. Include the release notes from the CHANGELOG in the description of the release and publish the release on GitHub.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.communityhealthtoolkit.org/building/branding/publishing/"&gt;Publish&lt;/a&gt; in the Play Store. For the CHT-Android app, the &amp;ldquo;reference&amp;rdquo; apps (&lt;code&gt;medicmobilegamma&lt;/code&gt; and &lt;code&gt;unbranded&lt;/code&gt;) must be published in the Play Store. Other channels such as F-Droid can also be used to publish the app.&lt;/li&gt;
&lt;li&gt;Announce the release on the &lt;a href="https://forum.communityhealthtoolkit.org" rel="external"&gt;CHT forum&lt;/a&gt;, under the &amp;ldquo;Product - Releases&amp;rdquo; category.&lt;/li&gt;
&lt;/ol&gt;</description></item><item><title>Securing Android Devices</title><link>https://docs.communityhealthtoolkit.org/community/contributing/code/android/securing-android/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/community/contributing/code/android/securing-android/</guid><description>
&lt;p&gt;To secure an android device you should enable at least a pin code lock on the device, enable FDE (full disc encryption) and setup remote wiping capabilities by enabling mobile device management.&lt;/p&gt;
&lt;h2&gt;PIN Setup and FDE&lt;span class="hx:absolute hx:-mt-20" id="pin-setup-and-fde"&gt;&lt;/span&gt;
&lt;a href="#pin-setup-and-fde" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Instructions are slightly different per device. Enabling FDE has the added benefit that you must also lock the device with a pin code or password.&lt;/p&gt;
&lt;h3&gt;Android 5.0 or later&lt;span class="hx:absolute hx:-mt-20" id="android-50-or-later"&gt;&lt;/span&gt;
&lt;a href="#android-50-or-later" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Open the &lt;code&gt;Security&lt;/code&gt; menu under settings. On unmodified versions of Android, this
can be found under &lt;code&gt;Settings&lt;/code&gt; &lt;code&gt;&amp;gt;&lt;/code&gt; &lt;code&gt;Personal&lt;/code&gt; &lt;code&gt;&amp;gt;&lt;/code&gt; &lt;code&gt;Security&lt;/code&gt;. Choose &lt;code&gt;Encrypt Phone&lt;/code&gt;, &lt;code&gt;Encrypt Tablet&lt;/code&gt;, or &lt;code&gt;Encrypt Device&lt;/code&gt;. If you haven&amp;rsquo;t already set a PIN
or passcode for the lock screen, you will be prompted to do so. Remember this
PIN and do not write it down.&lt;/p&gt;
&lt;figure&gt;&lt;a href="encrypt-50.jpg"&gt;&lt;img src="https://docs.communityhealthtoolkit.org/community/contributing/code/android/securing-android/encrypt-50.jpg"
alt="Screenshot for Android 5.0"&gt;&lt;/a&gt;&lt;figcaption&gt;
&lt;p&gt;Screenshot for Android 5.0&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h3&gt;Android 4.4 or earlier&lt;span class="hx:absolute hx:-mt-20" id="android-44-or-earlier"&gt;&lt;/span&gt;
&lt;a href="#android-44-or-earlier" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;First, you&amp;rsquo;ll need to set up a PIN. Navigate to &lt;code&gt;Settings&lt;/code&gt; &lt;code&gt;&amp;gt;&lt;/code&gt; &lt;code&gt;Security&lt;/code&gt; &lt;code&gt;&amp;gt;&lt;/code&gt;
&lt;code&gt;Screen Lock&lt;/code&gt;, and set a numeric PIN for the device of &lt;em&gt;at least&lt;/em&gt; four digits.
Remember this PIN and do not write it down.&lt;/p&gt;
&lt;p&gt;Then, open the &lt;code&gt;Security&lt;/code&gt; menu under settings. On unmodified versions of
Android, this can be found under &lt;code&gt;Settings&lt;/code&gt; &lt;code&gt;&amp;gt;&lt;/code&gt; &lt;code&gt;Personal&lt;/code&gt; &lt;code&gt;&amp;gt;&lt;/code&gt; &lt;code&gt;Security&lt;/code&gt;.
On some devices, the exact menu layout may have been modified by the hardware
manufacturer. Choose &lt;code&gt;Encrypt Phone&lt;/code&gt; or &lt;code&gt;Encrypt Tablet&lt;/code&gt;.&lt;/p&gt;
&lt;figure&gt;&lt;a href="encrypt-44.jpg"&gt;&lt;img src="https://docs.communityhealthtoolkit.org/community/contributing/code/android/securing-android/encrypt-44.jpg"
alt="Screenshot for Android 4.4"&gt;&lt;/a&gt;&lt;figcaption&gt;
&lt;p&gt;Screenshot for Android 4.4&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h3&gt;Android Versions before 3.0&lt;span class="hx:absolute hx:-mt-20" id="android-versions-before-30"&gt;&lt;/span&gt;
&lt;a href="#android-versions-before-30" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Android does not support disk encryption in versions earlier than 3.0
(Honeycomb). If you have one of these devices, we recommend that you do not use it.&lt;/p&gt;
&lt;h2&gt;Mobile device management&lt;span class="hx:absolute hx:-mt-20" id="mobile-device-management"&gt;&lt;/span&gt;
&lt;a href="#mobile-device-management" class="subheading-anchor" aria-label="Permalink for this section"&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Using mobile device management (MDM) software allows administrators to remotely manage mobile devices, which often includes the option to delete apps and data from lost or stolen mobile devices.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;See Also&lt;/em&gt;: &lt;a href="https://docs.communityhealthtoolkit.org/building/branding/publishing/#mobile-device-management"&gt;Publishing &amp;gt; Mobile Device Management&lt;/a&gt;&lt;/p&gt;</description></item></channel></rss>